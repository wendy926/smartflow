<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>调试页面</title>
</head>

<body>
  <h1>调试页面</h1>
  <div id="debug-info"></div>

  <script>
    async function debugAPI() {
      try {
        const response = await fetch('/api/signals');
        const data = await response.json();

        const debugInfo = document.getElementById('debug-info');
        debugInfo.innerHTML = '<h2>API数据调试</h2>';

        data.slice(0, 3).forEach((signal, index) => {
          const div = document.createElement('div');
          div.innerHTML = `
                        <h3>${signal.symbol}</h3>
                        <p>marketType: ${signal.marketType}</p>
                        <p>trendStrength: ${signal.trendStrength}</p>
                        <p>signalStrength: ${signal.signalStrength}</p>
                        <p>rangeLowerBoundaryValid: ${signal.rangeLowerBoundaryValid}</p>
                        <p>rangeUpperBoundaryValid: ${signal.rangeUpperBoundaryValid}</p>
                        <p>strategyVersion: ${signal.strategyVersion}</p>
                        <p>executionMode: ${signal.executionMode}</p>
                        <p>execution: ${signal.execution}</p>
                        <hr>
                    `;
          debugInfo.appendChild(div);
        });

        // 测试前端逻辑
        data.slice(0, 3).forEach((signal, index) => {
          const trend4h = signal.trend4h || signal.trend || '--';
          const marketType = signal.marketType || '--';
          const strategyVersion = signal.strategyVersion || 'V2';

          console.log(`${signal.symbol} 调试信息:`, {
            trend4h,
            marketType,
            strategyVersion,
            trendStrength: signal.trendStrength,
            signalStrength: signal.signalStrength,
            rangeLowerBoundaryValid: signal.rangeLowerBoundaryValid,
            rangeUpperBoundaryValid: signal.rangeUpperBoundaryValid
          });

          // 测试1H判断逻辑
          let signalDisplay = '--';
          if (strategyVersion === 'V3') {
            if (marketType === '趋势市' && signal.trendStrength) {
              console.log(`${signal.symbol} 趋势市分支`);
              signalDisplay = `${signal.trendStrength}<br><small>${signal.signalStrength}</small>`;
            } else if (marketType === '震荡市') {
              console.log(`${signal.symbol} 震荡市分支`);
              const rangeLowerValid = signal.rangeLowerBoundaryValid || false;
              const rangeUpperValid = signal.rangeUpperBoundaryValid || false;
              const boundaryCount = (rangeLowerValid ? 1 : 0) + (rangeUpperValid ? 1 : 0);
              const boundaryStatus = boundaryCount >= 1 ? '边界有效' : '边界无效';
              signalDisplay = `${boundaryStatus}<br><small>${boundaryCount}/2分</small>`;
            } else {
              console.log(`${signal.symbol} 其他分支`);
            }
          }

          console.log(`${signal.symbol} 1H判断显示:`, signalDisplay);
        });

      } catch (error) {
        console.error('调试失败:', error);
      }
    }

    debugAPI();
  </script>
</body>

</html>