<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>监控页面调试</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .debug-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .debug-section h3 { margin-top: 0; }
        table { width: 100%; border-collapse: collapse; margin: 10px 0; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .test-btn { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .test-btn:hover { background: #0056b3; }
        .log { background: #f8f9fa; padding: 10px; border-radius: 4px; font-family: monospace; white-space: pre-wrap; max-height: 300px; overflow-y: auto; }
    </style>
</head>
<body>
    <h1>监控页面调试工具</h1>
    
    <div class="debug-section">
        <h3>1. 测试API数据获取</h3>
        <button class="test-btn" onclick="testAPIData()">获取监控数据</button>
        <div id="apiResult" class="log"></div>
    </div>
    
    <div class="debug-section">
        <h3>2. 测试表格元素查找</h3>
        <button class="test-btn" onclick="testTableElements()">检查表格元素</button>
        <div id="tableResult" class="log"></div>
    </div>
    
    <div class="debug-section">
        <h3>3. 测试表格更新</h3>
        <button class="test-btn" onclick="testTableUpdate()">更新表格</button>
        <div id="updateResult" class="log"></div>
    </div>
    
    <div class="debug-section">
        <h3>4. 模拟监控页面表格</h3>
        <table id="testTable">
            <thead>
                <tr>
                    <th>交易对</th>
                    <th>数据收集率</th>
                    <th>信号分析率</th>
                    <th>整体状态</th>
                </tr>
            </thead>
            <tbody id="testTableBody">
                <tr><td colspan="4" style="text-align: center;">暂无数据</td></tr>
            </tbody>
        </table>
    </div>

    <script>
        let monitoringData = null;
        
        async function testAPIData() {
            const resultDiv = document.getElementById('apiResult');
            resultDiv.textContent = '正在获取数据...';
            
            try {
                const response = await fetch('/api/monitoring-dashboard');
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                monitoringData = await response.json();
                
                resultDiv.textContent = `API请求成功！
数据摘要:
- summary存在: ${monitoringData.summary ? '是' : '否'}
- detailedStats长度: ${monitoringData.detailedStats ? monitoringData.detailedStats.length : 'undefined'}
- 第一个交易对: ${monitoringData.detailedStats && monitoringData.detailedStats[0] ? monitoringData.detailedStats[0].symbol : 'N/A'}

完整数据:
${JSON.stringify(monitoringData, null, 2)}`;
            } catch (error) {
                resultDiv.textContent = `API请求失败: ${error.message}`;
            }
        }
        
        function testTableElements() {
            const resultDiv = document.getElementById('tableResult');
            const elements = {
                'testTableBody': document.getElementById('testTableBody'),
                'monitoringTableBody': document.getElementById('monitoringTableBody'),
                'detailedTableBody': document.getElementById('detailedTableBody')
            };
            
            let result = '表格元素检查结果:\n';
            for (const [name, element] of Object.entries(elements)) {
                result += `${name}: ${element ? '找到' : '未找到'}\n`;
                if (element) {
                    result += `  - 父元素: ${element.parentElement ? element.parentElement.tagName : 'N/A'}\n`;
                    result += `  - 子元素数量: ${element.children.length}\n`;
                }
            }
            
            resultDiv.textContent = result;
        }
        
        function testTableUpdate() {
            const resultDiv = document.getElementById('updateResult');
            const tbody = document.getElementById('testTableBody');
            
            if (!monitoringData) {
                resultDiv.textContent = '请先获取API数据';
                return;
            }
            
            if (!tbody) {
                resultDiv.textContent = '找不到表格元素';
                return;
            }
            
            try {
                tbody.innerHTML = '';
                
                if (monitoringData.detailedStats && monitoringData.detailedStats.length > 0) {
                    monitoringData.detailedStats.slice(0, 5).forEach(symbol => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${symbol.symbol}</td>
                            <td>${symbol.dataCollection.rate.toFixed(1)}%</td>
                            <td>${symbol.signalAnalysis.rate.toFixed(1)}%</td>
                            <td>${symbol.overall.status}</td>
                        `;
                        tbody.appendChild(row);
                    });
                    resultDiv.textContent = `表格更新成功！添加了 ${Math.min(5, monitoringData.detailedStats.length)} 行数据`;
                } else {
                    tbody.innerHTML = '<tr><td colspan="4" style="text-align: center;">暂无数据</td></tr>';
                    resultDiv.textContent = '没有数据可显示';
                }
            } catch (error) {
                resultDiv.textContent = `表格更新失败: ${error.message}`;
            }
        }
        
        // 页面加载完成后自动检查
        document.addEventListener('DOMContentLoaded', () => {
            testTableElements();
        });
    </script>
</body>
</html>
