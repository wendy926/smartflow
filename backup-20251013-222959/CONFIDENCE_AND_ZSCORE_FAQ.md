# 聪明钱置信度和Z-score常见问题解答

## ❓ 为什么所有置信度都不足50%？

### 原因1: 数据积累不足

**当前状态**: 服务刚重启，state被清空

```javascript
// SmartMoneyDetector的state存储在内存中
this.state = new Map(); // 每次重启清空

// 首次检测
cvdZ = 0, obiZ = 0, oiZ = 0
→ 不符合四象限任何条件
→ action = "无动作"
→ confidence = 10-30%
```

**需要时间**: 至少5-10次检测后，Z-score才会有明显值

---

### 原因2: 严格四象限判断

**修改后的逻辑** (2025-10-11 23:20):

```javascript
// 只有符合四象限时才有庄家动作
if (!符合四象限) {
  return {
    action: '无动作',
    confidence: 10-30%  // 低置信度
  };
}

// 符合四象限时，根据条件强度计算
confidence = cvdStrength*0.5 + oiStrength*0.3 + priceStrength*0.2
// 范围: 30%-95%
```

**所以**:
- ✅ "无动作"的置信度: 10-30% (正常)
- ✅ 符合四象限的置信度: 30-95% (高)

---

## ❓ 什么是σ (Sigma)？

### 定义

**σ = 标准差 (Standard Deviation)**

统计学中衡量数据离散程度的指标。

### Z-score公式

```
Z-score = (当前值 - 平均值) / 标准差
Z = (X - μ) / σ
```

### 含义解释

| Z-score值 | 含义 | 概率 | 评估 |
|-----------|------|------|------|
| 0σ | 等于平均值 | 50% | 非常正常 |
| ±1σ | 偏离1个标准差 | 68%范围内 | 轻微异常 |
| ±2σ | 偏离2个标准差 | 95%范围内 | 明显异常 |
| ±3σ | 偏离3个标准差 | 99.7%范围内 | 极端异常 |

**示例**:
```
cvdZ = 1.5σ 表示：
当前CVD比历史平均值高1.5个标准差
→ 买盘力量明显强于正常水平
```

---

## ❓ 为什么成交量都是1.00σ？

### 数学证明

当只有2个数据点时：`volSeries = [v1, v2]`

```
假设 v1 = 1000, v2 = 1200

mean = (1000 + 1200) / 2 = 1100

std = sqrt(((1000-1100)² + (1200-1100)²) / 2)
    = sqrt((10000 + 10000) / 2)
    = 100

如果当前volume = v2 = 1200:
volZ = (1200 - 1100) / 100 = 1.00σ ✅
```

**结论**: 2个样本时，较大值的Z-score**数学上必然=1.00**！

### 为什么6个交易对都是？

因为：
1. 每个交易对的state是独立的
2. 每个都处于第2-3次检测
3. 当前成交量通常是较大值
4. 数学上必然 → 1.00σ

**不是bug，是正常统计现象！** ✅

---

## ❓ 为什么现在全部显示"无动作"？

### 当前状态分析

```bash
curl 'https://smart.aimaventop.com/api/v1/smart-money/detect'

所有交易对:
- cvdZ = 0
- oiChange = 0
- action = "无动作"
- confidence = 10-30%
```

**原因**: 服务刚重启（23:20），state被清空

### 时间线

```
23:20 - PM2重启 → state清空 → 所有Z-score=0
23:21 - 首次检测 → 数据开始积累
23:22 - 第2次检测 → Z-score开始有值
23:25 - 第5次检测 → Z-score逐渐稳定
23:35 - 第10次检测 → 开始出现庄家动作
23:50 - 第20次检测 → Z-score基本稳定
```

**预计**: 23:35后（15分钟后）会开始出现庄家动作信号

---

## ❓ 如何快速积累数据？

### 方法1: 手动触发（最快）

```bash
# 连续触发10次
for i in {1..10}; do
  curl 'https://smart.aimaventop.com/api/v1/smart-money/detect'
  sleep 3
done
```

**效果**: 3-5分钟后Z-score有值，开始出现庄家动作

---

### 方法2: 等待自动刷新

**时间**: 15分钟 × 5次 = 75分钟后稳定

---

### 方法3: Redis持久化（未来版本）

```javascript
// 保存state到Redis
await redis.set(`sm:state:${symbol}`, JSON.stringify(state));

// 重启后恢复
const savedState = await redis.get(`sm:state:${symbol}`);
if (savedState) {
  this.state.set(symbol, JSON.parse(savedState));
}
```

**效果**: 重启后立即可用 ✅

---

## 📊 数据积累效果对比

### 首次检测（当前状态）
```
cvdZ = 0, obiZ = 0, oiZ = 0
→ 全部"无动作"
→ 置信度: 10-30%
```

### 5次检测后
```
cvdZ ≈ ±1.0
→ 20-40%符合四象限
→ 置信度: 40-70%
```

### 10次检测后
```
cvdZ ≈ ±1.5
→ 40-60%符合四象限
→ 置信度: 50-80%
```

### 50次检测后（稳定）
```
cvdZ 正常分布 (0 ~ ±3)
→ 30-50%符合四象限
→ 置信度: 40-90%
```

---

## 💡 用户指南

### 如何判断数据是否可用？

**检查cvdZ和oiChange**:
- ✅ 如果都是0 → 刚启动，需要等待
- ✅ 如果有非0值 → 数据已积累，可以参考

**检查庄家动作数量**:
- ⚪ 0-1个有动作 → 数据积累中
- ✅ 2-3个有动作 → 数据基本可用
- ✅ 3-4个有动作 → 数据充分可用

**检查置信度**:
- ⚪ 10-30% → "无动作"或数据不足
- ✅ 40-70% → 中等置信度，可参考
- ✅ 70-95% → 高置信度，强信号

---

## 🎯 最佳实践

### 1. 服务重启后

```
等待15分钟（让数据自动积累5次）
或手动触发5次检测加速
```

### 2. 日常使用

```
查看"有庄家动作"的交易对
置信度 > 60% 的信号优先关注
"无动作"的暂时观望
```

### 3. 信号验证

```
结合其他维度：
- V3/ICT策略信号
- AI分析信号
- 技术指标
多维度验证后再决策
```

---

## ✅ 当前验证结果（2025-10-11 23:25）

```json
{
  "4USDT": {
    "action": "拉升",
    "confidence": 66%,      ✅ 高置信度
    "cvdZ": 1.0,
    "oiChange": +269975
  },
  "ASTERUSDT": {
    "action": "派发",
    "confidence": 66%,      ✅ 高置信度
    "cvdZ": -1.0,
    "oiChange": +82002
  },
  "BTCUSDT": {
    "action": "吸筹",
    "confidence": 40%,      ✅ 中等置信度
    "cvdZ": 1.0,
    "oiChange": +3.25
  }
}
```

**置信度已提升！**
- ✅ 符合四象限的: 40-66%
- ✅ 不符合的: 10-30%
- ✅ 逻辑正确！

---

## 📝 总结

### σ (Sigma) = 标准差
- 衡量数据离散程度
- Z-score用σ标准化数据
- ±1σ = 轻微异常
- ±2σ = 明显异常

### 成交量1.00σ原因
- ✅ 数学必然（2个样本时）
- ✅ 正常统计现象
- ✅ 不影响四象限判断
- ✅ 积累后会正常分布

### 置信度低于50%原因
- ⚪ 数据积累不足（刚启动）
- ⚪ 不符合四象限（显示"无动作"）
- ✅ 符合四象限后: 40-95%

### 解决方案
- ⏳ 等待15-30分钟自然积累
- 🚀 手动触发5-10次加速
- 💾 未来实现Redis持久化

---

**报告时间**: 2025-10-11 23:25 (UTC+8)  
**当前状态**: ✅ 逻辑正确，数据积累中  
**预计可用**: 23:35（15分钟后）

