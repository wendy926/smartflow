# SmartFlow 监控系统使用指南

## 概述

SmartFlow 监控系统是一个完整的交易对数据收集、信号判断和模拟交易监控解决方案，确保系统持续稳定运行。

## 核心功能

### 1. 数据收集监控
- **监控指标**: 日线K线、小时K线、24小时价格、资金费率、持仓量等
- **完成率阈值**: 90% (可配置)
- **监控频率**: 实时监控每次数据收集

### 2. 信号判断监控
- **监控指标**: 日线趋势分析、小时确认、15分钟执行分析
- **完成率阈值**: 85% (可配置)
- **监控频率**: 实时监控每次信号分析

### 3. 模拟交易监控
- **监控指标**: 交易信号生成、入场价格计算、止损止盈设置
- **完成率阈值**: 80% (可配置)
- **监控频率**: 实时监控每次模拟交易

## 监控界面

### 1. 监控仪表板 (`📈 监控仪表板`)
- **系统概览**: 运行时间、监控交易对数量、平均完成率
- **各交易对详情**: 每个交易对的数据收集、信号判断、模拟交易完成率
- **告警阈值配置**: 显示当前设置的告警阈值
- **实时更新**: 每10秒自动刷新数据

### 2. 健康检查 (`🏥 健康检查`)
- **系统状态**: 整体健康状态评估
- **异常交易对**: 显示完成率低于阈值的交易对
- **详细状态**: 每个交易对的详细健康指标
- **实时更新**: 每10秒自动刷新数据

### 3. 数据监控 (`📊 查看数据监控`)
- **原始数据统计**: 各类型数据的成功率统计
- **分析记录**: 最近的分析执行记录
- **错误追踪**: 详细的错误信息和失败记录

## API 接口

### 1. 监控仪表板数据
```
GET /api/monitoring-dashboard
```
返回完整的监控仪表板数据，包括完成率统计和健康状态。

### 2. 健康检查
```
GET /api/health-check
```
返回系统健康状态和异常交易对信息。

### 3. 设置告警阈值
```
POST /api/monitoring-thresholds
Content-Type: application/json

{
  "thresholds": {
    "dataCollection": 90,
    "signalAnalysis": 85,
    "simulationTrading": 80
  }
}
```

## 告警系统

### 告警类型
1. **数据收集告警**: 当数据收集完成率低于阈值时触发
2. **信号判断告警**: 当信号判断完成率低于阈值时触发
3. **模拟交易告警**: 当模拟交易触发率低于阈值时触发
4. **总体健康告警**: 当总体完成率低于80%时触发

### 告警频率
- **检查频率**: 每2分钟检查一次
- **通知方式**: Telegram 消息推送
- **告警内容**: 包含具体的交易对、完成率和阈值信息

## 配置说明

### 默认阈值设置
```javascript
{
  dataCollection: 90,    // 数据收集完成率阈值
  signalAnalysis: 85,    // 信号判断完成率阈值
  simulationTrading: 80  // 模拟交易触发率阈值
}
```

### 健康状态定义
- **healthy**: 完成率 >= 阈值
- **warning**: 完成率 < 阈值但 >= 50%
- **critical**: 完成率 < 50%

## 使用建议

### 1. 日常监控
- 定期查看监控仪表板，关注整体完成率
- 关注健康检查中的异常交易对
- 根据告警信息及时处理问题

### 2. 阈值调整
- 根据系统性能调整告警阈值
- 建议数据收集阈值保持在90%以上
- 信号判断阈值可根据策略复杂度调整

### 3. 问题排查
- 查看数据监控中的错误记录
- 检查API连接和数据源状态
- 分析特定交易对的失败原因

## 技术实现

### 监控架构
```
DataMonitor (数据监控类)
├── 完成率统计
├── 健康状态检查
├── 告警系统
└── 仪表板数据生成

SmartFlowStrategy (交易策略类)
├── 数据收集阶段监控
├── 信号判断阶段监控
└── 模拟交易阶段监控
```

### 数据流程
1. **数据收集**: 记录原始数据获取成功/失败
2. **信号分析**: 记录各阶段分析结果
3. **模拟交易**: 记录交易信号生成结果
4. **完成率计算**: 实时计算各阶段完成率
5. **健康检查**: 评估系统整体健康状态
6. **告警发送**: 自动发送异常告警

## 故障排除

### 常见问题
1. **完成率突然下降**: 检查API连接和网络状态
2. **特定交易对异常**: 检查该交易对的数据源
3. **告警频繁**: 调整告警阈值或检查系统性能
4. **监控面板不更新**: 检查浏览器控制台错误

### 日志查看
- 服务器日志: 查看控制台输出的监控信息
- 浏览器日志: 查看前端JavaScript错误
- 网络日志: 检查API请求和响应

## 最佳实践

1. **定期检查**: 建议每天至少查看一次监控仪表板
2. **阈值优化**: 根据实际运行情况调整告警阈值
3. **及时响应**: 收到告警后及时处理相关问题
4. **性能监控**: 关注系统运行时间和资源使用情况
5. **数据备份**: 定期备份重要的监控数据和配置

---

通过这个监控系统，你可以确保 SmartFlow 交易系统持续稳定运行，及时发现和处理潜在问题，提高交易策略的可靠性和盈利能力。
