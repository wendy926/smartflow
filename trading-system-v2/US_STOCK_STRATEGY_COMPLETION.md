# ç¾è‚¡ç­–ç•¥å®æ–½å®ŒæˆæŠ¥å‘Š

**å®Œæˆæ—¥æœŸ**: 2025-10-26  
**ç‰ˆæœ¬**: v3.0.0  
**å®Œæˆåº¦**: âœ… **100%**

---

## âœ… å·²å®Œæˆçš„æ‰€æœ‰ç»„ä»¶

### 1. åŸºç¡€æ¶æ„ âœ…
- **ç¾è‚¡é€‚é…å™¨**: `src/adapters/USStockAdapter.js`
- **APIå®¢æˆ·ç«¯**: `src/api/us-stock-api.js`
  - AlpacaAPIï¼ˆå¸‚åœºæ•°æ®ï¼‰
  - AlphaVantageAPIï¼ˆæŒ‡æ ‡æ•°æ®ï¼‰
  - YahooFinanceAPIï¼ˆåŸºæœ¬ä¿¡æ¯ï¼‰
- **æ¨¡æ‹Ÿä¸‹å•**: ä¸è¿›è¡ŒçœŸå®äº¤æ˜“
- **Alpha Vantageå¯†é’¥**: `6XV08K479PGSITYI`

### 2. æ•°æ®åº“è®¾è®¡ âœ…
- `us_stock_market_data` - å¸‚åœºæ•°æ®è¡¨
- `us_stock_trades` - æ¨¡æ‹Ÿäº¤æ˜“è¡¨
- `us_stock_backtest_results` - å›æµ‹ç»“æœè¡¨
- `us_stock_strategy_params` - ç­–ç•¥å‚æ•°è¡¨
- **SQLæ–‡ä»¶**: 
  - `database/us_stock_schema.sql`
  - `database/init_us_stock_strategy_params.sql`

### 3. æœåŠ¡å±‚ âœ…
- **å¸‚åœºæ•°æ®é¢„åŠ è½½å™¨**: `src/services/us-stock-market-data-loader.js`
- **æ¨¡æ‹Ÿäº¤æ˜“æœåŠ¡**: `src/services/us-stock-simulation-trades.js`
- **å›æµ‹å¼•æ“**: `src/services/us-stock-backtest-engine.js`

### 4. ç­–ç•¥æ¨¡å— âœ…
- **US-V3ç­–ç•¥**: `src/strategies/us-v3-strategy.js`
  - å¤ç”¨V3ç­–ç•¥é€»è¾‘
  - é€‚é…ç¾è‚¡æ•°æ®æ ¼å¼
  - æ”¯æŒå¤šæ—¶é—´æ¡†æ¶ï¼ˆ4H/1H/15mï¼‰
  - ç‹¬ç«‹å‚æ•°é…ç½®
  
- **US-ICTç­–ç•¥**: `src/strategies/us-ict-strategy.js`
  - å¤ç”¨ICTç­–ç•¥é€»è¾‘
  - è®¢å•å—è¯†åˆ«
  - æµåŠ¨æ€§æ‰«è¡æ£€æµ‹
  - ç‹¬ç«‹å‚æ•°é…ç½®

### 5. APIæ¥å£ âœ…
- **å›æµ‹APIè·¯ç”±**: `src/api/routes/us-stock-backtest.js`
  - POST `/api/us-stock/backtest` - è§¦å‘å›æµ‹
  - GET `/api/us-stock/backtest/results` - æŸ¥è¯¢å›æµ‹ç»“æœ
  - GET `/api/us-stock/trades` - è·å–äº¤æ˜“å†å²
  - GET `/api/us-stock/trades/open` - è·å–æœªå¹³ä»“è®¢å•

### 6. ç­–ç•¥æ‰§è¡Œå™¨ âœ…
- **Worker**: `src/workers/us-stock-strategy-worker.js`
  - å®šæ—¶æ‰§è¡Œç­–ç•¥åˆ†æ
  - è‡ªåŠ¨ç”Ÿæˆæ¨¡æ‹Ÿè®¢å•
  - ç›‘æ§å’Œæ—¥å¿—
  - ç‹¬ç«‹äºåŠ å¯†è´§å¸ç­–ç•¥æ‰§è¡Œå™¨

---

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

### ç‹¬ç«‹æ€§ä¿è¯

#### 1. æ•°æ®éš”ç¦»
```sql
-- åŠ å¯†è´§å¸æ•°æ®ï¼ˆåŸæœ‰ï¼‰
market_data
trades
backtest_results

-- ç¾è‚¡æ•°æ®ï¼ˆæ–°å¢ï¼Œç‹¬ç«‹ï¼‰
us_stock_market_data
us_stock_trades
us_stock_backtest_results
```

#### 2. å¼•æ“ç‹¬ç«‹
```javascript
// åŠ å¯†è´§å¸å›æµ‹å¼•æ“ï¼ˆåŸæœ‰ï¼Œä¸å—å½±å“ï¼‰
src/core/backtest-engine.js
src/services/backtest-manager-v3.js

// ç¾è‚¡å›æµ‹å¼•æ“ï¼ˆæ–°å¢ï¼Œå®Œå…¨ç‹¬ç«‹ï¼‰
src/services/us-stock-backtest-engine.js
```

#### 3. ç­–ç•¥ç‹¬ç«‹
```javascript
// åŠ å¯†è´§å¸ç­–ç•¥ï¼ˆåŸæœ‰ï¼Œä¸å—å½±å“ï¼‰
src/strategies/v3-strategy.js
src/strategies/ict-strategy.js

// ç¾è‚¡ç­–ç•¥ï¼ˆæ–°å¢ï¼Œå®Œå…¨ç‹¬ç«‹ï¼‰
src/strategies/us-v3-strategy.js
src/strategies/us-ict-strategy.js
```

#### 4. APIéš”ç¦»
```javascript
// åŠ å¯†è´§å¸å›æµ‹APIï¼ˆåŸæœ‰ï¼‰
/api/v1/backtest/V3/BALANCED
/api/v1/backtest/ICT/BALANCED

// ç¾è‚¡å›æµ‹APIï¼ˆæ–°å¢ï¼‰
/api/us-stock/backtest
/api/us-stock/backtest/results
```

---

## ğŸ“Š å®æ–½ç»Ÿè®¡

### æ–‡ä»¶åˆ›å»º
- **æ•°æ®åº“**: 2ä¸ªSQLæ–‡ä»¶
- **é€‚é…å™¨**: 1ä¸ª
- **APIå®¢æˆ·ç«¯**: 1ä¸ªï¼ˆ3ä¸ªç±»ï¼‰
- **æœåŠ¡æ¨¡å—**: 3ä¸ª
- **ç­–ç•¥æ¨¡å—**: 2ä¸ª
- **APIè·¯ç”±**: 1ä¸ª
- **Worker**: 1ä¸ª
- **æ–‡æ¡£**: 6ä¸ª
- **æ€»è®¡**: 17ä¸ªæ–‡ä»¶

### ä»£ç ç»Ÿè®¡
- **æ–°å¢ä»£ç **: ~3500è¡Œ
- **æ•°æ®åº“SQL**: ~150è¡Œ
- **æ–‡æ¡£**: ~2500è¡Œ

---

## ğŸš€ ä½¿ç”¨è¯´æ˜

### åˆå§‹åŒ–æ•°æ®åº“
```bash
# åˆ›å»ºç¾è‚¡æ•°æ®è¡¨
mysql -u root -p < database/us_stock_schema.sql

# åˆå§‹åŒ–ç­–ç•¥å‚æ•°
mysql -u root -p < database/init_us_stock_strategy_params.sql
```

### é…ç½®ç¯å¢ƒå˜é‡
```bash
# .envæ–‡ä»¶
ALPHA_VANTAGE_API_KEY=6XV08K479PGSITYI  # âœ… å·²é…ç½®
ALPACA_API_KEY=your_api_key  # å¯é€‰
```

### è¿è¡Œå›æµ‹
```javascript
const USStockBacktestEngine = require('./src/services/us-stock-backtest-engine');

const engine = new USStockBacktestEngine(database);

const result = await engine.runBacktest({
  strategyName: 'V3_US',           // æˆ– 'ICT_US'
  strategyMode: 'BALANCED',
  symbol: 'AAPL',
  timeframe: '15m',
  startDate: '2024-01-01',
  endDate: '2025-10-26'
});

console.log('å›æµ‹ç»“æœ:', result);
```

### å¯åŠ¨ç­–ç•¥æ‰§è¡Œå™¨
```bash
# ä½¿ç”¨PM2è¿è¡Œ
pm2 start src/workers/us-stock-strategy-worker.js --name us-stock-worker

# æŸ¥çœ‹æ—¥å¿—
pm2 logs us-stock-worker
```

### APIè°ƒç”¨ç¤ºä¾‹
```javascript
// è§¦å‘å›æµ‹
POST /api/us-stock/backtest
{
  "strategyName": "V3_US",
  "strategyMode": "BALANCED",
  "symbol": "AAPL",
  "timeframe": "15m",
  "startDate": "2024-01-01",
  "endDate": "2025-10-26"
}

// æŸ¥è¯¢å›æµ‹ç»“æœ
GET /api/us-stock/backtest/results?strategyName=V3_US&symbol=AAPL

// è·å–äº¤æ˜“å†å²
GET /api/us-stock/trades?symbol=AAPL&limit=100
```

---

## ğŸ¯ ç­–ç•¥ç‰¹ç‚¹

### V3ç­–ç•¥ (å¤šå› å­è¶‹åŠ¿)
- **4Hçº§åˆ«**: åˆ¤æ–­å¤§è¶‹åŠ¿ï¼ˆEMA10/EMA20äº¤å‰ï¼‰
- **1Hçº§åˆ«**: ç¡®è®¤ä¸­æœŸåŠ¨é‡ï¼ˆRSIæŒ‡æ ‡ï¼‰
- **15mçº§åˆ«**: ç²¾ç¡®å…¥åœºï¼ˆATRæ­¢æŸï¼‰
- **æ­¢æŸ**: 2%ï¼ˆä¿å®ˆï¼‰
- **æ­¢ç›ˆ**: 4%ï¼ˆå¹³è¡¡ï¼‰
- **R:R**: 1:2

### ICTç­–ç•¥ (è®¢å•å—)
- **è®¢å•å—è¯†åˆ«**: æˆäº¤é‡çªå¢åŒºåŸŸ
- **æµåŠ¨æ€§æ‰«è¡**: ä¸Šæ–¹/ä¸‹æ–¹æ­¢æŸæ‰«è¡
- **å…¥åœº**: æ‰«è¡åçš„ä»·æ ¼å›æµ‹
- **æ­¢æŸ**: åŸºäºATRçš„2å€
- **æ­¢ç›ˆ**: R:R 1:2æˆ–1:3
- **R:R**: 1:2ï¼ˆå¹³è¡¡ï¼‰

---

## âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹

### 1. ç‹¬ç«‹æ€§ä¿è¯
âœ… **å®Œå…¨ç‹¬ç«‹**ï¼šç¾è‚¡æ¨¡å—ä¸å½±å“åŠ å¯†è´§å¸ç³»ç»Ÿ
- ä½¿ç”¨ç‹¬ç«‹çš„æ•°æ®åº“è¡¨
- ä½¿ç”¨ç‹¬ç«‹çš„å›æµ‹å¼•æ“
- ä½¿ç”¨ç‹¬ç«‹çš„ç­–ç•¥æ–‡ä»¶
- ä½¿ç”¨ç‹¬ç«‹çš„APIè·¯ç”±

### 2. æ¨¡æ‹Ÿäº¤æ˜“
âœ… **åªåšæ¨¡æ‹Ÿ**ï¼Œä¸è¿›è¡ŒçœŸå®äº¤æ˜“
- æ‰€æœ‰è®¢å•åªä¿å­˜åˆ°æ•°æ®åº“
- åŸºäºå†å²æ•°æ®è®¡ç®—PnL
- ä¸è°ƒç”¨Alpaca Trading API

### 3. APIé…ç½®
âœ… **æœ€å°‘APIä¾èµ–**ï¼š
- Alpha Vantage: å·²é…ç½®
- Alpaca Market Data: å¯é€‰ï¼ˆä»…ç”¨äºKçº¿ï¼‰

---

## ğŸ“ˆ å›æµ‹æŒ‡æ ‡

### åŸºç¡€æŒ‡æ ‡
- æ€»äº¤æ˜“æ¬¡æ•°
- ç›ˆåˆ©æ¬¡æ•° / äºæŸæ¬¡æ•°
- èƒœç‡ï¼ˆ%ï¼‰
- æ€»ç›ˆåˆ© / æ€»äºæŸ
- å‡€åˆ©æ¶¦

### é£é™©æŒ‡æ ‡
- æœ€å¤§å›æ’¤ï¼ˆ%ï¼‰
- å¤æ™®æ¯”ç‡
- ç›ˆäºæ¯”
- å¹³å‡ç›ˆåˆ© / å¹³å‡äºæŸ
- å¹³å‡æŒä»“å¤©æ•°

---

## âœ… éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½å®Œæ•´æ€§
- âœ… ç‹¬ç«‹çš„æ•°æ®è¡¨ç»“æ„
- âœ… ç‹¬ç«‹çš„å›æµ‹å¼•æ“
- âœ… V3å’ŒICTç­–ç•¥é›†æˆ
- âœ… å®Œæ•´çš„APIæ¥å£
- âœ… ç­–ç•¥æ‰§è¡Œå™¨Worker
- âœ… å›æµ‹æŒ‡æ ‡è®¡ç®—

### ç‹¬ç«‹æ€§éªŒè¯
- âœ… ä¸ä¿®æ”¹åŠ å¯†è´§å¸ç­–ç•¥
- âœ… ä¸ä¿®æ”¹åŠ å¯†è´§å¸å›æµ‹å¼•æ“
- âœ… ä½¿ç”¨ç‹¬ç«‹çš„æ•°æ®åº“è¡¨
- âœ… ä½¿ç”¨ç‹¬ç«‹çš„APIè·¯å¾„
- âœ… å®Œå…¨éš”ç¦»çš„é”™è¯¯å¤„ç†

### æ¨¡æ‹Ÿäº¤æ˜“éªŒè¯
- âœ… ä¸è¿›è¡ŒçœŸå®äº¤æ˜“
- âœ… è®¢å•åªä¿å­˜åˆ°æ•°æ®åº“
- âœ… PnLè®¡ç®—å‡†ç¡®
- âœ… èƒœç‡è®¡ç®—å‡†ç¡®

---

## ğŸ‰ æ€»ç»“

### å®æ–½å®Œæˆåº¦ï¼š100%

**æ‰€æœ‰è®¡åˆ’çš„åŠŸèƒ½å·²å®Œå…¨å®æ–½**ï¼š
1. âœ… ç‹¬ç«‹çš„ç¾è‚¡é€‚é…å™¨
2. âœ… å®Œæ•´çš„æ•°æ®åº“æ¶æ„
3. âœ… å¸‚åœºæ•°æ®é¢„åŠ è½½å™¨
4. âœ… æ¨¡æ‹Ÿäº¤æ˜“æœåŠ¡
5. âœ… ç‹¬ç«‹å›æµ‹å¼•æ“
6. âœ… V3å’ŒICTç­–ç•¥é›†æˆ
7. âœ… å›æµ‹APIæ¥å£
8. âœ… ç­–ç•¥æ‰§è¡Œå™¨Worker

### å…³é”®æˆå°±
1. **å®Œå…¨ç‹¬ç«‹**: ä¸å½±å“ç°æœ‰åŠ å¯†è´§å¸ç³»ç»Ÿ
2. **ç­–ç•¥å¤ç”¨**: æˆåŠŸå¤ç”¨V3å’ŒICTé€»è¾‘
3. **æ•°æ®éš”ç¦»**: ä½¿ç”¨ç‹¬ç«‹çš„æ•°æ®è¡¨
4. **æ¨¡æ‹Ÿäº¤æ˜“**: åªåšå›æµ‹ï¼Œä¸åšå®ç›˜
5. **è¿›åº¦100%**: æ‰€æœ‰ç»„ä»¶å·²å®Œæˆ

### ä½¿ç”¨å‡†å¤‡
- âœ… æ•°æ®åº“è¡¨å·²åˆ›å»º
- âœ… ç­–ç•¥å‚æ•°å·²é…ç½®
- âœ… APIå¯†é’¥å·²é…ç½®
- âœ… ä»£ç å·²æäº¤åˆ°GitHub
- âœ… æ–‡æ¡£å®Œæ•´

**ç¾è‚¡ç­–ç•¥å®æ–½å·²100%å®Œæˆï¼Œå¯ä»¥å¼€å§‹ä½¿ç”¨ï¼** ğŸŠ

