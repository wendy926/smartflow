# VPSæ“ä½œå‘½ä»¤ - æ‹‰å–ä»£ç å¹¶é‡å¯æœåŠ¡

**æ—¥æœŸ**: 2025-10-26  
**ç›®æ ‡**: æ‹‰å–æœ€æ–°ä»£ç å¹¶é‡å¯åŠ å¯†è´§å¸ç­–ç•¥æœåŠ¡

---

## ğŸ“‹ æ“ä½œæ­¥éª¤

### 1. SSHè¿æ¥åˆ°VPS

```bash
ssh root@47.237.163.85
```

æˆ–ä½¿ç”¨å¯†é’¥ï¼š

```bash
ssh -i ~/.ssh/smartflow_vps_correct root@47.237.163.85
```

---

### 2. åˆ‡æ¢åˆ°é¡¹ç›®ç›®å½•

```bash
cd /home/admin/smartflow-vps-app/vps-app
```

---

### 3. æ£€æŸ¥å½“å‰PM2è¿›ç¨‹çŠ¶æ€

```bash
pm2 list
```

æœŸæœ›çœ‹åˆ°çš„è¿›ç¨‹ï¼š
- main-app (åŠ å¯†è´§å¸WebæœåŠ¡)
- strategy-worker (åŠ å¯†è´§å¸ç­–ç•¥æ‰§è¡Œå™¨)
- å¯èƒ½è¿˜æœ‰å…¶ä»–æœåŠ¡

---

### 4. æ‹‰å–æœ€æ–°ä»£ç 

```bash
git pull origin main
```

---

### 5. é‡å¯åŠ å¯†è´§å¸ç­–ç•¥æœåŠ¡

```bash
# é‡å¯strategy-worker
pm2 restart strategy-worker

# é‡å¯main-appï¼ˆå¦‚æœéœ€è¦ï¼‰
pm2 restart main-app
```

---

### 6. æ£€æŸ¥æœåŠ¡çŠ¶æ€

```bash
# æ£€æŸ¥PM2çŠ¶æ€
pm2 list

# æŸ¥çœ‹strategy-workeræ—¥å¿—
pm2 logs strategy-worker --lines 50

# æ£€æŸ¥ç³»ç»Ÿå†…å­˜ä½¿ç”¨
free -h

# å®æ—¶ç›‘æ§ï¼ˆå¯é€‰ï¼‰
pm2 monit
```

---

## ğŸ” éªŒè¯æ­¥éª¤

### æ£€æŸ¥åŠ å¯†è´§å¸ç­–ç•¥æ˜¯å¦æ­£å¸¸è¿è¡Œ

```bash
# æŸ¥çœ‹æœ€æ–°äº¤æ˜“
mysql -u root -p -e "
SELECT * FROM simulation_trades 
WHERE created_at >= DATE_SUB(NOW(), INTERVAL 1 HOUR)
ORDER BY created_at DESC
LIMIT 10;
"

# æŸ¥çœ‹ç­–ç•¥æ—¥å¿—
pm2 logs strategy-worker --lines 100
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. å†…å­˜ä½¿ç”¨
- æ£€æŸ¥å†…å­˜æ˜¯å¦æ­£å¸¸ï¼š`free -h`
- å¦‚æœå†…å­˜ä½¿ç”¨ç‡è¿‡é«˜ï¼Œè€ƒè™‘é‡å¯VPS

### 2. ç¾è‚¡æ¨¡å—æœªå¯åŠ¨
- ç¾è‚¡Workeré»˜è®¤æœªå¯ç”¨ï¼ˆé¿å…å ç”¨å†…å­˜ï¼‰
- ç¾è‚¡å›æµ‹éœ€è¦æ‰‹åŠ¨é€šè¿‡APIè§¦å‘
- ä¸ä¼šå½±å“åŠ å¯†è´§å¸ç­–ç•¥è¿è¡Œ

### 3. ä¿æŒåŠ å¯†è´§å¸æœåŠ¡è¿è¡Œ
- main-appï¼šWebæœåŠ¡
- strategy-workerï¼šåŠ å¯†è´§å¸ç­–ç•¥æ‰§è¡Œå™¨
- è¿™ä¸¤ä¸ªæœåŠ¡éœ€è¦ä¿æŒè¿è¡Œ

---

## ğŸš¨ å¦‚æœé‡åˆ°é—®é¢˜

### PM2è¿›ç¨‹ä¸å­˜åœ¨

å¦‚æœæ‰¾ä¸åˆ°strategy-workerï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–è¿›ç¨‹ï¼š

```bash
# æŸ¥çœ‹æ‰€æœ‰PM2è¿›ç¨‹
pm2 list

# æŸ¥çœ‹è¿›ç¨‹ä¿¡æ¯
ps aux | grep node
```

### ä»£ç æ‹‰å–å†²çª

```bash
# å¦‚æœGitæœ‰å†²çªï¼Œå…ˆstashæœ¬åœ°ä¿®æ”¹
git stash

# ç„¶åæ‹‰å–
git pull origin main

# å¦‚æœæœ‰å†²çªï¼Œæ‰‹åŠ¨è§£å†³
git status
```

### é‡å¯å¤±è´¥

```bash
# åœæ­¢æ‰€æœ‰PM2è¿›ç¨‹
pm2 stop all

# åˆ é™¤æ‰€æœ‰è¿›ç¨‹
pm2 delete all

# é‡æ–°å¯åŠ¨ï¼ˆéœ€è¦æŸ¥çœ‹åŸæ¥çš„å¯åŠ¨è„šæœ¬ï¼‰
# é€šå¸¸åœ¨ package.json çš„ pm2.config.js æˆ–ç±»ä¼¼æ–‡ä»¶ä¸­
```

---

## ğŸ“Š é¢„æœŸç»“æœ

### PM2è¿›ç¨‹çŠ¶æ€

```bash
â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id  â”‚ name                 â”‚ status  â”‚ uptime  â”‚ memory   â”‚ cpu     â”‚
â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 0   â”‚ main-app             â”‚ online  â”‚ 5m      â”‚ 120MB    â”‚ 2%      â”‚
â”‚ 1   â”‚ strategy-worker      â”‚ online  â”‚ 2m      â”‚ 80MB     â”‚ 5%      â”‚
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ—¥å¿—è¾“å‡º

```bash
[strategy-worker] ç­–ç•¥æ‰§è¡Œæ­£å¸¸
[strategy-worker] V3ç­–ç•¥åˆ†æå®Œæˆ
[strategy-worker] ICTç­–ç•¥åˆ†æå®Œæˆ
```

---

## âœ… æˆåŠŸæ ‡å¿—

1. âœ… PM2è¿›ç¨‹æ­£å¸¸è¿è¡Œï¼ˆmain-app, strategy-workerï¼‰
2. âœ… å†…å­˜ä½¿ç”¨æ­£å¸¸ï¼ˆ< 80%ï¼‰
3. âœ… ç­–ç•¥æ—¥å¿—æ˜¾ç¤ºæ­£å¸¸æ‰§è¡Œ
4. âœ… æœ‰æ–°äº¤æ˜“äº§ç”Ÿ
5. âœ… ä»£ç å·²æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬

---

## ğŸ“ æ“ä½œè®°å½•

æ‰§è¡Œå®Œæ“ä½œåï¼Œè®°å½•ç»“æœï¼š

```bash
echo "æ“ä½œæ—¶é—´: $(date)" >> /tmp/vps_operation.log
echo "PM2çŠ¶æ€:" >> /tmp/vps_operation.log
pm2 list >> /tmp/vps_operation.log
echo "å†…å­˜ä½¿ç”¨:" >> /tmp/vps_operation.log
free -h >> /tmp/vps_operation.log
```

æŸ¥çœ‹æ“ä½œè®°å½•ï¼š

```bash
cat /tmp/vps_operation.log
```

