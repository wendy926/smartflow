<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SmartFlow 通用交易系统</title>
  <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: #333;
    }

    /* 导航栏 */
    .navbar {
      position: fixed;
      top: 0;
      width: 100%;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      z-index: 1000;
      padding: 15px 40px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .navbar .logo-text {
      font-size: 24px;
      font-weight: bold;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .navbar .nav-actions {
      display: flex;
      gap: 15px;
    }

    .btn-login,
    .btn-register {
      padding: 8px 20px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.3s ease;
    }

    .btn-login {
      background: transparent;
      color: #667eea;
      border: 2px solid #667eea;
    }

    .btn-login:hover {
      background: #667eea;
      color: white;
    }

    .btn-register {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .btn-register:hover {
      opacity: 0.9;
    }

    /* 模态框覆盖层 */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 2000;
      backdrop-filter: blur(5px);
    }

    .modal-overlay.active {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modal-box {
      background: white;
      border-radius: 16px;
      padding: 40px;
      max-width: 450px;
      width: 90%;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    .modal-header {
      text-align: center;
      margin-bottom: 30px;
    }

    .modal-header h2 {
      font-size: 28px;
      margin-bottom: 10px;
    }

    .modal-header p {
      color: #666;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: #333;
    }

    .form-group input {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid #e9ecef;
      border-radius: 8px;
      font-size: 14px;
      transition: border-color 0.3s;
    }

    .form-group input:focus {
      outline: none;
      border-color: #667eea;
    }

    .btn-submit {
      width: 100%;
      padding: 12px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: opacity 0.3s;
    }

    .btn-submit:hover {
      opacity: 0.9;
    }

    .text-center {
      text-align: center;
      margin-top: 20px;
    }

    .text-center a {
      color: #667eea;
      text-decoration: none;
      cursor: pointer;
    }

    .error-message {
      background: #fee;
      color: #c33;
      padding: 10px;
      border-radius: 6px;
      margin-bottom: 15px;
      font-size: 14px;
      display: none;
    }

    .success-message {
      background: #efe;
      color: #3c3;
      padding: 10px;
      border-radius: 6px;
      margin-bottom: 15px;
      font-size: 14px;
      display: none;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 40px 20px;
    }

    header {
      text-align: center;
      margin-bottom: 60px;
    }

    .logo {
      font-size: 48px;
      color: white;
      margin-bottom: 10px;
    }

    h1 {
      font-size: 42px;
      color: white;
      margin-bottom: 10px;
    }

    .subtitle {
      font-size: 20px;
      color: rgba(255, 255, 255, 0.9);
    }

    .features {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 30px;
      margin-bottom: 50px;
    }

    .feature-card {
      background: white;
      border-radius: 16px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      transition: transform 0.3s ease;
    }

    .feature-card:hover {
      transform: translateY(-5px);
    }

    .feature-icon {
      font-size: 48px;
      color: #667eea;
      margin-bottom: 15px;
    }

    .feature-card h3 {
      font-size: 24px;
      margin-bottom: 10px;
      color: #333;
    }

    .feature-card p {
      color: #666;
      line-height: 1.6;
    }

    .markets {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 30px;
      margin-bottom: 50px;
    }

    .market-card {
      background: white;
      border-radius: 16px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      text-align: center;
      transition: transform 0.3s ease;
    }

    .market-card:hover {
      transform: translateY(-5px);
    }

    .market-icon {
      font-size: 64px;
      margin-bottom: 20px;
    }

    .market-card.crypto .market-icon {
      color: #f7931a;
    }

    .market-card.stock .market-icon {
      color: #1e88e5;
    }

    .market-card.us-stock .market-icon {
      color: #4caf50;
    }

    .market-card h3 {
      font-size: 28px;
      margin-bottom: 15px;
      color: #333;
    }

    .market-card p {
      color: #666;
      margin-bottom: 20px;
    }

    .btn {
      display: inline-block;
      padding: 12px 30px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      text-decoration: none;
      border-radius: 8px;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }

    .feature-list {
      text-align: left;
      color: #666;
    }

    .feature-list li {
      margin-bottom: 8px;
      list-style: none;
      padding-left: 24px;
      position: relative;
    }

    .feature-list li:before {
      content: "✓";
      position: absolute;
      left: 0;
      color: #667eea;
      font-weight: bold;
    }

    footer {
      text-align: center;
      padding: 30px;
      color: rgba(255, 255, 255, 0.8);
    }

    @media (max-width: 768px) {
      h1 {
        font-size: 32px;
      }

      .subtitle {
        font-size: 16px;
      }

      .features,
      .markets {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>

<body>
  <!-- 导航栏 -->
  <nav class="navbar">
    <div class="logo-text">SmartFlow</div>
    <div class="nav-actions" id="navActions">
      <!-- 用户信息或登录按钮 -->
      <span id="userInfo" style="display: none; margin-right: 15px;"></span>
      <button class="btn-login" data-action="login" style="display: none;" id="loginBtn">登录</button>
    </div>
  </nav>

  <div class="container" style="margin-top: 80px;">
    <header>
      <div class="logo">
        <i class="fas fa-chart-line"></i>
      </div>
      <h1>SmartFlow</h1>
      <p class="subtitle">通用交易系统 - 支持加密货币、A股、美股多市场交易</p>
    </header>

    <section class="features">
      <div class="feature-card">
        <div class="feature-icon">
          <i class="fas fa-rocket"></i>
        </div>
        <h3>多市场支持</h3>
        <p>同时支持加密货币（Binance）、A股指数、美股市场的交易和回测</p>
      </div>

      <div class="feature-card">
        <div class="feature-icon">
          <i class="fas fa-brain"></i>
        </div>
        <h3>AI辅助分析</h3>
        <p>集成DeepSeek AI进行市场风险分析和交易对趋势分析</p>
      </div>

      <div class="feature-card">
        <div class="feature-icon">
          <i class="fas fa-robot"></i>
        </div>
        <h3>智能策略</h3>
        <p>V3多因子趋势策略和ICT订单块策略，支持自动参数优化</p>
      </div>

      <div class="feature-card">
        <div class="feature-icon">
          <i class="fas fa-shield-alt"></i>
        </div>
        <h3>智能风控</h3>
        <p>动态杠杆、止损止盈、时间止损、持仓时长管理等多维度风险管理</p>
      </div>

      <div class="feature-card">
        <div class="feature-icon">
          <i class="fas fa-chart-bar"></i>
        </div>
        <h3>实时监控</h3>
        <p>聪明钱检测、大额挂单监控、系统资源监控、Telegram通知</p>
      </div>

      <div class="feature-card">
        <div class="feature-icon">
          <i class="fas fa-backward"></i>
        </div>
        <h3>回测引擎</h3>
        <p>专业回测功能，支持多种时间框架，计算胜率、盈亏比、夏普比率等指标</p>
      </div>
    </section>

    <section class="markets">
      <div class="market-card crypto">
        <div class="market-icon">
          <i class="fab fa-bitcoin"></i>
        </div>
        <h3>加密货币</h3>
        <p>Binance交易所现货交易</p>
        <ul class="feature-list">
          <li>实时市场监控</li>
          <li>V3/ICT策略执行</li>
          <li>聪明钱检测</li>
          <li>大额挂单监控</li>
          <li>策略回测</li>
        </ul>
        <button class="btn" data-market="crypto">进入交易系统</button>
      </div>

      <div class="market-card stock">
        <div class="market-icon">
          <i class="fas fa-chart-line"></i>
        </div>
        <h3>A股指数</h3>
        <p>沪深300、中证500等指数交易</p>
        <ul class="feature-list">
          <li>指数市场监控</li>
          <li>CN-V3策略执行</li>
          <li>CN-ICT策略执行</li>
          <li>策略回测</li>
        </ul>
        <button class="btn" data-market="a">进入交易系统</button>
      </div>

      <div class="market-card us-stock">
        <div class="market-icon">
          <i class="fas fa-dollar-sign"></i>
        </div>
        <h3>美股市场</h3>
        <p>AAPL、MSFT等美股交易</p>
        <ul class="feature-list">
          <li>美股市场监控</li>
          <li>US-V3策略执行</li>
          <li>US-ICT策略执行</li>
          <li>策略回测</li>
        </ul>
        <button class="btn" data-market="us">进入交易系统</button>
      </div>
    </section>

    <footer>
      <p>SmartFlow © 2025 - 通用交易系统 v3.0.0</p>
    </footer>
  </div>

  <!-- 登录/注册模态框（合并） -->
  <div id="authModal" class="modal-overlay" onclick="closeModal(event)">
    <div class="modal-box" onclick="event.stopPropagation()">
      <div class="modal-header">
        <h2 id="modalTitle">欢迎使用SmartFlow</h2>
        <p id="modalSubtitle">登录或注册以进入交易系统</p>
      </div>
      
      <!-- 标签切换 -->
      <div style="display: flex; margin-bottom: 20px; border-bottom: 2px solid #e9ecef;">
        <button id="tabLogin" style="flex: 1; padding: 12px; background: #007bff; color: white; border: none; cursor: pointer;" data-tab="login">登录</button>
        <button id="tabRegister" style="flex: 1; padding: 12px; background: #f8f9fa; color: #666; border: none; cursor: pointer;" data-tab="register">注册</button>
      </div>

      <div id="authErrorMessage" class="error-message"></div>
      <div id="authSuccessMessage" class="success-message"></div>
      
      <!-- 登录表单 -->
      <form id="loginForm" style="display: block;">
        <div class="form-group">
          <label>邮箱</label>
          <input type="email" id="email" required placeholder="请输入您的邮箱">
        </div>
        <div class="form-group">
          <label>密码</label>
          <input type="password" id="password" required placeholder="请输入您的密码">
        </div>
        <button type="submit" class="btn-submit">登录</button>
      </form>

      <!-- 注册表单 -->
      <form id="registerForm" style="display: none;">
        <div class="form-group">
          <label>邮箱</label>
          <input type="email" id="regEmail" required placeholder="请输入您的邮箱">
        </div>
        <div class="form-group">
          <label>密码（至少8位）</label>
          <input type="password" id="regPassword" required minlength="8" placeholder="至少8位密码">
        </div>
        <div class="form-group">
          <label>姓名（可选）</label>
          <input type="text" id="regName" placeholder="请输入您的姓名">
        </div>
        <div class="form-group">
          <label>公司（可选）</label>
          <input type="text" id="regCompany" placeholder="请输入公司名称">
        </div>
        <button type="submit" class="btn-submit">注册</button>
      </form>
    </div>
  </div>

  <script>
    // 目标市场（用户选择的交易市场）
    let targetMarket = 'crypto';

    // 显示登录/注册模态框
    function showAuthModal(market) {
      targetMarket = market;
      document.getElementById('authModal').classList.add('active');
      switchTab('login');
    }

    // 切换标签
    function switchTab(tab) {
      const loginForm = document.getElementById('loginForm');
      const registerForm = document.getElementById('registerForm');
      const tabLogin = document.getElementById('tabLogin');
      const tabRegister = document.getElementById('tabRegister');

      if (tab === 'login') {
        loginForm.style.display = 'block';
        registerForm.style.display = 'none';
        tabLogin.style.background = '#007bff';
        tabLogin.style.color = 'white';
        tabRegister.style.background = '#f8f9fa';
        tabRegister.style.color = '#666';
      } else {
        loginForm.style.display = 'none';
        registerForm.style.display = 'block';
        tabLogin.style.background = '#f8f9fa';
        tabLogin.style.color = '#666';
        tabRegister.style.background = '#007bff';
        tabRegister.style.color = 'white';
      }
    }

    // 关闭模态框
    function closeModal(event) {
      if (event.target.classList.contains('modal-overlay')) {
        document.getElementById('authModal').classList.remove('active');
      }
    }

    // 处理登录
    async function handleLogin(event) {
      event.preventDefault();
      
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;

      const errorDiv = document.getElementById('authErrorMessage');
      const successDiv = document.getElementById('authSuccessMessage');

      try {
        const response = await fetch('/api/v1/auth/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password })
        });

        const data = await response.json();

        if (response.ok && data.success) {
          // 保存token
          localStorage.setItem('authToken', data.data.token);
          localStorage.setItem('userInfo', JSON.stringify(data.data.user));

          successDiv.textContent = '登录成功！正在跳转...';
          successDiv.style.display = 'block';
          errorDiv.style.display = 'none';

          // 根据选择的市场跳转
          let redirectUrl = '/crypto/dashboard';
          if (targetMarket === 'a') redirectUrl = '/a/dashboard';
          if (targetMarket === 'us') redirectUrl = '/us/dashboard';
          
          setTimeout(() => {
            window.location.href = redirectUrl;
          }, 1500);
        } else {
          errorDiv.textContent = data.message || '登录失败';
          errorDiv.style.display = 'block';
          successDiv.style.display = 'none';
        }
      } catch (error) {
        errorDiv.textContent = '网络错误，请稍后重试';
        errorDiv.style.display = 'block';
        successDiv.style.display = 'none';
      }
    }

    // 处理注册
    async function handleRegister(event) {
      event.preventDefault();

      const email = document.getElementById('regEmail').value;
      const password = document.getElementById('regPassword').value;
      const name = document.getElementById('regName').value;
      const company = document.getElementById('regCompany').value;

      const errorDiv = document.getElementById('authErrorMessage');
      const successDiv = document.getElementById('authSuccessMessage');

      try {
        const response = await fetch('/api/v1/auth/register', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password, name, company })
        });

        const data = await response.json();

        if (response.ok && data.success) {
          successDiv.textContent = '注册成功！请登录...';
          successDiv.style.display = 'block';
          errorDiv.style.display = 'none';

          // 切换到登录表单
          setTimeout(() => {
            switchTab('login');
            document.getElementById('email').value = email;
          }, 1500);
        } else {
          errorDiv.textContent = data.message || '注册失败';
          errorDiv.style.display = 'block';
          successDiv.style.display = 'none';
        }
      } catch (error) {
        errorDiv.textContent = '网络错误，请稍后重试';
        errorDiv.style.display = 'block';
        successDiv.style.display = 'none';
      }
    }

    // 事件监听器
    document.addEventListener('DOMContentLoaded', function() {
      // 所有"进入交易系统"按钮
      document.querySelectorAll('button[data-market]').forEach(btn => {
        btn.addEventListener('click', function() {
          const market = this.getAttribute('data-market');
          showAuthModal(market);
        });
      });

      // 标签切换按钮
      document.getElementById('tabLogin').addEventListener('click', function() {
        switchTab('login');
      });
      document.getElementById('tabRegister').addEventListener('click', function() {
        switchTab('register');
      });

      // 登录表单提交
      document.getElementById('loginForm').addEventListener('submit', function(e) {
        handleLogin(e);
      });

      // 注册表单提交
      document.getElementById('registerForm').addEventListener('submit', function(e) {
        handleRegister(e);
      });

      // 模态框关闭
      document.getElementById('authModal').addEventListener('click', function(e) {
        closeModal(e);
      });
    });

    // 检查是否已登录
    const authToken = localStorage.getItem('authToken');
    if (authToken) {
      // 如果已登录，显示用户信息
      const userInfo = JSON.parse(localStorage.getItem('userInfo') || '{}');
      document.querySelector('.nav-actions').innerHTML = `
        <span style="margin-right: 15px;">欢迎，${userInfo.email}</span>
        <button class="btn-login" id="logoutBtn">退出</button>
      `;
      
      // 退出按钮事件
      document.getElementById('logoutBtn').addEventListener('click', function() {
        logout();
      });
    }

    function logout() {
      localStorage.removeItem('authToken');
      localStorage.removeItem('userInfo');
      window.location.reload();
    }
  </script>
</body>

</html>