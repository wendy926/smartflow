<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SmartFlow 交易策略系统</title>
  <link rel="stylesheet" href="styles.css">
  <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.0.0/css/all.min.css" rel="stylesheet">
</head>

<body>
  <div class="container">
    <!-- 头部导航 -->
    <header class="header">
      <div class="logo">
        <i class="fas fa-chart-line"></i>
        <h1>SmartFlow</h1>
      </div>
      <nav class="nav">
        <a href="/dashboard" class="nav-link active" data-tab="dashboard">
          <i class="fas fa-tachometer-alt"></i>
          仪表板
        </a>
        <a href="/strategies" class="nav-link" data-tab="strategies">
          <i class="fas fa-chess"></i>
          策略执行
        </a>
        <a href="/monitoring" class="nav-link" data-tab="monitoring">
          <i class="fas fa-monitor-heart-rate"></i>
          系统监控
        </a>
        <a href="/statistics" class="nav-link" data-tab="statistics">
          <i class="fas fa-chart-bar"></i>
          胜率统计
        </a>
        <a href="/tools" class="nav-link" data-tab="tools">
          <i class="fas fa-tools"></i>
          工具
        </a>
        <a href="/docs" class="nav-link" data-tab="docs">
          <i class="fas fa-book"></i>
          文档
        </a>
      </nav>
    </header>

    <!-- 主要内容区域 -->
    <main class="main-content">
      <!-- 仪表板 -->
      <div id="dashboard" class="tab-content active">
        <div class="page-header">
          <h2>交易策略仪表板</h2>
          <div class="status-indicators">
            <div class="status-item">
              <span class="status-label">系统状态</span>
              <span class="status-value status-online">在线</span>
            </div>
            <div class="status-item">
              <span class="status-label">最后更新</span>
              <span class="status-value" id="lastUpdate">--</span>
            </div>
          </div>
        </div>


        <!-- 策略当前状态表格 -->
        <div class="card">
          <div class="card-header">
            <h3>策略当前状态</h3>
            <div class="card-actions">
              <div class="risk-selector">
                <label for="maxLossAmount">最大损失金额:</label>
                <select id="maxLossAmount" class="form-select">
                  <option value="20">20 USDT</option>
                  <option value="50">50 USDT</option>
                  <option value="100" selected>100 USDT</option>
                  <option value="200">200 USDT</option>
                </select>
              </div>
              <button class="btn btn-primary" id="refreshStrategyStatus">
                <i class="fas fa-sync-alt"></i>
                刷新
              </button>
            </div>
          </div>
          <div class="card-content">
            <div class="table-container">
              <table class="data-table" id="strategyStatusTable">
                <thead>
                  <tr>
                    <th>交易对</th>
                    <th>当前价格</th>
                    <th>策略</th>
                    <th>趋势</th>
                    <th>信号</th>
                    <th>高时间框架<br />趋势判断</th>
                    <th>中时间框架<br />多因子/OB区</th>
                    <th>低时间框架<br />入场判断</th>
                    <th>入场价格</th>
                    <th>止损价格</th>
                    <th>止盈价格</th>
                    <th>杠杆</th>
                    <th>保证金</th>
                  </tr>
                </thead>
                <tbody id="strategyStatusTableBody">
                  <!-- 数据将通过JavaScript动态加载 -->
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- 交易对监控已移除 -->
      </div>

      <!-- 策略执行页面 -->
      <div id="strategies" class="tab-content">
        <div class="page-header">
          <h2>策略执行与记录</h2>
          <div class="strategy-tabs">
            <button class="strategy-tab active" data-strategy="v3">Strategy V3</button>
            <button class="strategy-tab" data-strategy="ict">ICT Strategy</button>
          </div>
        </div>

        <!-- 策略统计卡片 -->
        <div class="cards-grid">
          <div class="card stats-card" id="v3-stats">
            <div class="card-header">
              <h3>V3策略统计</h3>
            </div>
            <div class="card-content">
              <div class="stats-grid">
                <div class="stat-item">
                  <span class="stat-label">总交易数</span>
                  <span class="stat-value total-trades">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">盈利交易</span>
                  <span class="stat-value profitable-trades">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">亏损交易</span>
                  <span class="stat-value losing-trades">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">胜率</span>
                  <span class="stat-value win-rate">0%</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">总盈亏</span>
                  <span class="stat-value total-pnl">$0.00</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">最大回撤</span>
                  <span class="stat-value max-drawdown">0%</span>
                </div>
              </div>
            </div>
          </div>

          <div class="card stats-card" id="ict-stats">
            <div class="card-header">
              <h3>ICT策略统计</h3>
            </div>
            <div class="card-content">
              <div class="stats-grid">
                <div class="stat-item">
                  <span class="stat-label">总交易数</span>
                  <span class="stat-value total-trades">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">盈利交易</span>
                  <span class="stat-value profitable-trades">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">亏损交易</span>
                  <span class="stat-value losing-trades">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">胜率</span>
                  <span class="stat-value win-rate">0%</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">总盈亏</span>
                  <span class="stat-value total-pnl">$0.00</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">最大回撤</span>
                  <span class="stat-value max-drawdown">0%</span>
                </div>
              </div>
            </div>
          </div>

          <div class="card stats-card" id="overall-stats">
            <div class="card-header">
              <h3>总体统计</h3>
            </div>
            <div class="card-content">
              <div class="stats-grid">
                <div class="stat-item">
                  <span class="stat-label">总交易数</span>
                  <span class="stat-value total-trades">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">总胜率</span>
                  <span class="stat-value win-rate">0%</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">总盈亏</span>
                  <span class="stat-value total-pnl">$0.00</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">最大回撤</span>
                  <span class="stat-value max-drawdown">0%</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">活跃交易</span>
                  <span class="stat-value active-trades">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">今日交易</span>
                  <span class="stat-value today-trades">0</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="strategy-content">
          <!-- Strategy V3 内容 -->
          <div id="v3-content" class="strategy-panel active">
            <div class="strategy-info">
              <h3>Strategy V3 - 多因子趋势策略</h3>
              <p>基于4H趋势判断、1H因子分析和15M入场信号的综合策略</p>
            </div>

            <!-- V3策略交易记录表格 -->
            <div class="trading-records">
              <h3>V3策略交易记录</h3>
              <div class="table-container">
                <table class="data-table" id="v3TradingRecordsTable">
                  <thead>
                    <tr>
                      <th>交易对</th>
                      <th>策略</th>
                      <th>方向</th>
                      <th>入场判断逻辑</th>
                      <th>入场时间</th>
                      <th>入场价格</th>
                      <th>止盈价格</th>
                      <th>止损价格</th>
                      <th>杠杆</th>
                      <th>保证金</th>
                      <th>状态</th>
                      <th>出场价格</th>
                      <th>出场原因</th>
                      <th>盈亏结果</th>
                      <th>盈亏金额</th>
                      <th>最大回撤</th>
                    </tr>
                  </thead>
                  <tbody id="v3-trades-body">
                    <!-- 数据将通过JavaScript动态加载 -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- ICT Strategy 内容 -->
          <div id="ict-content" class="strategy-panel">
            <div class="strategy-info">
              <h3>ICT Strategy - 订单块策略</h3>
              <p>基于订单块、流动性扫荡和吞没形态的ICT概念策略</p>
            </div>

            <!-- ICT策略交易记录表格 -->
            <div class="trading-records">
              <h3>ICT策略交易记录</h3>
              <div class="table-container">
                <table class="data-table" id="ictTradingRecordsTable">
                  <thead>
                    <tr>
                      <th>交易对</th>
                      <th>策略</th>
                      <th>方向</th>
                      <th>入场判断逻辑</th>
                      <th>入场时间</th>
                      <th>入场价格</th>
                      <th>止盈价格</th>
                      <th>止损价格</th>
                      <th>杠杆</th>
                      <th>保证金</th>
                      <th>状态</th>
                      <th>出场价格</th>
                      <th>出场原因</th>
                      <th>盈亏结果</th>
                      <th>盈亏金额</th>
                      <th>最大回撤</th>
                    </tr>
                  </thead>
                  <tbody id="ict-trades-body">
                    <!-- 数据将通过JavaScript动态加载 -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>


        </div>
      </div>

      <!-- 系统监控页面 -->
      <div id="monitoring" class="tab-content">
        <div class="page-header">
          <h2>系统监控</h2>
          <div class="monitoring-controls">
            <button class="btn btn-primary" onclick="refreshMonitoring()">
              <i class="fas fa-sync-alt"></i>
              刷新监控
            </button>
          </div>
        </div>

        <div class="monitoring-grid">
          <div class="card">
            <div class="card-header">
              <h3>系统资源</h3>
            </div>
            <div class="card-content">
              <div class="resource-item">
                <span class="resource-label">CPU使用率</span>
                <div class="progress-bar">
                  <div class="progress-fill" style="width: 35%"></div>
                </div>
                <span class="resource-value">35%</span>
              </div>
              <div class="resource-item">
                <span class="resource-label">内存使用率</span>
                <div class="progress-bar">
                  <div class="progress-fill" style="width: 68%"></div>
                </div>
                <span class="resource-value">68%</span>
              </div>
              <div class="resource-item">
                <span class="resource-label">磁盘使用率</span>
                <div class="progress-bar">
                  <div class="progress-fill" style="width: 45%"></div>
                </div>
                <span class="resource-value">45%</span>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h3>API状态</h3>
            </div>
            <div class="card-content">
              <div class="api-status">
                <div class="api-item">
                  <span class="api-name">Binance REST API</span>
                  <span class="api-status-value status-online">正常</span>
                </div>
                <div class="api-item">
                  <span class="api-name">Binance WebSocket</span>
                  <span class="api-status-value status-online">正常</span>
                </div>
                <div class="api-item">
                  <span class="api-name">数据库连接</span>
                  <span class="api-status-value status-online">正常</span>
                </div>
                <div class="api-item">
                  <span class="api-name">Redis缓存</span>
                  <span class="api-status-value status-online">正常</span>
                </div>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h3>策略执行状态</h3>
            </div>
            <div class="card-content">
              <div class="strategy-status">
                <div class="strategy-status-item">
                  <span class="strategy-name">Strategy V3</span>
                  <span class="strategy-status-value status-running">运行中</span>
                </div>
                <div class="strategy-status-item">
                  <span class="strategy-name">ICT Strategy</span>
                  <span class="strategy-status-value status-running">运行中</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- 胜率统计页面 -->
      <div id="statistics" class="tab-content">
        <div class="page-header">
          <h2>交易对胜率统计</h2>
          <div class="statistics-controls">
            <select class="form-select" id="strategySelect">
              <option value="all">所有策略</option>
              <option value="v3">Strategy V3</option>
              <option value="ict">ICT Strategy</option>
            </select>
            <select class="form-select" id="timeframeSelect">
              <option value="all">所有时间周期</option>
              <option value="1d">1天</option>
              <option value="4h">4小时</option>
              <option value="1h">1小时</option>
              <option value="15m">15分钟</option>
            </select>
          </div>
        </div>

        <div class="statistics-grid">
          <div class="card">
            <div class="card-header">
              <h3>总体统计</h3>
            </div>
            <div class="card-content">
              <div class="stat-item">
                <span class="stat-label">总交易数</span>
                <span class="stat-value" id="overall-total-trades">--</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">胜率</span>
                <span class="stat-value" id="overall-win-rate">--</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">总盈亏</span>
                <span class="stat-value" id="overall-total-pnl">--</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">最大回撤</span>
                <span class="stat-value" id="overall-max-drawdown">--</span>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h3>策略对比</h3>
            </div>
            <div class="card-content">
              <div class="strategy-comparison">
                <div class="comparison-item">
                  <span class="comparison-name">Strategy V3</span>
                  <div class="comparison-bar">
                    <div class="comparison-fill" style="width: 72%"></div>
                  </div>
                  <span class="comparison-value">72%</span>
                </div>
                <div class="comparison-item">
                  <span class="comparison-name">ICT Strategy</span>
                  <div class="comparison-bar">
                    <div class="comparison-fill" style="width: 65%"></div>
                  </div>
                  <span class="comparison-value">65%</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h3>交易对详细统计</h3>
          </div>
          <div class="card-content">
            <div class="table-container">
              <table class="data-table" id="statisticsTable">
                <thead>
                  <tr>
                    <th>交易对</th>
                    <th>策略</th>
                    <th>时间周期</th>
                    <th>交易数</th>
                    <th>胜率</th>
                    <th>盈亏</th>
                    <th>夏普比率</th>
                  </tr>
                </thead>
                <tbody id="statisticsTableBody">
                  <!-- 数据将通过JavaScript动态加载 -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- 工具页面 -->
      <div id="tools" class="tab-content">
        <div class="page-header">
          <h2>交易工具</h2>
        </div>

        <div class="tools-grid">
          <div class="card">
            <div class="card-header">
              <h3>动态杠杆滚仓计算器</h3>
            </div>
            <div class="card-content">
              <div class="calculator-form">
                <div class="form-row">
                  <div class="form-group">
                    <label>本金 (USDT)</label>
                    <input type="number" id="principal" placeholder="200" class="form-input" value="200">
                  </div>
                  <div class="form-group">
                    <label>初始杠杆</label>
                    <input type="number" id="initialLeverage" placeholder="50" class="form-input" value="50">
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group">
                    <label>开仓价格</label>
                    <input type="number" id="priceStart" placeholder="4700" class="form-input" value="4700">
                  </div>
                  <div class="form-group">
                    <label>目标价格</label>
                    <input type="number" id="priceTarget" placeholder="5200" class="form-input" value="5200">
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group">
                    <label>滚仓触发比例</label>
                    <input type="number" id="triggerRatio" placeholder="1.0" step="0.1" class="form-input" value="1.0">
                  </div>
                  <div class="form-group">
                    <label>杠杆递减系数</label>
                    <input type="number" id="leverageDecay" placeholder="0.5" step="0.1" class="form-input" value="0.5">
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group">
                    <label>利润锁定比例</label>
                    <input type="number" id="profitLockRatio" placeholder="0.5" step="0.1" class="form-input"
                      value="0.5">
                  </div>
                  <div class="form-group">
                    <label>最低杠杆</label>
                    <input type="number" id="minLeverage" placeholder="5" class="form-input" value="5">
                  </div>
                </div>
                <button class="btn btn-primary" onclick="calculateRolling()">计算动态滚仓</button>
              </div>
              <div class="calculator-result" id="rollingResult">
                <!-- 计算结果将显示在这里 -->
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h3>Telegram监控设置</h3>
            </div>
            <div class="card-content">
              <div class="telegram-settings">
                <!-- 交易触发Telegram设置 -->
                <div class="telegram-section">
                  <h4>交易触发通知</h4>
                  <div class="form-group">
                    <label>Bot Token</label>
                    <input type="text" id="tradingTelegramBotToken" placeholder="123456789:ABCdefGHIjklMNOpqrsTUVwxyz"
                      class="form-input">
                  </div>
                  <div class="form-group">
                    <label>Chat ID</label>
                    <input type="text" id="tradingTelegramChatId" placeholder="123456789" class="form-input">
                  </div>
                  <div class="form-group">
                    <button class="btn btn-primary" onclick="saveTradingTelegramSettings()">保存设置</button>
                    <button class="btn btn-secondary" onclick="testTradingTelegram()">测试连接</button>
                  </div>
                  <div class="telegram-status" id="tradingTelegramStatus">
                    <!-- 状态将通过JavaScript动态加载 -->
                  </div>
                </div>

                <!-- 系统监控Telegram设置 -->
                <div class="telegram-section">
                  <h4>系统监控告警</h4>
                  <div class="form-group">
                    <label>Bot Token</label>
                    <input type="text" id="monitoringTelegramBotToken"
                      placeholder="123456789:ABCdefGHIjklMNOpqrsTUVwxyz" class="form-input">
                  </div>
                  <div class="form-group">
                    <label>Chat ID</label>
                    <input type="text" id="monitoringTelegramChatId" placeholder="123456789" class="form-input">
                  </div>
                  <div class="form-group">
                    <button class="btn btn-primary" onclick="saveMonitoringTelegramSettings()">保存设置</button>
                    <button class="btn btn-secondary" onclick="testMonitoringTelegram()">测试连接</button>
                  </div>
                  <div class="telegram-status" id="monitoringTelegramStatus">
                    <!-- 状态将通过JavaScript动态加载 -->
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h3>系统测试API</h3>
              <div class="card-actions">
                <button class="btn btn-primary" onclick="runAllAPITests()">运行所有测试</button>
              </div>
            </div>
            <div class="card-content">
              <div class="api-test">
                <div class="test-group">
                  <button class="btn btn-secondary" onclick="testAPI('health')">健康检查</button>
                  <button class="btn btn-secondary" onclick="testAPI('symbols')">交易对API</button>
                  <button class="btn btn-secondary" onclick="testAPI('strategies')">策略状态API</button>
                  <button class="btn btn-secondary" onclick="testAPI('trades')">交易记录API</button>
                </div>
                <div class="test-group">
                  <button class="btn btn-secondary" onclick="testAPI('monitoring')">系统监控API</button>
                  <button class="btn btn-secondary" onclick="testAPI('tools')">工具API</button>
                  <button class="btn btn-secondary" onclick="testAPI('telegram')">Telegram API</button>
                  <button class="btn btn-secondary" onclick="testAPI('v3-analyze')">V3策略分析</button>
                </div>
                <div class="test-group">
                  <button class="btn btn-secondary" onclick="testAPI('ict-analyze')">ICT策略分析</button>
                  <button class="btn btn-secondary" onclick="testAPI('create-trade')">创建交易</button>
                </div>
                <div class="test-result" id="apiTestResult">
                  <!-- API测试结果将显示在这里 -->
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- 文档页面 -->
      <div id="docs" class="tab-content">
        <div class="page-header">
          <h2>策略文档</h2>
          <p>SmartFlow交易系统策略实现逻辑说明</p>
        </div>

        <div class="docs-container">
          <!-- V3策略文档 -->
          <div class="strategy-doc">
            <div class="doc-header">
              <h3>V3多因子趋势策略</h3>
              <span class="strategy-badge v3">V3</span>
            </div>
            <div class="doc-content">
              <h4>策略概述</h4>
              <p>V3策略是一个基于多时间框架分析的量化交易策略，通过4H趋势判断、1H多因子评分和15M入场确认三个层次进行交易决策。</p>

              <h4>时间框架分析</h4>
              <div class="timeframe-section">
                <div class="timeframe-item">
                  <h5>高时间框架 (4H) - 趋势判断</h5>
                  <ul>
                    <li><strong>MA20/MA50交叉</strong>：判断趋势方向，金叉为上升，死叉为下跌</li>
                    <li><strong>ADX指标</strong>：衡量趋势强度，ADX > 25为强趋势</li>
                    <li><strong>BBW指标</strong>：布林带宽度，反映市场波动性</li>
                    <li><strong>评分机制</strong>：0-10分，综合判断趋势强度和方向</li>
                  </ul>
                </div>

                <div class="timeframe-item">
                  <h5>中时间框架 (1H) - 多因子评分</h5>
                  <ul>
                    <li><strong>VWAP方向</strong>：成交量加权平均价格方向</li>
                    <li><strong>OI变化</strong>：持仓量变化，反映资金流向</li>
                    <li><strong>资金费率</strong>：市场情绪指标</li>
                    <li><strong>Delta值</strong>：买卖压力差值</li>
                    <li><strong>评分机制</strong>：0-6分，下边界3分+VWAP方向一致才有效</li>
                  </ul>
                </div>

                <div class="timeframe-item">
                  <h5>低时间框架 (15M) - 入场确认</h5>
                  <ul>
                    <li><strong>EMA20/EMA50</strong>：短期均线确认</li>
                    <li><strong>ATR指标</strong>：平均真实波幅，用于止损计算</li>
                    <li><strong>评分机制</strong>：0-2分，确认入场时机</li>
                  </ul>
                </div>
              </div>

              <h4>交易参数计算</h4>
              <div class="calculation-section">
                <h5>止损距离计算</h5>
                <p>使用2倍ATR作为止损距离：</p>
                <ul>
                  <li>多头：<code>stopLoss = entryPrice - (ATR × 2)</code></li>
                  <li>空头：<code>stopLoss = entryPrice + (ATR × 2)</code></li>
                </ul>

                <h5>杠杆和保证金计算</h5>
                <p>严格按照文档公式计算：</p>
                <ul>
                  <li><strong>止损距离X%</strong>：<code>|entryPrice - stopLoss| / entryPrice</code></li>
                  <li><strong>最大杠杆数Y</strong>：<code>Math.floor(1 / (X% + 0.5%))</code></li>
                  <li><strong>最小保证金Z</strong>：<code>Math.ceil(M / (Y × X%))</code></li>
                </ul>
                <p>其中M为最大损失金额（默认100 USDT）</p>
              </div>

              <h4>交易信号生成</h4>
              <p>当三个时间框架都判断有效时，生成交易信号：</p>
              <ul>
                <li><strong>BUY信号</strong>：4H上升趋势 + 1H多因子有效 + 15M入场确认</li>
                <li><strong>SELL信号</strong>：4H下跌趋势 + 1H多因子有效 + 15M入场确认</li>
                <li><strong>HOLD信号</strong>：任一时间框架判断无效</li>
              </ul>
            </div>
          </div>

          <!-- ICT策略文档 -->
          <div class="strategy-doc">
            <div class="doc-header">
              <h3>ICT订单块策略</h3>
              <span class="strategy-badge ict">ICT</span>
            </div>
            <div class="doc-content">
              <h4>策略概述</h4>
              <p>ICT（Inner Circle Trader）策略基于订单块理论，通过识别机构订单区域和价格扫荡行为进行交易决策。</p>

              <h4>时间框架分析</h4>
              <div class="timeframe-section">
                <div class="timeframe-item">
                  <h5>高时间框架 (1D) - 趋势判断</h5>
                  <ul>
                    <li><strong>20日价格变化</strong>：计算20个交易日的价格变化率</li>
                    <li><strong>趋势判断</strong>：基于价格变化幅度确定趋势方向</li>
                    <li><strong>震荡市处理</strong>：震荡市不计算交易参数</li>
                  </ul>
                </div>

                <div class="timeframe-item">
                  <h5>中时间框架 (4H) - 订单块检测</h5>
                  <ul>
                    <li><strong>订单块识别</strong>：检测机构订单区域</li>
                    <li><strong>ATR计算</strong>：用于订单块有效性判断</li>
                    <li><strong>扫荡检测</strong>：检测价格是否扫荡订单块</li>
                    <li><strong>扫荡速率</strong>：计算扫荡速度，反映市场动能</li>
                  </ul>
                </div>

                <div class="timeframe-item">
                  <h5>低时间框架 (15M) - 入场确认</h5>
                  <ul>
                    <li><strong>吞没形态</strong>：检测K线吞没模式</li>
                    <li><strong>ATR指标</strong>：用于止损计算</li>
                    <li><strong>成交量分析</strong>：确认入场时机</li>
                    <li><strong>扫荡速率</strong>：低时间框架扫荡确认</li>
                  </ul>
                </div>
              </div>

              <h4>订单块理论</h4>
              <div class="theory-section">
                <h5>订单块识别</h5>
                <p>订单块是机构大单集中的价格区域，具有以下特征：</p>
                <ul>
                  <li>价格在该区域停留时间较长</li>
                  <li>成交量相对集中</li>
                  <li>后续价格突破该区域时具有较强动能</li>
                </ul>

                <h5>扫荡检测</h5>
                <p>扫荡是指价格快速穿越订单块区域的行为：</p>
                <ul>
                  <li>检测价格是否突破订单块边界</li>
                  <li>计算扫荡速率，反映市场动能强度</li>
                  <li>扫荡后价格回归为有效信号</li>
                </ul>
              </div>

              <h4>交易参数计算</h4>
              <div class="calculation-section">
                <h5>止损距离计算</h5>
                <p>同样使用2倍ATR作为止损距离，与V3策略保持一致。</p>

                <h5>杠杆和保证金计算</h5>
                <p>使用与V3策略相同的计算公式，确保风险控制一致性。</p>
              </div>

              <h4>交易信号生成</h4>
              <p>基于订单块理论和扫荡行为：</p>
              <ul>
                <li><strong>BUY信号</strong>：1D上升趋势 + 4H订单块有效 + 15M入场确认</li>
                <li><strong>SELL信号</strong>：1D下跌趋势 + 4H订单块有效 + 15M入场确认</li>
                <li><strong>HOLD信号</strong>：震荡市或任一条件不满足</li>
              </ul>
            </div>
          </div>

          <!-- 系统架构文档 -->
          <div class="strategy-doc">
            <div class="doc-header">
              <h3>系统架构说明</h3>
              <span class="strategy-badge system">系统</span>
            </div>
            <div class="doc-content">
              <h4>技术栈</h4>
              <ul>
                <li><strong>后端</strong>：Node.js + Express.js</li>
                <li><strong>数据库</strong>：MySQL 8.0</li>
                <li><strong>缓存</strong>：Redis</li>
                <li><strong>前端</strong>：原生JavaScript + HTML5 + CSS3</li>
                <li><strong>数据源</strong>：Binance API (REST + WebSocket)</li>
              </ul>

              <h4>核心组件</h4>
              <ul>
                <li><strong>策略引擎</strong>：V3和ICT策略实现</li>
                <li><strong>交易管理器</strong>：交易创建、状态管理、去重逻辑</li>
                <li><strong>数据更新器</strong>：实时数据获取和缓存</li>
                <li><strong>监控系统</strong>：系统资源监控和告警</li>
                <li><strong>通知系统</strong>：Telegram集成</li>
              </ul>

              <h4>风险控制</h4>
              <ul>
                <li><strong>交易去重</strong>：同一交易对同时只能有一个活跃交易</li>
                <li><strong>杠杆限制</strong>：最大杠杆20倍，基于止损距离动态计算</li>
                <li><strong>保证金管理</strong>：基于最大损失金额计算最小保证金</li>
                <li><strong>止损机制</strong>：基于ATR的动态止损</li>
              </ul>

              <h4>数据流程</h4>
              <ol>
                <li>从Binance API获取实时市场数据</li>
                <li>计算技术指标（MA、EMA、ADX、BBW、ATR等）</li>
                <li>执行策略逻辑判断</li>
                <li>生成交易信号和参数</li>
                <li>检查交易条件和去重逻辑</li>
                <li>创建交易记录并更新数据库</li>
                <li>发送通知和更新前端显示</li>
              </ol>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <script src="app.js"></script>
</body>

</html>