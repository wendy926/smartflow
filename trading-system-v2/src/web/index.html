<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>SmartFlow 交易策略系统</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="public/css/ai-analysis.css">
  <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    .trading-records-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      flex-wrap: wrap;
      gap: 10px;
    }

    .filter-controls {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .filter-controls label {
      font-weight: 500;
      color: #666;
      white-space: nowrap;
    }

    .filter-controls select {
      min-width: 120px;
    }

    .custom-date-range {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 8px;
      padding: 8px;
      background: #f8f9fa;
      border-radius: 4px;
      border: 1px solid #e9ecef;
    }

    .custom-date-range input[type="date"] {
      padding: 4px 8px;
      border: 1px solid #ced4da;
      border-radius: 4px;
      font-size: 13px;
    }

    .custom-date-range span {
      color: #6c757d;
      font-size: 13px;
    }

    .btn-sm {
      padding: 4px 12px;
      font-size: 12px;
      border-radius: 4px;
    }

    .chart-controls {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .chart-controls select {
      min-width: 120px;
    }

    #winRateChart {
      max-width: 100%;
      height: auto;
    }

    @media (max-width: 768px) {
      .trading-records-header {
        flex-direction: column;
        align-items: stretch;
      }

      .filter-controls {
        justify-content: center;
      }

      .custom-date-range {
        flex-direction: column;
        align-items: stretch;
        gap: 4px;
      }

      .custom-date-range input[type="date"] {
        width: 100%;
      }
    }

    /* 文档页面布局样式 */
    .docs-layout {
      display: flex;
      min-height: calc(100vh - 120px);
    }

    .doc-sidebar {
      width: 280px;
      background: #f8f9fa;
      border-right: 1px solid #e9ecef;
      position: fixed;
      left: 0;
      top: 80px;
      height: calc(100vh - 80px);
      overflow-y: auto;
      z-index: 100;
      padding: 20px 0;
    }

    .doc-sidebar-header {
      padding: 0 20px 15px;
      border-bottom: 1px solid #e9ecef;
      margin-bottom: 15px;
    }

    .doc-sidebar-header h3 {
      margin: 0;
      color: #495057;
      font-size: 16px;
    }

    .doc-sidebar-content {
      padding: 0 20px;
    }

    .doc-nav-section {
      margin-bottom: 20px;
    }

    .doc-nav-section h4 {
      margin: 0 0 10px 0;
      color: #495057;
      font-size: 14px;
      font-weight: 600;
    }

    .doc-nav-section ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .doc-nav-section li {
      margin-bottom: 5px;
    }

    .doc-nav-section a {
      display: block;
      padding: 8px 12px;
      color: #6c757d;
      text-decoration: none;
      border-radius: 4px;
      font-size: 13px;
      transition: all 0.2s ease;
    }

    .doc-nav-section a:hover {
      background: #e9ecef;
      color: #495057;
    }

    .doc-nav-section a.active {
      background: #007bff;
      color: white;
    }

    .docs-main {
      flex: 1;
      margin-left: 280px;
      padding: 20px 40px;
      max-width: calc(100% - 280px);
    }

    .docs-container {
      max-width: 1000px;
    }

    @media (max-width: 1024px) {
      .doc-sidebar {
        width: 240px;
      }

      .docs-main {
        margin-left: 240px;
        max-width: calc(100% - 240px);
      }
    }

    @media (max-width: 768px) {
      .docs-layout {
        flex-direction: column;
      }

      .doc-sidebar {
        position: relative;
        width: 100%;
        height: auto;
        top: 0;
        left: 0;
        border-right: none;
        border-bottom: 1px solid #e9ecef;
      }

      .docs-main {
        margin-left: 0;
        max-width: 100%;
        padding: 20px;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <!-- 头部导航 -->
    <header class="header">
      <div class="logo">
        <i class="fas fa-chart-line"></i>
        <h1>SmartFlow</h1>
      </div>
      <nav class="nav">
        <a href="/dashboard" class="nav-link active" data-tab="dashboard">
          <i class="fas fa-tachometer-alt"></i>
          仪表板
        </a>
        <a href="/strategies" class="nav-link" data-tab="strategies">
          <i class="fas fa-chess"></i>
          策略执行
        </a>
        <a href="/statistics" class="nav-link" data-tab="statistics">
          <i class="fas fa-chart-bar"></i>
          胜率统计
        </a>
        <a href="/tools" class="nav-link" data-tab="tools">
          <i class="fas fa-tools"></i>
          工具
        </a>
        <a href="/smart-money" class="nav-link" data-tab="smart-money">
          <i class="fas fa-money-bill-trend-up"></i>
          💰 聪明钱
        </a>
        <a href="/large-orders" class="nav-link" data-tab="large-orders">
          <i class="fas fa-layer-group"></i>
          📊 大额挂单
        </a>
        <a href="/monitoring" class="nav-link" data-tab="monitoring">
          <i class="fas fa-monitor-heart-rate"></i>
          系统监控
        </a>
        <a href="/docs" class="nav-link" data-tab="docs">
          <i class="fas fa-book"></i>
          文档
        </a>
      </nav>
    </header>

    <!-- 主要内容区域 -->
    <main class="main-content">
      <!-- 仪表板 -->
      <div id="dashboard" class="tab-content active">
        <div class="page-header">
          <h2>交易策略仪表板</h2>
          <div class="status-indicators">
            <div class="status-item">
              <span class="status-label">系统状态</span>
              <span class="status-value status-online">在线</span>
            </div>
            <div class="status-item">
              <span class="status-label">最后更新</span>
              <span class="status-value" id="lastUpdate">--</span>
            </div>
          </div>
        </div>

        <!-- 宏观监控数据卡片 -->
        <div class="macro-monitoring-section">
          <div class="card">
            <div class="card-header">
              <h3>宏观数据监控</h3>
              <div class="card-actions">
                <button class="btn btn-secondary" id="refreshMacroData">
                  <i class="fas fa-sync-alt"></i>
                  刷新
                </button>
              </div>
            </div>
            <div class="card-content">
              <div class="macro-cards-grid">
                <!-- 资金流监控链接 -->
                <div class="macro-card" id="fundFlowCard">
                  <div class="macro-card-header">
                    <div class="macro-card-icon">
                      <i class="fas fa-coins"></i>
                    </div>
                    <div class="macro-card-title">
                      <h4>资金流监控</h4>
                      <span class="macro-card-subtitle">链上大额资金流 & 市场数据</span>
                    </div>
                  </div>
                  <div class="macro-card-content">
                    <div class="macro-metric" style="flex-direction: column; align-items: center; padding: 20px 0;">
                      <a href="https://www.coinglass.com/zh" target="_blank" class="external-link-button"
                        style="display: inline-flex; align-items: center; gap: 8px; padding: 12px 24px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; text-decoration: none; border-radius: 8px; font-weight: 500; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);">
                        <i class="fas fa-external-link-alt"></i>
                        <span>访问 CoinGlass 数据平台</span>
                      </a>
                      <p style="margin-top: 12px; font-size: 13px; color: #6c757d; text-align: center;">
                        查看实时资金费率、爆仓数据、持仓量等市场指标
                      </p>
                    </div>
                  </div>
                </div>

                <!-- 市场情绪监控卡片 -->
                <div class="macro-card" id="sentimentCard">
                  <div class="macro-card-header">
                    <div class="macro-card-icon">
                      <i class="fas fa-brain"></i>
                    </div>
                    <div class="macro-card-title">
                      <h4>市场情绪</h4>
                      <span class="macro-card-subtitle">恐惧贪婪指数</span>
                    </div>
                  </div>
                  <div class="macro-card-content">
                    <div class="macro-metric">
                      <span class="macro-metric-label">当前指数</span>
                      <span class="macro-metric-value" id="fearGreedIndex">--</span>
                    </div>
                    <div class="macro-metric">
                      <span class="macro-metric-label">情绪状态</span>
                      <span class="macro-metric-value" id="sentimentState">--</span>
                    </div>
                    <div class="macro-status" id="sentimentStatus">
                      <span class="status-indicator status-normal">正常</span>
                    </div>
                  </div>
                </div>

                <!-- 合约市场监控链接 -->
                <div class="macro-card" id="futuresCard">
                  <div class="macro-card-header">
                    <div class="macro-card-icon">
                      <i class="fas fa-chart-area"></i>
                    </div>
                    <div class="macro-card-title">
                      <h4>合约市场</h4>
                      <span class="macro-card-subtitle">多空比 & 资金费率 & 爆仓数据</span>
                    </div>
                  </div>
                  <div class="macro-card-content">
                    <div class="macro-metric" style="flex-direction: column; align-items: center; padding: 20px 0;">
                      <a href="https://www.coinglass.com/zh" target="_blank" class="external-link-button"
                        style="display: inline-flex; align-items: center; gap: 8px; padding: 12px 24px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; text-decoration: none; border-radius: 8px; font-weight: 500; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);">
                        <i class="fas fa-external-link-alt"></i>
                        <span>访问 CoinGlass 数据平台</span>
                      </a>
                      <p style="margin-top: 12px; font-size: 13px; color: #6c757d; text-align: center;">
                        查看实时多空比、资金费率、爆仓数据、持仓量等合约市场指标
                      </p>
                    </div>
                  </div>
                </div>

                <!-- 宏观指标监控卡片 -->
                <div class="macro-card" id="macroCard">
                  <div class="macro-card-header">
                    <div class="macro-card-icon">
                      <i class="fas fa-globe-americas"></i>
                    </div>
                    <div class="macro-card-title">
                      <h4>宏观指标</h4>
                      <span class="macro-card-subtitle">利率 & 通胀率</span>
                    </div>
                  </div>
                  <div class="macro-card-content">
                    <div class="macro-metric">
                      <span class="macro-metric-label">美联储利率</span>
                      <span class="macro-metric-value" id="fedFundsRate">--</span>
                    </div>
                    <div class="macro-metric">
                      <span class="macro-metric-label">CPI通胀率</span>
                      <span class="macro-metric-value" id="cpiRate">--</span>
                    </div>
                    <div class="macro-status" id="macroStatus">
                      <span class="status-indicator status-normal">正常</span>
                    </div>
                  </div>
                </div>

              </div>
            </div>
          </div>
        </div>

        <!-- AI市场分析 -->
        <div class="ai-macro-section">
          <div class="card">
            <div class="card-header">
              <h3>AI市场风险分析</h3>
              <div class="card-actions">
                <span class="status-item" style="margin-right: 15px;">
                  <span class="status-label">最后更新:</span>
                  <span class="status-value" id="aiLastUpdate">--</span>
                </span>
                <button class="btn btn-primary" id="refreshAIAnalysis" title="刷新AI分析">
                  <i class="fas fa-sync-alt"></i>
                  刷新
                </button>
              </div>
            </div>
            <div class="card-content">
              <div id="aiMacroAnalysis">
                <p class="no-data">正在加载AI分析...</p>
              </div>
            </div>
          </div>
        </div>

        <!-- 策略当前状态表格 -->
        <div class="card">
          <div class="card-header">
            <h3>策略当前状态</h3>
            <div class="card-actions">
              <div class="signal-filter" style="display: flex; gap: 10px; align-items: center;">
                <label for="signalFilter">策略信号:</label>
                <select id="signalFilter" class="form-select">
                  <option value="all">全部</option>
                  <option value="entry">入场 (BUY/SELL)</option>
                  <option value="watch">观望 (WATCH/HOLD)</option>
                </select>
              </div>
              <div class="ai-signal-filter" style="display: flex; gap: 10px; align-items: center;">
                <label for="aiSignalFilter">AI信号:</label>
                <select id="aiSignalFilter" class="form-select">
                  <option value="all">全部</option>
                  <option value="strongBuy">强烈看多</option>
                  <option value="mediumBuy">看多</option>
                  <option value="holdBullish">持有偏多</option>
                  <option value="hold">持有观望</option>
                  <option value="holdBearish">持有偏空</option>
                  <option value="strongSell">强烈看跌</option>
                </select>
              </div>
              <div class="risk-selector">
                <label for="maxLossAmount">最大损失:</label>
                <select id="maxLossAmount" class="form-select">
                  <option value="20">20 USDT</option>
                  <option value="50">50 USDT</option>
                  <option value="100" selected>100 USDT</option>
                  <option value="200">200 USDT</option>
                </select>
              </div>
              <button class="btn btn-primary" id="refreshStrategyStatus">
                <i class="fas fa-sync-alt"></i>
                刷新
              </button>
            </div>
          </div>
          <div class="card-content">
            <div class="table-container">
              <table class="data-table" id="strategyStatusTable">
                <thead>
                  <tr>
                    <th>交易对</th>
                    <th>当前价格</th>
                    <th>策略</th>
                    <th>趋势</th>
                    <th>信号</th>
                    <th>高时间框架<br />趋势判断</th>
                    <th>中时间框架<br />多因子/OB区</th>
                    <th>低时间框架<br />入场判断</th>
                    <th>AI分析</th>
                    <th>入场价格</th>
                    <th>止损价格</th>
                    <th>止盈价格</th>
                    <th>杠杆</th>
                    <th>保证金</th>
                  </tr>
                </thead>
                <tbody id="strategyStatusTableBody">
                  <!-- 数据将通过JavaScript动态加载 -->
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- 仪表板页面只展示宏观监控和策略当前状态 -->
      </div>

      <!-- 策略执行页面 -->
      <div id="strategies" class="tab-content">
        <div class="page-header">
          <h2>策略执行与记录</h2>
          <div class="strategy-tabs">
            <button class="strategy-tab active" data-strategy="v3">Strategy V3</button>
            <button class="strategy-tab" data-strategy="ict">ICT Strategy</button>
          </div>
        </div>


        <div class="strategy-content">
          <!-- Strategy V3 内容 -->
          <div id="v3-content" class="strategy-panel active">
            <div class="strategy-info">
              <h3>Strategy V3 - 多因子趋势策略</h3>
              <p>基于4H趋势判断、1H因子分析和15M入场信号的综合策略</p>
            </div>

            <!-- V3策略交易记录表格 -->
            <div class="trading-records">
              <div class="trading-records-header">
                <h3>V3策略交易记录</h3>
                <div class="filter-controls">
                  <label for="v3StatusFilter">状态筛选:</label>
                  <select id="v3StatusFilter" class="form-select">
                    <option value="all">全部</option>
                    <option value="OPEN">进行中</option>
                    <option value="CLOSED">已平仓</option>
                  </select>
                  <label for="v3DateFilter">日期筛选:</label>
                  <select id="v3DateFilter" class="form-select">
                    <option value="all">全部</option>
                    <option value="today">今天</option>
                    <option value="yesterday">昨天</option>
                    <option value="week">最近7天</option>
                    <option value="month">最近30天</option>
                    <option value="custom">自定义</option>
                  </select>
                  <div id="v3CustomDateRange" class="custom-date-range" style="display: none;">
                    <input type="date" id="v3StartDate" class="form-input">
                    <span>至</span>
                    <input type="date" id="v3EndDate" class="form-input">
                    <button id="v3ApplyCustomDate" class="btn btn-sm btn-primary">应用</button>
                  </div>
                </div>
              </div>
              <div class="table-container">
                <table class="data-table" id="v3TradingRecordsTable">
                  <thead>
                    <tr>
                      <th>交易对</th>
                      <th>策略</th>
                      <th>方向</th>
                      <th>入场判断逻辑</th>
                      <th>入场时间</th>
                      <th>入场价格</th>
                      <th>止盈价格</th>
                      <th>止损价格</th>
                      <th>杠杆</th>
                      <th>保证金</th>
                      <th>状态</th>
                      <th>出场价格</th>
                      <th>出场原因</th>
                      <th>盈亏结果</th>
                      <th>盈亏金额</th>
                      <th>最大回撤</th>
                    </tr>
                  </thead>
                  <tbody id="v3-trades-body">
                    <!-- 数据将通过JavaScript动态加载 -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- ICT Strategy 内容 -->
          <div id="ict-content" class="strategy-panel">
            <div class="strategy-info">
              <h3>ICT Strategy - 订单块策略</h3>
              <p>基于订单块、流动性扫荡和吞没形态的ICT概念策略</p>
            </div>

            <!-- ICT策略交易记录表格 -->
            <div class="trading-records">
              <div class="trading-records-header">
                <h3>ICT策略交易记录</h3>
                <div class="filter-controls">
                  <label for="ictStatusFilter">状态筛选:</label>
                  <select id="ictStatusFilter" class="form-select">
                    <option value="all">全部</option>
                    <option value="OPEN">进行中</option>
                    <option value="CLOSED">已平仓</option>
                  </select>
                  <label for="ictDateFilter">日期筛选:</label>
                  <select id="ictDateFilter" class="form-select">
                    <option value="all">全部</option>
                    <option value="today">今天</option>
                    <option value="yesterday">昨天</option>
                    <option value="week">最近7天</option>
                    <option value="month">最近30天</option>
                    <option value="custom">自定义</option>
                  </select>
                  <div id="ictCustomDateRange" class="custom-date-range" style="display: none;">
                    <input type="date" id="ictStartDate" class="form-input">
                    <span>至</span>
                    <input type="date" id="ictEndDate" class="form-input">
                    <button id="ictApplyCustomDate" class="btn btn-sm btn-primary">应用</button>
                  </div>
                </div>
              </div>
              <div class="table-container">
                <table class="data-table" id="ictTradingRecordsTable">
                  <thead>
                    <tr>
                      <th>交易对</th>
                      <th>策略</th>
                      <th>方向</th>
                      <th>入场判断逻辑</th>
                      <th>入场时间</th>
                      <th>入场价格</th>
                      <th>止盈价格</th>
                      <th>止损价格</th>
                      <th>杠杆</th>
                      <th>保证金</th>
                      <th>状态</th>
                      <th>出场价格</th>
                      <th>出场原因</th>
                      <th>盈亏结果</th>
                      <th>盈亏金额</th>
                      <th>最大回撤</th>
                    </tr>
                  </thead>
                  <tbody id="ict-trades-body">
                    <!-- 数据将通过JavaScript动态加载 -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>


        </div>
      </div>

      <!-- 系统监控页面 -->
      <div id="monitoring" class="tab-content">
        <div class="page-header">
          <h2>系统监控</h2>
          <div class="monitoring-controls">
            <button class="btn btn-primary" id="refreshMonitoringBtn">
              <i class="fas fa-sync-alt"></i>
              刷新监控
            </button>
          </div>
        </div>

        <div class="monitoring-grid">
          <div class="card">
            <div class="card-header">
              <h3>系统资源</h3>
            </div>
            <div class="card-content">
              <div class="resource-item">
                <span class="resource-label">CPU使用率</span>
                <div class="progress-bar">
                  <div class="progress-fill" style="width: 35%"></div>
                </div>
                <span class="resource-value">35%</span>
              </div>
              <div class="resource-item">
                <span class="resource-label">内存使用率</span>
                <div class="progress-bar">
                  <div class="progress-fill" style="width: 68%"></div>
                </div>
                <span class="resource-value">68%</span>
              </div>
              <div class="resource-item">
                <span class="resource-label">磁盘使用率</span>
                <div class="progress-bar">
                  <div class="progress-fill" style="width: 45%"></div>
                </div>
                <span class="resource-value">45%</span>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h3>API状态</h3>
            </div>
            <div class="card-content">
              <div class="api-status">
                <div class="api-item">
                  <div class="api-info">
                    <span class="api-name">Binance REST API</span>
                    <span class="api-detail">总请求: 0 | 失败: 0</span>
                  </div>
                  <span class="api-status-value status-online">正常 (100%)</span>
                </div>
                <div class="api-item">
                  <div class="api-info">
                    <span class="api-name">Binance WebSocket</span>
                    <span class="api-detail">活跃连接: 0 | 失败: 0</span>
                  </div>
                  <span class="api-status-value status-online">正常 (100%)</span>
                </div>
                <div class="api-item">
                  <div class="api-info">
                    <span class="api-name">数据库连接</span>
                  </div>
                  <span class="api-status-value status-online">正常</span>
                </div>
                <div class="api-item">
                  <div class="api-info">
                    <span class="api-name">Redis缓存</span>
                  </div>
                  <span class="api-status-value status-online">正常</span>
                </div>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h3>策略执行状态</h3>
            </div>
            <div class="card-content">
              <div class="strategy-status">
                <div class="strategy-status-item">
                  <span class="strategy-name">Strategy V3</span>
                  <span class="strategy-status-value status-running">运行中</span>
                </div>
                <div class="strategy-status-item">
                  <span class="strategy-name">ICT Strategy</span>
                  <span class="strategy-status-value status-running">运行中</span>
                </div>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h3>🤖 AI分析状态</h3>
            </div>
            <div class="card-content">
              <div class="ai-analysis-status">
                <!-- 宏观风险分析 -->
                <div class="ai-status-item">
                  <div class="ai-status-header">
                    <span class="ai-status-name">宏观风险分析</span>
                    <span class="ai-status-badge" id="macro-ai-status">--</span>
                  </div>
                  <div class="ai-status-details">
                    <div class="ai-detail-row">
                      <span class="ai-detail-label">覆盖交易对:</span>
                      <span class="ai-detail-value" id="macro-ai-symbols">--</span>
                    </div>
                    <div class="ai-detail-row">
                      <span class="ai-detail-label">最后更新:</span>
                      <span class="ai-detail-value" id="macro-ai-updated">--</span>
                    </div>
                    <div class="ai-detail-row">
                      <span class="ai-detail-label">成功率:</span>
                      <span class="ai-detail-value" id="macro-ai-success-rate">--</span>
                    </div>
                    <div class="ai-detail-row">
                      <span class="ai-detail-label">下次更新:</span>
                      <span class="ai-detail-value" id="macro-ai-next">--</span>
                    </div>
                  </div>
                </div>

                <!-- 交易对趋势分析 -->
                <div class="ai-status-item">
                  <div class="ai-status-header">
                    <span class="ai-status-name">交易对趋势分析</span>
                    <span class="ai-status-badge" id="symbol-ai-status">--</span>
                  </div>
                  <div class="ai-status-details">
                    <div class="ai-detail-row">
                      <span class="ai-detail-label">监控交易对数:</span>
                      <span class="ai-detail-value" id="symbol-ai-count">--</span>
                    </div>
                    <div class="ai-detail-row">
                      <span class="ai-detail-label">最后更新:</span>
                      <span class="ai-detail-value" id="symbol-ai-updated">--</span>
                    </div>
                    <div class="ai-detail-row">
                      <span class="ai-detail-label">成功率:</span>
                      <span class="ai-detail-value" id="symbol-ai-success-rate">--</span>
                    </div>
                    <div class="ai-detail-row">
                      <span class="ai-detail-label">下次更新:</span>
                      <span class="ai-detail-value" id="symbol-ai-next">--</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- 胜率统计页面 -->
      <div id="statistics" class="tab-content">
        <div class="page-header">
          <h2>交易对胜率统计</h2>
          <div class="statistics-controls">
            <select class="form-select" id="strategySelect">
              <option value="all">所有策略</option>
              <option value="v3">Strategy V3</option>
              <option value="ict">ICT Strategy</option>
            </select>
            <select class="form-select" id="timeframeSelect">
              <option value="all">所有时间周期</option>
              <option value="1d">1天</option>
              <option value="4h">4小时</option>
              <option value="1h">1小时</option>
              <option value="15m">15分钟</option>
            </select>
          </div>
        </div>

        <!-- 总体统计和策略对比（置顶显示） -->
        <div class="statistics-grid">
          <div class="card">
            <div class="card-header">
              <h3>总体统计</h3>
            </div>
            <div class="card-content">
              <div class="stat-item">
                <span class="stat-label">总交易数</span>
                <span class="stat-value" id="overall-total-trades">--</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">胜率</span>
                <span class="stat-value" id="overall-win-rate">--</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">总盈亏</span>
                <span class="stat-value" id="overall-total-pnl">--</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">最大回撤</span>
                <span class="stat-value" id="overall-max-drawdown">--</span>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h3>策略对比</h3>
            </div>
            <div class="card-content">
              <div class="strategy-comparison">
                <div class="comparison-item">
                  <span class="comparison-name">Strategy V3</span>
                  <div class="comparison-bar">
                    <div class="comparison-fill" id="v3-comparison-bar" style="width: 0%"></div>
                  </div>
                  <span class="comparison-value" id="v3-comparison-value">0%</span>
                </div>
                <div class="comparison-item">
                  <span class="comparison-name">ICT Strategy</span>
                  <div class="comparison-bar">
                    <div class="comparison-fill" id="ict-comparison-bar" style="width: 0%"></div>
                  </div>
                  <span class="comparison-value" id="ict-comparison-value">0%</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 策略统计卡片 -->
        <div class="cards-grid">
          <div class="card stats-card" id="v3-stats">
            <div class="card-header">
              <h3>V3策略统计</h3>
            </div>
            <div class="card-content">
              <div class="stats-grid">
                <div class="stat-item">
                  <span class="stat-label">总交易数</span>
                  <span class="stat-value" id="v3-total-trades">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">盈利交易</span>
                  <span class="stat-value" id="v3-winning-trades">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">亏损交易</span>
                  <span class="stat-value" id="v3-losing-trades">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">胜率</span>
                  <span class="stat-value" id="v3-win-rate">0%</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">总盈亏</span>
                  <span class="stat-value" id="v3-total-pnl">$0.00</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">最大回撤</span>
                  <span class="stat-value" id="v3-max-drawdown">0%</span>
                </div>
              </div>
            </div>
          </div>

          <div class="card stats-card" id="ict-stats">
            <div class="card-header">
              <h3>ICT策略统计</h3>
            </div>
            <div class="card-content">
              <div class="stats-grid">
                <div class="stat-item">
                  <span class="stat-label">总交易数</span>
                  <span class="stat-value" id="ict-total-trades">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">盈利交易</span>
                  <span class="stat-value" id="ict-winning-trades">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">亏损交易</span>
                  <span class="stat-value" id="ict-losing-trades">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">胜率</span>
                  <span class="stat-value" id="ict-win-rate">0%</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">总盈亏</span>
                  <span class="stat-value" id="ict-total-pnl">$0.00</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">最大回撤</span>
                  <span class="stat-value" id="ict-max-drawdown">0%</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 胜率变化趋势表格 -->
        <div class="card">
          <div class="card-header">
            <h3>胜率变化趋势</h3>
            <div class="chart-controls">
              <select id="chartTimeframe" class="form-select">
                <option value="daily">日级别</option>
                <option value="weekly">周级别</option>
              </select>
              <select id="chartPeriod" class="form-select">
                <option value="7">最近7天/周</option>
                <option value="14">最近14天/周</option>
                <option value="30">最近30天/周</option>
              </select>
            </div>
          </div>
          <div class="card-content">
            <div id="winRateTableContainer">
              <!-- 胜率趋势表格将在这里动态生成 -->
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h3>交易对详细统计</h3>
          </div>
          <div class="card-content">
            <div class="table-container">
              <table class="data-table" id="statisticsTable">
                <thead>
                  <tr>
                    <th>交易对</th>
                    <th>策略</th>
                    <th>时间周期</th>
                    <th>交易数</th>
                    <th>胜率</th>
                    <th>盈亏</th>
                    <th>夏普比率</th>
                  </tr>
                </thead>
                <tbody id="statisticsTableBody">
                  <!-- 数据将通过JavaScript动态加载 -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>


      <!-- 工具页面 -->
      <div id="tools" class="tab-content">
        <div class="page-header">
          <h2>交易工具</h2>
        </div>

        <div class="tools-grid">
          <div class="card">
            <div class="card-header">
              <h3>动态杠杆滚仓计算器</h3>
            </div>
            <div class="card-content">
              <div class="calculator-form">
                <div class="form-row">
                  <div class="form-group">
                    <label>本金 (USDT)</label>
                    <input type="number" id="principal" placeholder="200" class="form-input" value="200">
                  </div>
                  <div class="form-group">
                    <label>初始杠杆</label>
                    <input type="number" id="initialLeverage" placeholder="50" class="form-input" value="50">
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group">
                    <label>开仓价格</label>
                    <input type="number" id="priceStart" placeholder="4700" class="form-input" value="4700">
                  </div>
                  <div class="form-group">
                    <label>目标价格</label>
                    <input type="number" id="priceTarget" placeholder="5200" class="form-input" value="5200">
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group">
                    <label>滚仓触发比例</label>
                    <input type="number" id="triggerRatio" placeholder="1.0" step="0.1" class="form-input" value="1.0">
                  </div>
                  <div class="form-group">
                    <label>杠杆递减系数</label>
                    <input type="number" id="leverageDecay" placeholder="0.5" step="0.1" class="form-input" value="0.5">
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group">
                    <label>利润锁定比例</label>
                    <input type="number" id="profitLockRatio" placeholder="0.5" step="0.1" class="form-input"
                      value="0.5">
                  </div>
                  <div class="form-group">
                    <label>最低杠杆</label>
                    <input type="number" id="minLeverage" placeholder="5" class="form-input" value="5">
                  </div>
                </div>
                <button class="btn btn-primary" id="calculateRollingBtn">计算动态滚仓</button>
              </div>
              <div class="calculator-result" id="rollingResult">
                <!-- 计算结果将显示在这里 -->
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h3>保证金和杠杆计算器</h3>
            </div>
            <div class="card-content">
              <div class="calculator-form">
                <div class="form-row">
                  <div class="form-group">
                    <label>单笔最大损失金额 (USDT)</label>
                    <input type="number" id="maxLossAmount" placeholder="100" class="form-input" value="100">
                  </div>
                  <div class="form-group">
                    <label>开仓价格 (USDT)</label>
                    <input type="number" id="entryPrice" placeholder="50000" step="0.01" class="form-input"
                      value="50000">
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group">
                    <label>止损价格 (USDT)</label>
                    <input type="number" id="stopLossPrice" placeholder="48000" step="0.01" class="form-input"
                      value="48000">
                  </div>
                  <div class="form-group">
                    <label>止盈价格 (USDT)</label>
                    <input type="number" id="takeProfitPrice" placeholder="52000" step="0.01" class="form-input"
                      value="52000">
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group">
                    <label>交易方向</label>
                    <select id="tradeDirection" class="form-input">
                      <option value="long">多头 (Long)</option>
                      <option value="short">空头 (Short)</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <button class="btn btn-primary" id="calculateMarginBtn">计算保证金和杠杆</button>
                  </div>
                </div>
              </div>
              <div class="calculator-result" id="marginResult" style="display: none;">
                <h4>计算结果</h4>
                <div class="result-grid">
                  <div class="result-item">
                    <label>止损距离:</label>
                    <span id="stopLossDistance">--</span>
                  </div>
                  <div class="result-item">
                    <label>最大杠杆:</label>
                    <span id="maxLeverage">--</span>
                  </div>
                  <div class="result-item">
                    <label>最小保证金:</label>
                    <span id="minMargin">--</span>
                  </div>
                  <div class="result-item">
                    <label>盈亏比:</label>
                    <span id="riskRewardRatio">--</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h3>Telegram监控设置</h3>
            </div>
            <div class="card-content">
              <div class="telegram-settings">
                <!-- 交易触发Telegram设置 -->
                <div class="telegram-section">
                  <h4>交易触发通知</h4>
                  <div class="form-group">
                    <label>Bot Token</label>
                    <input type="text" id="tradingTelegramBotToken" placeholder="123456789:ABCdefGHIjklMNOpqrsTUVwxyz"
                      class="form-input">
                  </div>
                  <div class="form-group">
                    <label>Chat ID</label>
                    <input type="text" id="tradingTelegramChatId" placeholder="123456789" class="form-input">
                  </div>
                  <div class="form-group">
                    <button class="btn btn-primary" id="saveTradingTelegramBtn">保存设置</button>
                    <button class="btn btn-secondary" id="testTradingTelegramBtn">测试连接</button>
                  </div>
                  <div class="telegram-status" id="tradingTelegramStatus">
                    <!-- 状态将通过JavaScript动态加载 -->
                  </div>
                </div>

                <!-- 系统监控Telegram设置 -->
                <div class="telegram-section">
                  <h4>系统监控告警</h4>
                  <div class="form-group">
                    <label>Bot Token</label>
                    <input type="text" id="monitoringTelegramBotToken"
                      placeholder="123456789:ABCdefGHIjklMNOpqrsTUVwxyz" class="form-input">
                  </div>
                  <div class="form-group">
                    <label>Chat ID</label>
                    <input type="text" id="monitoringTelegramChatId" placeholder="123456789" class="form-input">
                  </div>
                  <div class="form-group">
                    <button class="btn btn-primary" id="saveMonitoringTelegramBtn">保存设置</button>
                    <button class="btn btn-secondary" id="testMonitoringTelegramBtn">测试连接</button>
                  </div>
                  <div class="telegram-status" id="monitoringTelegramStatus">
                    <!-- 状态将通过JavaScript动态加载 -->
                  </div>
                </div>


              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h3>系统测试API</h3>
              <div class="card-actions">
                <button class="btn btn-primary" id="runAllAPITestsBtn">运行所有测试</button>
              </div>
            </div>
            <div class="card-content">
              <div class="api-test">
                <div class="test-group">
                  <button class="btn btn-secondary" data-test="health">健康检查</button>
                  <button class="btn btn-secondary" data-test="symbols">交易对API</button>
                  <button class="btn btn-secondary" data-test="strategies">策略状态API</button>
                  <button class="btn btn-secondary" data-test="trades">交易记录API</button>
                </div>
                <div class="test-group">
                  <button class="btn btn-secondary" data-test="monitoring">系统监控API</button>
                  <button class="btn btn-secondary" data-test="tools">工具API</button>
                  <button class="btn btn-secondary" data-test="telegram">Telegram API</button>
                  <button class="btn btn-secondary" data-test="v3-analyze">V3策略分析</button>
                </div>
                <div class="test-group">
                  <button class="btn btn-secondary" data-test="ict-analyze">ICT策略分析</button>
                  <button class="btn btn-secondary" data-test="create-trade">创建交易</button>
                </div>
                <div class="test-result" id="apiTestResult">
                  <!-- API测试结果将显示在这里 -->
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- 聪明钱跟踪页面 -->
      <div id="smart-money" class="tab-content">
        <div class="page-header">
          <h2>💰 聪明钱跟踪</h2>
          <button class="btn btn-primary" id="refresh-smart-money-btn">
            <i class="fas fa-sync-alt"></i>
            刷新数据
          </button>
        </div>

        <div class="smart-money-container">
          <!-- 添加监控交易对 -->
          <div class="card add-symbol-section">
            <div class="card-header">
              <h3>添加监控交易对</h3>
            </div>
            <div class="card-content">
              <div class="add-symbol-form">
                <input type="text" id="new-symbol-input" placeholder="例如: ADAUSDT" class="form-input" />
                <button id="add-symbol-btn" class="btn btn-success">
                  <i class="fas fa-plus"></i> 添加
                </button>
              </div>
              <p style="font-size: 12px; color: #666; margin-top: 10px;">
                💡 提示：默认监控 BTCUSDT、ETHUSDT、SOLUSDT，每15分钟自动更新
              </p>
            </div>
          </div>

          <!-- 监控结果展示 -->
          <div class="card smart-money-results">
            <div class="card-header">
              <h3>实时监控结果 <span id="sm-last-update" class="last-update"></span></h3>
            </div>
            <div class="card-content">
              <div id="smart-money-table-container">
                <table id="smart-money-table" class="data-table">
                  <thead>
                    <tr>
                      <th>交易对</th>
                      <th>当前价格</th>
                      <th>庄家动作</th>
                      <th>置信度</th>
                      <th>OBI</th>
                      <th>CVD</th>
                      <th>OI变化</th>
                      <th>成交量</th>
                      <th>趋势</th>
                      <th>原因</th>
                      <th>操作</th>
                    </tr>
                  </thead>
                  <tbody id="smart-money-tbody">
                    <tr>
                      <td colspan="11" class="loading">加载中...</td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <div class="smart-money-legend"
                style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 6px;">
                <h4 style="margin: 0 0 10px 0; font-size: 14px;">庄家动作说明（严格四象限模型）：</h4>
                <div
                  style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 10px; font-size: 12px;">
                  <div><span class="badge badge-accumulate">吸筹</span> 价格横盘/小跌 + CVD↑ + OI↑</div>
                  <div><span class="badge badge-markup">拉升</span> 价格上行 + CVD↑ + OI↑</div>
                  <div><span class="badge badge-distribution">派发</span> 价格横盘/小涨 + CVD↓ + OI↑</div>
                  <div><span class="badge badge-markdown">砸盘</span> 价格下行 + CVD↓ + OI↓</div>
                  <div><span class="badge badge-none">无动作</span> 不符合四象限条件</div>
                </div>
                <p style="margin-top: 10px; font-size: 11px; color: #666;">
                  💡 说明：必须同时满足价格、CVD、OI三个条件才判定为庄家动作，否则显示"无动作"
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>

        <!-- 大额挂单监控页面 (V2.1.2 - 7天历史视图) -->
        <div id="large-orders" class="tab-content">
          <div class="page-header">
            <h2>📊 大额挂单监控（7天历史累计）</h2>
            <button class="btn btn-primary" id="refresh-large-orders-btn">
              <i class="fas fa-sync-alt"></i>
              刷新数据
            </button>
          </div>

          <div class="large-orders-container">
            <!-- 历史视图双面板（BTCUSDT | ETHUSDT） -->
            <div id="large-order-summary-content">
              <div class="loading">加载7天历史数据中...</div>
          </div>
        </div>
      </div>

      <!-- 文档页面 -->
      <div id="docs" class="tab-content">
        <div class="docs-layout">
          <!-- 左侧固定目录栏 -->
          <div class="doc-sidebar">
            <div class="doc-sidebar-header">
              <h3>📖 文档目录</h3>
            </div>
            <div class="doc-sidebar-content">
              <div class="doc-nav-section">
                <h4>📊 宏观数据监控</h4>
                <ul>
                  <li><a href="#macro-overview">监控概述</a></li>
                  <li><a href="#fund-flow">资金流监控</a></li>
                  <li><a href="#market-sentiment">市场情绪监控</a></li>
                  <li><a href="#futures-market">合约市场监控</a></li>
                  <li><a href="#macro-indicators">宏观指标监控</a></li>
                  <li><a href="#monitoring-config">监控配置</a></li>
                </ul>
              </div>
              <div class="doc-nav-section">
                <h4>🤖 AI辅助分析 (NEW)</h4>
                <ul>
                  <li><a href="#ai-overview">AI分析概述</a></li>
                  <li><a href="#ai-scoring">评分逻辑说明</a></li>
                  <li><a href="#ai-data-source">数据来源</a></li>
                  <li><a href="#ai-update-frequency">更新频率</a></li>
                </ul>
              </div>
              <div class="doc-nav-section">
                <h4>🎯 交易策略</h4>
                <ul>
                  <li><a href="#v3-strategy">V3.1多因子趋势策略</a></li>
                  <li><a href="#ict-strategy">ICT订单块策略</a></li>
                </ul>
              </div>
              <div class="doc-nav-section">
                <h4>💰 聪明钱监控 (V2.1)</h4>
                <ul>
                  <li><a href="#smart-money-overview">监控概述</a></li>
                  <li><a href="#smart-money-indicators">核心指标</a></li>
                  <li><a href="#smart-money-actions">庄家动作</a></li>
                  <li><a href="#smart-money-traps">诱多诱空</a></li>
                </ul>
              </div>
              <div class="doc-nav-section">
                <h4>📊 大额挂单 (V2.1)</h4>
                <ul>
                  <li><a href="#large-orders-overview">监控概述</a></li>
                  <li><a href="#large-orders-tracking">挂单追踪</a></li>
                  <li><a href="#large-orders-swan">黑天鹅检测</a></li>
                  <li><a href="#large-orders-history">7天历史</a></li>
                </ul>
              </div>
              <div class="doc-nav-section">
                <h4>💰 风险管理</h4>
                <ul>
                  <li><a href="#position-calculation">动态仓位计算</a></li>
                  <li><a href="#leverage-calculation">杠杆与保证金</a></li>
                  <li><a href="#max-loss-settings">最大损失金额设置</a></li>
                </ul>
              </div>
              <div class="doc-nav-section">
                <h4>⚙️ 系统架构</h4>
                <ul>
                  <li><a href="#tech-stack">技术栈</a></li>
                  <li><a href="#core-components">核心组件</a></li>
                  <li><a href="#risk-control">风险控制</a></li>
                  <li><a href="#data-flow">数据流程</a></li>
                </ul>
              </div>
            </div>
          </div>

          <!-- 右侧文档内容区域 -->
          <div class="docs-main">
            <div class="page-header">
              <h2>策略文档</h2>
              <p>SmartFlow交易系统策略实现逻辑说明</p>
            </div>

            <div class="docs-container">
              <!-- AI辅助分析文档 (NEW) -->
              <div class="strategy-doc" id="ai-overview">
                <div class="doc-header">
                  <h3>🤖 AI辅助分析系统</h3>
                  <span class="strategy-badge"
                    style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">NEW</span>
                </div>
                <div class="doc-content">
                  <h4>概述</h4>
                  <p>
                    AI辅助分析系统使用DeepSeek模型，通过分析链上数据、市场情绪、资金流向等多维度信息，为交易决策提供参考建议。<strong>AI分析是辅助工具，不直接触发交易</strong>，最终决策仍由V3和ICT策略判断。
                  </p>

                  <div
                    style="background: #fff3cd; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #ffc107;">
                    <h5 style="margin: 0 0 10px 0; color: #856404;">⚠️ 重要说明</h5>
                    <ul style="margin: 5px 0; padding-left: 20px; color: #856404;">
                      <li>AI分析用于<strong>辅助参考</strong>，不作为唯一交易依据</li>
                      <li>实际交易由V3/ICT策略触发，AI提供<strong>多维度视角</strong></li>
                      <li>建议结合AI信号和策略信号综合判断</li>
                    </ul>
                  </div>

                  <h4>分析模块</h4>
                  <ul>
                    <li><strong>AI市场风险分析</strong>：针对BTC和ETH的宏观风险评估，每1小时更新</li>
                    <li><strong>AI符号趋势分析</strong>：针对10个活跃交易对的趋势和信号分析，每1小时更新</li>
                  </ul>
                </div>
              </div>

              <!-- AI评分逻辑 -->
              <div class="strategy-doc" id="ai-scoring">
                <div class="doc-header">
                  <h3>📊 AI评分逻辑说明</h3>
                </div>
                <div class="doc-content">
                  <h4>评分计算公式</h4>
                  <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 10px 0;">
                    <code style="font-size: 14px; color: #495057;">
                      总分 = (短期趋势置信度 + 中期趋势置信度) ÷ 2
                    </code>
                  </div>

                  <h4>信号分级标准 (6档评分体系)</h4>
                  <table style="width: 100%; border-collapse: collapse; margin: 15px 0;">
                    <thead>
                      <tr style="background: #f8f9fa;">
                        <th style="padding: 10px; text-align: left; border: 1px solid #dee2e6;">分数段</th>
                        <th style="padding: 10px; text-align: left; border: 1px solid #dee2e6;">信号类型</th>
                        <th style="padding: 10px; text-align: left; border: 1px solid #dee2e6;">标识</th>
                        <th style="padding: 10px; text-align: left; border: 1px solid #dee2e6;">含义</th>
                        <th style="padding: 10px; text-align: left; border: 1px solid #dee2e6;">操作建议</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr style="background: #d4edda;">
                        <td style="padding: 8px; border: 1px solid #dee2e6;"><strong>78-100分</strong></td>
                        <td style="padding: 8px; border: 1px solid #dee2e6;">强烈看多</td>
                        <td style="padding: 8px; border: 1px solid #dee2e6;">🟢 strongBuy</td>
                        <td style="padding: 8px; border: 1px solid #dee2e6;">多因子共振，趋势明确向上</td>
                        <td style="padding: 8px; border: 1px solid #dee2e6;"><strong>可考虑做多入场（仓位20-30%）</strong></td>
                      </tr>
                      <tr>
                        <td style="padding: 8px; border: 1px solid #dee2e6;"><strong>68-77分</strong></td>
                        <td style="padding: 8px; border: 1px solid #dee2e6;">看多</td>
                        <td style="padding: 8px; border: 1px solid #dee2e6;">🟡 mediumBuy</td>
                        <td style="padding: 8px; border: 1px solid #dee2e6;">趋势较好，需控制仓位</td>
                        <td style="padding: 8px; border: 1px solid #dee2e6;">可轻仓做多（仓位10-15%）</td>
                      </tr>
                      <tr>
                        <td style="padding: 8px; border: 1px solid #dee2e6;"><strong>58-67分</strong></td>
                        <td style="padding: 8px; border: 1px solid #dee2e6;">持有偏多</td>
                        <td style="padding: 8px; border: 1px solid #dee2e6;">🔵 holdBullish</td>
                        <td style="padding: 8px; border: 1px solid #dee2e6;">略偏多但信号不强</td>
                        <td style="padding: 8px; border: 1px solid #dee2e6;">持有多单观望，不建议新开</td>
                      </tr>
                      <tr>
                        <td style="padding: 8px; border: 1px solid #dee2e6;"><strong>48-57分</strong></td>
                        <td style="padding: 8px; border: 1px solid #dee2e6;">持有观望</td>
                        <td style="padding: 8px; border: 1px solid #dee2e6;">⚪ hold</td>
                        <td style="padding: 8px; border: 1px solid #dee2e6;">方向不明，横盘震荡</td>
                        <td style="padding: 8px; border: 1px solid #dee2e6;">观望，不入场</td>
                      </tr>
                      <tr>
                        <td style="padding: 8px; border: 1px solid #dee2e6;"><strong>38-47分</strong></td>
                        <td style="padding: 8px; border: 1px solid #dee2e6;">持有偏空</td>
                        <td style="padding: 8px; border: 1px solid #dee2e6;">🟠 holdBearish</td>
                        <td style="padding: 8px; border: 1px solid #dee2e6;">略偏空，注意风险</td>
                        <td style="padding: 8px; border: 1px solid #dee2e6;">持有空单观望，避免做多</td>
                      </tr>
                      <tr style="background: #f8d7da;">
                        <td style="padding: 8px; border: 1px solid #dee2e6;"><strong>0-37分</strong></td>
                        <td style="padding: 8px; border: 1px solid #dee2e6;">强烈看跌</td>
                        <td style="padding: 8px; border: 1px solid #dee2e6;">🔴 strongSell</td>
                        <td style="padding: 8px; border: 1px solid #dee2e6;">趋势明确向下，风险较高</td>
                        <td style="padding: 8px; border: 1px solid #dee2e6;"><strong>可考虑做空入场或避免做多</strong></td>
                      </tr>
                    </tbody>
                  </table>

                  <div
                    style="background: #d1ecf1; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #17a2b8;">
                    <h5 style="margin: 0 0 10px 0; color: #0c5460;">🎯 评分逻辑详解</h5>
                    <ul style="margin: 5px 0; padding-left: 20px; color: #0c5460;">
                      <li><strong>基础评分</strong>：(短期置信度 + 中期置信度) ÷ 2</li>
                      <li><strong>看跌反转</strong>：当主导趋势为下跌时，评分 = 100 - 基础分</li>
                      <li><strong>双向支持</strong>：高置信度的下跌趋势 → 低分数 → strongSell信号</li>
                      <li><strong>智能调整</strong>：检测AI固定置信度，自动微调增加多样性</li>
                      <li><strong>价格区间</strong>：所有信号都包含短期和中期价格预测区间</li>
                    </ul>
                  </div>

                  <h4>置信度说明</h4>
                  <p><strong>短期趋势置信度</strong>（1h-4h）：基于VWAP、资金费率、持仓量变化、Delta、成交量等因子</p>
                  <p><strong>中期趋势置信度</strong>（1d-3d）：基于链上活跃度、ETF资金流、市场结构、鲸鱼持仓等因子</p>

                  <h4>评分示例</h4>
                  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 15px 0;">
                    <div style="background: #d4edda; padding: 15px; border-radius: 8px; border: 1px solid #c3e6cb;">
                      <p style="margin: 0 0 10px 0;"><strong>示例1: BTCUSDT - 看多 (69分)</strong></p>
                      <ul style="margin: 0; padding-left: 20px; font-size: 13px;">
                        <li>短期: 上涨 (65%)</li>
                        <li>中期: 上涨 (72%)</li>
                        <li>计算: (65+72)÷2 = 68.5 ≈ 69分</li>
                        <li>信号: 69 ∈ [68,77] → <strong style="color: #ffc107;">看多 🟡</strong></li>
                      </ul>
                    </div>
                    <div style="background: #f8d7da; padding: 15px; border-radius: 8px; border: 1px solid #f5c6cb;">
                      <p style="margin: 0 0 10px 0;"><strong>示例2: ONDOUSDT - 强烈看跌 (31分)</strong></p>
                      <ul style="margin: 0; padding-left: 20px; font-size: 13px;">
                        <li>短期: 震荡 (62%)</li>
                        <li>中期: 下跌 (76%)</li>
                        <li>基础分: (62+76)÷2 = 69</li>
                        <li>看跌反转: 100-69 = 31分</li>
                        <li>信号: 31 < 38 → <strong style="color: #dc3545;">强烈看跌 🔴</strong></li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Telegram通知系统 (NEW) -->
              <div class="strategy-doc" id="telegram-notifications">
                <div class="doc-header">
                  <h3>📱 Telegram通知系统</h3>
                  <span class="strategy-badge"
                    style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">NEW</span>
                </div>
                <div class="doc-content">
                  <h4>通知类型</h4>
                  
                  <div
                    style="background: #d4edda; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #28a745;">
                    <h5 style="margin: 0 0 10px 0; color: #155724;">1. 交易触发通知</h5>
                    <ul style="margin: 5px 0; padding-left: 20px; color: #155724;">
                      <li><strong>Bot</strong>: @smartflow_excute_bot</li>
                      <li><strong>触发条件</strong>: V3/ICT策略触发BUY或SELL信号</li>
                      <li><strong>发送频率</strong>: 实时发送（策略执行频率5分钟）</li>
                      <li><strong>冷却期</strong>: 无（每次交易都通知）</li>
                      <li><strong>通知内容</strong>: 交易对、策略、方向、入场价、止损、止盈、杠杆、保证金</li>
                    </ul>
                  </div>

                  <div
                    style="background: #d1ecf1; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #17a2b8;">
                    <h5 style="margin: 0 0 10px 0; color: #0c5460;">2. AI分析信号通知</h5>
                    <ul style="margin: 5px 0; padding-left: 20px; color: #0c5460;">
                      <li><strong>Bot</strong>: @smartflow_excute_bot（与交易触发共用）</li>
                      <li><strong>触发条件</strong>: AI评分为strongBuy（≥78分）或strongSell（<38分）< /li>
                      <li><strong>发送频率</strong>: 每小时AI分析后自动检查</li>
                      <li><strong>冷却期</strong>: 1小时/每个交易对+信号组合</li>
                      <li><strong>通知内容</strong>: 交易对、信号、评分、价格、短期/中期趋势、价格区间、操作建议</li>
                    </ul>
                  </div>

                  <div
                    style="background: #fff3cd; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #ffc107;">
                    <h5 style="margin: 0 0 10px 0; color: #856404;">3. 系统监控告警</h5>
                    <ul style="margin: 5px 0; padding-left: 20px; color: #856404;">
                      <li><strong>Bot</strong>: @smartflow11_bot</li>
                      <li><strong>触发条件</strong>: CPU>60%, 内存>60%, Binance API成功率<80%< /li>
                      <li><strong>检查频率</strong>: 30秒检查一次系统状态</li>
                      <li><strong>冷却期</strong>: 5分钟/每种告警类型</li>
                      <li><strong>通知内容</strong>: 告警类型、当前值、阈值、严重程度、处理建议</li>
                    </ul>
                  </div>

                  <h4>通知冷却机制</h4>
                  <p>为避免消息轰炸，系统实现了智能冷却：</p>
                  <table style="width: 100%; border-collapse: collapse; margin: 15px 0;">
                    <thead>
                      <tr style="background: #f8f9fa;">
                        <th style="padding: 10px; text-align: left; border: 1px solid #dee2e6;">通知类型</th>
                        <th style="padding: 10px; text-align: left; border: 1px solid #dee2e6;">冷却期</th>
                        <th style="padding: 10px; text-align: left; border: 1px solid #dee2e6;">说明</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td style="padding: 8px; border: 1px solid #dee2e6;">交易触发</td>
                        <td style="padding: 8px; border: 1px solid #dee2e6;">无</td>
                        <td style="padding: 8px; border: 1px solid #dee2e6;">每次交易都通知</td>
                      </tr>
                      <tr>
                        <td style="padding: 8px; border: 1px solid #dee2e6;">AI信号</td>
                        <td style="padding: 8px; border: 1px solid #dee2e6;">1小时</td>
                        <td style="padding: 8px; border: 1px solid #dee2e6;">同一交易对+信号组合，1小时内只通知1次</td>
                      </tr>
                      <tr>
                        <td style="padding: 8px; border: 1px solid #dee2e6;">系统监控</td>
                        <td style="padding: 8px; border: 1px solid #dee2e6;">5分钟</td>
                        <td style="padding: 8px; border: 1px solid #dee2e6;">同一告警类型，5分钟内只通知1次</td>
                      </tr>
                    </tbody>
                  </table>

                  <h4>配置方法</h4>
                  <p>访问 <a href="https://smart.aimaventop.com/tools" target="_blank">工具页面</a> 的"Telegram监控设置"模块进行配置：</p>
                  <ol>
                    <li>填写Bot Token和Chat ID</li>
                    <li>点击"保存设置"</li>
                    <li>点击"测试连接"验证配置</li>
                    <li>配置保存到数据库，重启后自动恢复</li>
                  </ol>

                  <div
                    style="background: #e7f3ff; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #0066cc;">
                    <h5 style="margin: 0 0 10px 0; color: #004085;">💡 容错优化 (2025-10-10)</h5>
                    <ul style="margin: 5px 0; padding-left: 20px; color: #004085;">
                      <li><strong>部分完成也通知</strong>：即使AI分析任务部分完成，已完成的信号也会发送通知</li>
                      <li><strong>独立异常处理</strong>：通知失败不影响主流程，下次分析正常执行</li>
                      <li><strong>配置持久化</strong>：Telegram配置保存到数据库，服务重启后自动恢复</li>
                      <li><strong>自动重试</strong>：网络异常时自动重试发送</li>
                    </ul>
                  </div>
                </div>
              </div>

              <!-- AI数据来源 -->
              <div class="strategy-doc" id="ai-data-source">
                <div class="doc-header">
                  <h3>📡 AI数据来源</h3>
                </div>
                <div class="doc-content">
                  <h4>外部数据源</h4>
                  <ul>
                    <li><strong>Coinglass</strong>：资金费率、多空比、持仓量、清算数据</li>
                    <li><strong>Santiment</strong>：链上活跃地址数、社交热度、鲸鱼钱包变动</li>
                    <li><strong>ETF Flow</strong>：BTC/ETH ETF资金流入流出数据</li>
                    <li><strong>Binance API</strong>：实时价格、24h成交量、持仓量历史</li>
                  </ul>

                  <h4>分析因子</h4>
                  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 15px 0;">
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                      <h5 style="margin: 0 0 10px 0; color: #495057;">短期因子（1h-4h）</h5>
                      <ul style="margin: 0; padding-left: 20px; font-size: 13px;">
                        <li>VWAP位置</li>
                        <li>持仓量变化（OI）</li>
                        <li>资金费率</li>
                        <li>Delta（买卖压力）</li>
                        <li>成交量趋势</li>
                      </ul>
                    </div>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                      <h5 style="margin: 0 0 10px 0; color: #495057;">中期因子（1d-3d）</h5>
                      <ul style="margin: 0; padding-left: 20px; font-size: 13px;">
                        <li>链上活跃地址</li>
                        <li>鲸鱼钱包持仓</li>
                        <li>社交热度</li>
                        <li>ETF资金流</li>
                        <li>市场结构</li>
                      </ul>
                    </div>
                  </div>

                  <h4>AI模型</h4>
                  <p><strong>当前使用</strong>：DeepSeek API（成本优化，~$1/月）</p>
                  <p><strong>备用模型</strong>：OpenAI GPT、Grok</p>
                </div>
              </div>

              <!-- AI更新频率 -->
              <div class="strategy-doc" id="ai-update-frequency">
                <div class="doc-header">
                  <h3>⏱️ AI更新频率</h3>
                </div>
                <div class="doc-content">
                  <h4>更新间隔</h4>
                  <table style="width: 100%; border-collapse: collapse; margin: 15px 0;">
                    <thead>
                      <tr style="background: #f8f9fa;">
                        <th style="padding: 10px; text-align: left; border: 1px solid #dee2e6;">分析模块</th>
                        <th style="padding: 10px; text-align: left; border: 1px solid #dee2e6;">后端更新</th>
                        <th style="padding: 10px; text-align: left; border: 1px solid #dee2e6;">前端刷新</th>
                        <th style="padding: 10px; text-align: left; border: 1px solid #dee2e6;">说明</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td style="padding: 8px; border: 1px solid #dee2e6;">AI符号趋势分析</td>
                        <td style="padding: 8px; border: 1px solid #dee2e6;"><strong>1小时</strong></td>
                        <td style="padding: 8px; border: 1px solid #dee2e6;">1小时（使用缓存）</td>
                        <td style="padding: 8px; border: 1px solid #dee2e6;">策略表格AI列</td>
                      </tr>
                      <tr>
                        <td style="padding: 8px; border: 1px solid #dee2e6;">AI市场风险分析</td>
                        <td style="padding: 8px; border: 1px solid #dee2e6;"><strong>1小时</strong></td>
                        <td style="padding: 8px; border: 1px solid #dee2e6;">1小时（自动更新）</td>
                        <td style="padding: 8px; border: 1px solid #dee2e6;">BTC/ETH风险卡片</td>
                      </tr>
                      <tr style="background: #f8f9fa;">
                        <td style="padding: 8px; border: 1px solid #dee2e6;">策略状态数据</td>
                        <td style="padding: 8px; border: 1px solid #dee2e6;"><strong>5分钟</strong></td>
                        <td style="padding: 8px; border: 1px solid #dee2e6;">5分钟</td>
                        <td style="padding: 8px; border: 1px solid #dee2e6;">策略状态表格（实时计算，不存储）</td>
                      </tr>
                    </tbody>
                  </table>

                    <div
                      style="background: #d1ecf1; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #17a2b8;">
                      <h5 style="margin: 0 0 10px 0; color: #0c5460;">💡 更新机制优化 (2025-10-10)</h5>
                      <ul style="margin: 5px 0; padding-left: 20px; color: #0c5460;">
                        <li><strong>前后端统一5分钟刷新</strong>：Dashboard与strategy-worker完全同步</li>
                        <li><strong>策略判断不存储</strong>：实时计算，用完即弃，只有交易触发时才保存</li>
                        <li><strong>前端不做计算</strong>：所有数据统一使用后端计算结果</li>
                        <li>AI分析使用<strong>数据库缓存</strong>：每小时更新，避免频繁AI API调用</li>
                      <li>减少98.3%的不必要请求，提升用户体验</li>
                    </ul>
                  </div>

                  <h4>数据存储</h4>
                  <p>所有AI分析结果存储在MySQL数据库中，前端从数据库读取，不重复调用AI API。</p>
                </div>
              </div>

              <!-- V3策略文档 -->
              <div class="strategy-doc" id="v3-strategy">
                <div class="doc-header">
                  <h3>V3.1多因子趋势策略（最新版）</h3>
                  <span class="strategy-badge v3">V3.1</span>
                </div>
                <div class="doc-content">
                  <h4>策略概述</h4>
                  <p>V3.1策略是V3策略的增强版本，在原有基础上新增<strong>早期趋势探测</strong>、<strong>假突破过滤器</strong>和<strong>动态止损</strong>机制。通过4H趋势判断、1H多因子评分和15M入场确认三个层次，结合早期趋势预警和严格的假突破过滤，实现更早捕捉趋势、更高信号质量和更灵活的风险管理。</p>
                  
                  <div style="background: #e7f3ff; padding: 12px; border-left: 4px solid #2196f3; margin: 15px 0;">
                    <strong>🆕 V3.1核心升级</strong>
                    <ul style="margin: 5px 0 0 20px;">
                      <li>早期趋势探测：提前1-4小时捕捉趋势起点</li>
                      <li>假突破过滤器：多因子过滤假突破信号</li>
                      <li>动态止损：基于ATR和置信度的自适应止损</li>
                      <li>置信度分层：High/Med/Low三档风险管理</li>
                    </ul>
                  </div>

                  <h4>核心实现逻辑</h4>
                  <div class="implementation-section">
                    <h5>V3.1执行流程</h5>
                    <ol>
                      <li><strong>数据获取</strong>：并行获取4H、1H、15M K线 + 24h ticker + 资金费率 + OI历史</li>
                      <li><strong>🆕 早期趋势探测</strong>：在1H/4H上提前捕捉趋势起点（预警信号）</li>
                      <li><strong>4H趋势分析</strong>：EMA、ADX、BBW、MACD Histogram综合判断</li>
                      <li><strong>1H多因子分析</strong>：VWAP、OI、资金费率、Delta多维度评分</li>
                      <li><strong>15M入场分析</strong>：结构确认和短期均线对齐</li>
                      <li><strong>🆕 信号融合V3.1</strong>：整合早期趋势 + 三个时间框架</li>
                      <li><strong>🆕 假突破过滤</strong>：成交量、Delta、确认K线、边界检查</li>
                      <li><strong>🆕 置信度评定</strong>：High/Med/Low三档（影响止损和仓位）</li>
                      <li><strong>🆕 动态止损计算</strong>：ATR × 置信度系数（1.5/2.0/2.6）</li>
                    </ol>

                    <h5>🆕 早期趋势探测器（earlyTrendDetector）</h5>
                    <div style="background: #f0f8ff; padding: 10px; border-radius: 4px; margin: 10px 0;">
                      <p><strong>目标</strong>：比4H趋势确认提前1-4小时发现趋势起点</p>
                      <p><strong>检测条件</strong>（需同时满足）：</p>
                      <ul style="margin-left: 20px;">
                        <li>1H MACD Histogram > 0.5（连续2根）</li>
                        <li>1H Delta > 0.05（买）或 < -0.05（卖）</li>
                        <li>1H价格 > VWAP（买）或 < VWAP（卖）</li>
                        <li>1H ADX > 20（弱趋势门槛）</li>
                        <li>4H ADX < 40（不强反向）</li>
                    </ul>
                      <p><strong>效果</strong>：检测到早期趋势时，提升4H趋势权重10%，进入候选池等待确认</p>
                    </div>

                    <h5>🆕 假突破过滤器（fakeBreakoutFilter）</h5>
                    <div style="background: #fff9e6; padding: 10px; border-radius: 4px; margin: 10px 0;">
                      <p><strong>目标</strong>：剔除区间边界或低量能的假突破信号</p>
                      <p><strong>多因子过滤规则</strong>：</p>
                      <table style="width:100%; font-size: 13px; margin: 10px 0;">
                        <tr style="background: #ffc107;">
                          <th style="padding:8px;">因子</th>
                          <th style="padding:8px;">条件</th>
                          <th style="padding:8px;">默认参数</th>
                        </tr>
                        <tr>
                          <td style="padding:6px; border:1px solid #ddd;">量能确认</td>
                          <td style="padding:6px; border:1px solid #ddd;">当前量 ≥ 均量 × volFactor</td>
                          <td style="padding:6px; border:1px solid #ddd;">1.2倍</td>
                        </tr>
                        <tr>
                          <td style="padding:6px; border:1px solid #ddd;">Delta同向</td>
                          <td style="padding:6px; border:1px solid #ddd;">15M Delta与1H Delta同向</td>
                          <td style="padding:6px; border:1px solid #ddd;">|Delta|≥0.04</td>
                        </tr>
                        <tr>
                          <td style="padding:6px; border:1px solid #ddd;">突破确认</td>
                          <td style="padding:6px; border:1px solid #ddd;">突破后1根K线收盘不回撤</td>
                          <td style="padding:6px; border:1px solid #ddd;">回撤<0.3%</td>
                        </tr>
                        <tr>
                          <td style="padding:6px; border:1px solid #ddd;">边界过滤</td>
                          <td style="padding:6px; border:1px solid #ddd;">4H区间边界需量能支持</td>
                          <td style="padding:6px; border:1px solid #ddd;">回看10根4H</td>
                        </tr>
                      </table>
                      <p><strong>通过条件</strong>：所有过滤器通过 → confidence=high；部分通过 → med/low；不通过 → 拒绝信号</p>
                    </div>
                  </div>

                  <h4>时间框架分析详解</h4>
                  <div class="timeframe-section">
                    <div class="timeframe-item">
                      <h5>高时间框架 (4H) - 趋势判断</h5>
                      <ul>
                        <li><strong>EMA20/EMA50交叉</strong>：判断趋势方向，金叉为上升，死叉为下跌</li>
                        <li><strong>ADX指标</strong>：衡量趋势强度，ADX > 30为强趋势（已从25提升）</li>
                        <li><strong>BBW指标</strong>：布林带宽度，反映市场波动性</li>
                        <li><strong>MACD Histogram</strong>：动量确认，增强趋势判断准确性</li>
                        <li><strong>趋势评分</strong>：0-10分，综合判断趋势强度和方向</li>
                        <li><strong>实现函数</strong>：<code>analyze4HTrend(klines4H, {})</code></li>
                      </ul>
                    </div>

                    <div class="timeframe-item">
                      <h5>中时间框架 (1H) - 多因子评分</h5>
                      <ul>
                        <li><strong>VWAP方向</strong>：成交量加权平均价格方向确认</li>
                        <li><strong>OI变化</strong>：持仓量变化，反映资金流向</li>
                        <li><strong>资金费率</strong>：市场情绪指标，异常值时调整评分</li>
                        <li><strong>Delta值</strong>：买卖压力差值，>0.1多头优势，<-0.1空头优势< /li>
                        <li><strong>评分机制</strong>：0-6分，下边界3分+VWAP方向一致才有效</li>
                        <li>
                          <strong>实现函数</strong>：<code>analyze1HFactors(klines1H, {ticker24hr, fundingRate, oiHistory})</code>
                        </li>
                      </ul>
                    </div>

                    <div class="timeframe-item">
                      <h5>低时间框架 (15M) - 入场确认</h5>
                      <ul>
                        <li><strong>EMA20/EMA50</strong>：短期均线确认入场时机</li>
                        <li><strong>结构分析</strong>：检测Higher Highs/Lows或Lower Lows/Highs</li>
                        <li><strong>ATR指标</strong>：平均真实波幅，用于止损计算</li>
                        <li><strong>入场评分</strong>：0-5分，确认入场时机和结构强度</li>
                        <li><strong>实现函数</strong>：<code>analyze15mExecution(klines15M, {})</code></li>
                      </ul>
                    </div>
                  </div>

                  <h4>信号生成与综合判断</h4>
                  <div class="signal-section">
                    <h5>combineSignals函数 - 动态加权评分机制</h5>
                    <p>采用动态加权评分机制综合三个时间框架的分析结果：</p>

                    <h6>基础权重分配</h6>
                    <ul>
                      <li><strong>基础权重</strong>：4H趋势(50%) + 1H因子(35%) + 15M入场(15%)</li>
                      <li><strong>总分计算</strong>：加权总分 = (趋势分/10×权重) + (因子分/6×权重) + (入场分/5×权重)</li>
                      <li><strong>标准化评分</strong>：总分×100，范围0-100分</li>
                    </ul>

                    <h6>动态权重调整（2025-10-08优化）</h6>
                    <table style="width: 100%; border-collapse: collapse; margin: 15px 0;">
                      <tr style="background-color: #667eea; color: white;">
                        <th style="border: 1px solid #ddd; padding: 12px;">调整条件</th>
                        <th style="border: 1px solid #ddd; padding: 12px;">趋势权重</th>
                        <th style="border: 1px solid #ddd; padding: 12px;">因子权重</th>
                        <th style="border: 1px solid #ddd; padding: 12px;">入场权重</th>
                      </tr>
                      <tr>
                        <td style="border: 1px solid #ddd; padding: 12px;">默认</td>
                        <td style="border: 1px solid #ddd; padding: 12px;">50%</td>
                        <td style="border: 1px solid #ddd; padding: 12px;">35%</td>
                        <td style="border: 1px solid #ddd; padding: 12px;">15%</td>
                      </tr>
                      <tr style="background-color: #f8f9fa;">
                        <td style="border: 1px solid #ddd; padding: 12px;">趋势很强(≥8分)</td>
                        <td style="border: 1px solid #ddd; padding: 12px;"><strong>60%</strong></td>
                        <td style="border: 1px solid #ddd; padding: 12px;">30%</td>
                        <td style="border: 1px solid #ddd; padding: 12px;">10%</td>
                      </tr>
                      <tr>
                        <td style="border: 1px solid #ddd; padding: 12px;">因子很强(≥5分)</td>
                        <td style="border: 1px solid #ddd; padding: 12px;">45%</td>
                        <td style="border: 1px solid #ddd; padding: 12px;"><strong>40%</strong></td>
                        <td style="border: 1px solid #ddd; padding: 12px;">15%</td>
                      </tr>
                      <tr style="background-color: #f8f9fa;">
                        <td style="border: 1px solid #ddd; padding: 12px;">入场很强(≥4分)</td>
                        <td style="border: 1px solid #ddd; padding: 12px;">50%</td>
                        <td style="border: 1px solid #ddd; padding: 12px;">30%</td>
                        <td style="border: 1px solid #ddd; padding: 12px;"><strong>20%</strong></td>
                      </tr>
                    </table>

                    <h6>补偿机制 - 解决信号死区</h6>
                    <p><strong>目的：</strong>避免高总分因单一因子略低而被拒绝</p>
                    <div class="code-block"
                      style="background: #2d2d2d; color: #f8f8f2; padding: 15px; border-radius: 5px; overflow-x: auto; font-family: 'Courier New', monospace; margin: 10px 0;">
                      compensation = (normalizedScore/100) × (trendScore/10) × 0.2
                      adjustedThreshold = baseThreshold - compensation
                    </div>
                    <p><strong>效果：</strong></p>
                    <ul>
                      <li>总分越高，补偿越多</li>
                      <li>趋势越强，补偿越多</li>
                      <li>允许因子门槛降低1-2分</li>
                    </ul>

                    <h5>信号触发条件</h5>
                    <p>基于加权总分和各时间框架最低要求（使用调整后门槛）：</p>
                    <ul>
                      <li><strong>强信号(BUY/SELL)</strong>：总分≥70% 且 趋势分≥6 且 因子分≥调整后门槛 且 入场分≥1</li>
                      <li><strong>中等信号(BUY/SELL)</strong>：总分45-69% 且 趋势分≥5 且 因子分≥调整后门槛 且 入场分≥1</li>
                      <li><strong>弱信号(BUY/SELL)</strong>：总分35-44% 且 趋势分≥4 且 因子分≥调整后门槛 且 入场分≥1</li>
                      <li><strong>观望信号(HOLD)</strong>：不满足上述条件或趋势为RANGE（无假突破）</li>
                    </ul>

                    <h6>震荡市特殊处理</h6>
                    <p>当4H趋势判断为RANGE时，执行震荡市假突破交易逻辑：</p>
                    <ul>
                      <li><strong>1H边界检测</strong>：基于布林带识别上下边界</li>
                      <li><strong>15M假突破检测</strong>：
                        <ul>
                          <li>空头假突破：价格跌破下轨后快速回归 → BUY信号</li>
                          <li>多头假突破：价格突破上轨后快速回归 → SELL信号</li>
                        </ul>
                      </li>
                      <li><strong>止损止盈</strong>：止损 = (price - boundary) × 1.2，止盈 = 止损距离 × 1.5</li>
                      <li><strong>无假突破</strong>：返回HOLD信号</li>
                    </ul>
                  </div>

                  <h4>🆕 V3.1动态止损与风险管理</h4>
                  <div class="calculation-section">
                    <h5>置信度分层建仓</h5>
                    <table style="width:100%; border-collapse: collapse; margin: 10px 0;">
                      <tr style="background: #667eea; color: white;">
                        <th style="padding:10px; border:1px solid #ddd;">置信度</th>
                        <th style="padding:10px; border:1px solid #ddd;">触发条件</th>
                        <th style="padding:10px; border:1px solid #ddd;">初始止损系数</th>
                        <th style="padding:10px; border:1px solid #ddd;">风险特征</th>
                      </tr>
                      <tr>
                        <td style="padding:8px; border:1px solid #ddd;"><strong>High</strong></td>
                        <td style="padding:8px; border:1px solid #ddd;">所有过滤器通过 + 早期趋势确认</td>
                        <td style="padding:8px; border:1px solid #ddd;">ATR × <strong>1.5</strong></td>
                        <td style="padding:8px; border:1px solid #ddd;">止损紧 + 高确定性</td>
                      </tr>
                      <tr style="background:#f8f9fa;">
                        <td style="padding:8px; border:1px solid #ddd;"><strong>Med</strong></td>
                        <td style="padding:8px; border:1px solid #ddd;">部分过滤器通过 或 无早期趋势</td>
                        <td style="padding:8px; border:1px solid #ddd;">ATR × <strong>2.0</strong></td>
                        <td style="padding:8px; border:1px solid #ddd;">标准止损</td>
                      </tr>
                      <tr>
                        <td style="padding:8px; border:1px solid #ddd;"><strong>Low</strong></td>
                        <td style="padding:8px; border:1px solid #ddd;">信号边缘通过</td>
                        <td style="padding:8px; border:1px solid #ddd;">ATR × <strong>2.6</strong></td>
                        <td style="padding:8px; border:1px solid #ddd;">止损宽 + 保守</td>
                      </tr>
                      <tr style="background:#ffe6e6;">
                        <td style="padding:8px; border:1px solid #ddd;"><strong>Reject</strong></td>
                        <td style="padding:8px; border:1px solid #ddd;">假突破过滤器未通过</td>
                        <td style="padding:8px; border:1px solid #ddd;">-</td>
                        <td style="padding:8px; border:1px solid #ddd;">拒绝信号</td>
                      </tr>
                    </table>

                    <h5>动态止损机制</h5>
                    <div style="background: #f0f8ff; padding: 10px; border-radius: 4px; margin: 10px 0;">
                      <p><strong>初始止损</strong>（入场时）：</p>
                      <ul style="margin-left: 20px;">
                        <li>多头：stopLoss = entryPrice - (ATR15 × K_entry)</li>
                        <li>空头：stopLoss = entryPrice + (ATR15 × K_entry)</li>
                        <li>K_entry由置信度决定：1.5/2.0/2.6</li>
                    </ul>
                      
                      <p><strong>动态调整</strong>（趋势确认后）：</p>
                      <ul style="margin-left: 20px;">
                        <li>若1H/4H动量进一步确认（MACD增幅>30% + ADX上升）</li>
                        <li>扩大止损到ATR × 2.8或移至盈亏平衡+缓冲</li>
                        <li>避免被市场噪音止损出局</li>
                      </ul>
                      
                      <p><strong>时间止损</strong>（60分钟）：</p>
                      <ul style="margin-left: 20px;">
                        <li>持仓超过60分钟且未盈利 → 平仓</li>
                        <li>避免长时间占用资金</li>
                      </ul>
                      
                      <p><strong>追踪止盈</strong>：</p>
                      <ul style="margin-left: 20px;">
                        <li>盈利达到1×初始SL时启动追踪</li>
                        <li>每波动0.5×ATR提升止损</li>
                        <li>锁定利润，让利润奔跑</li>
                      </ul>
                    </div>

                    <h5>杠杆和保证金计算</h5>
                    <p>根据止损距离和最大损失金额动态计算：</p>
                    <ul>
                      <li><strong>止损距离X%</strong>：<code>|entryPrice - stopLoss| / entryPrice</code></li>
                      <li><strong>最大杠杆数Y</strong>：<code>Math.floor(1 / (X% + 0.5%))</code></li>
                      <li><strong>实际杠杆</strong>：<code>leverage = Math.min(calculatedMaxLeverage, 24)</code></li>
                      <li><strong>最小保证金Z</strong>：<code>Math.ceil(M / (leverage × X%))</code></li>
                      <li><strong>杠杆限制</strong>：<span style="color: #28a745; font-weight: bold;">最大24倍</span>，最小1倍</li>
                    </ul>
                    <p>其中M为最大损失金额（默认100 USDT）</p>
                  </div>

                  <h4>错误处理与日志</h4>
                  <div class="error-handling-section">
                    <ul>
                      <li><strong>数据验证</strong>：检查K线数据的完整性和有效性</li>
                      <li><strong>异常捕获</strong>：try-catch包装所有异步操作</li>
                      <li><strong>详细日志</strong>：记录策略执行过程和决策依据</li>
                      <li><strong>错误返回</strong>：返回ERROR信号而非抛出异常</li>
                    </ul>
                  </div>
                  
                  <h4>🆕 V3.1-Plus 重大优化 (2025-10-12)</h4>
                  
                  <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px; border-radius: 8px; margin: 15px 0;">
                    <h5 style="color: white; margin-top: 0;">🎯 优化目标</h5>
                    <table style="width:100%; color: white;">
                      <tr>
                        <td><strong>胜率</strong></td>
                        <td>27.74% → 45-55%</td>
                        <td>(+62-98%)</td>
                      </tr>
                      <tr>
                        <td><strong>盈亏比</strong></td>
                        <td>1.5 → 2.0-2.5</td>
                        <td>(+33-67%)</td>
                      </tr>
                      <tr>
                        <td><strong>交易次数</strong></td>
                        <td>减少20-40%</td>
                        <td>(减少噪音)</td>
                      </tr>
                    </table>
                  </div>

                  <div class="fix-item" style="background: #e7f3ff; border-left: 4px solid #2196f3; padding: 15px; margin: 10px 0; border-radius: 5px;">
                    <h5>A. 入场时机优化（延迟确认 + 回撤分步入场）</h5>
                    
                    <h6>1. 突破确认等待 ✅</h6>
                    <ul style="margin-left: 20px;">
                      <li>突破后等待<strong>1根15M K线收盘</strong>确认</li>
                      <li>避免假突破当根噪音</li>
                      <li>参数: <code>confirmationWait = 1</code></li>
                    </ul>
                    
                    <h6>2. 多因子确认（至少2项）✅</h6>
                    <table style="width:100%; font-size: 13px; margin: 10px 0; border-collapse: collapse;">
                      <tr style="background: #f0f8ff;">
                        <th style="padding:6px; border:1px solid #ddd;">因子</th>
                        <th style="padding:6px; border:1px solid #ddd;">条件</th>
                        <th style="padding:6px; border:1px solid #ddd;">参数</th>
                      </tr>
                      <tr>
                        <td style="padding:6px; border:1px solid #ddd;">成交量</td>
                        <td style="padding:6px; border:1px solid #ddd;">≥ 均量 × volFactor</td>
                        <td style="padding:6px; border:1px solid #ddd;">1.2倍</td>
                      </tr>
                      <tr>
                        <td style="padding:6px; border:1px solid #ddd;">Delta同向</td>
                        <td style="padding:6px; border:1px solid #ddd;">15M与1H同向且|Δ|≥阈值</td>
                        <td style="padding:6px; border:1px solid #ddd;">0.04</td>
                      </tr>
                      <tr>
                        <td style="padding:6px; border:1px solid #ddd;">早期趋势</td>
                        <td style="padding:6px; border:1px solid #ddd;">earlyTrendDetector检测到</td>
                        <td style="padding:6px; border:1px solid #ddd;">布尔值</td>
                      </tr>
                      <tr>
                        <td style="padding:6px; border:1px solid #ddd;">SmartMoney</td>
                        <td style="padding:6px; border:1px solid #ddd;">分数≥阈值</td>
                        <td style="padding:6px; border:1px solid #ddd;">0.6</td>
                      </tr>
                    </table>
                    <p><strong>规则</strong>：确认项数≥2才允许入场（全部通过更佳）</p>
                    
                    <h6>3. Pullback入场模式 ✅</h6>
                    <ul style="margin-left: 20px;">
                      <li>突破后价格回撤到<strong>突破价±1.5%</strong>或<strong>EMA20</strong></li>
                      <li>在回撤位形成支撑/阻力（V形反转、W底、上升支撑）</li>
                      <li>分批建仓：<strong>首仓50%</strong>，确认后补仓50%</li>
                      <li>补仓后移动止损到<strong>盈亏平衡+0.1%缓冲</strong></li>
                    </ul>
                  </div>

                  <div class="fix-item" style="background: #fff3e0; border-left: 4px solid #ff9800; padding: 15px; margin: 10px 0; border-radius: 5px;">
                    <h5>B. 止损/仓位优化（动态止损Plus + 分批建仓）</h5>
                    
                    <h6>1. 置信度分层止损（优化版）✅</h6>
                    <table style="width:100%; border-collapse: collapse; margin: 10px 0;">
                      <tr style="background: #ff9800; color: white;">
                        <th style="padding:8px; border:1px solid #ddd;">置信度</th>
                        <th style="padding:8px; border:1px solid #ddd;">V3.1</th>
                        <th style="padding:8px; border:1px solid #ddd;">V3.1-Plus</th>
                        <th style="padding:8px; border:1px solid #ddd;">变化</th>
                      </tr>
                      <tr>
                        <td style="padding:6px; border:1px solid #ddd;">High</td>
                        <td style="padding:6px; border:1px solid #ddd;">1.5×ATR</td>
                        <td style="padding:6px; border:1px solid #ddd;"><strong>1.4×ATR</strong></td>
                        <td style="padding:6px; border:1px solid #ddd;">-6.7% (更紧)</td>
                      </tr>
                      <tr>
                        <td style="padding:6px; border:1px solid #ddd;">Med</td>
                        <td style="padding:6px; border:1px solid #ddd;">2.0×ATR</td>
                        <td style="padding:6px; border:1px solid #ddd;">2.0×ATR</td>
                        <td style="padding:6px; border:1px solid #ddd;">不变</td>
                      </tr>
                      <tr>
                        <td style="padding:6px; border:1px solid #ddd;">Low</td>
                        <td style="padding:6px; border:1px solid #ddd;">2.6×ATR</td>
                        <td style="padding:6px; border:1px solid #ddd;"><strong>3.0×ATR</strong></td>
                        <td style="padding:6px; border:1px solid #ddd;">+15.4% (更宽)</td>
                      </tr>
                    </table>
                    
                    <h6>2. 入场模式调整 ✅</h6>
                    <ul style="margin-left: 20px;">
                      <li><strong>Breakout模式</strong>: K × 1.25 (突破风险高，放宽止损)</li>
                      <li><strong>Pullback模式</strong>: K × 0.9 (回撤风险低，收紧止损)</li>
                      <li><strong>Momentum模式</strong>: K不变 (标准止损)</li>
                    </ul>
                    
                    <h6>3. 追踪止盈优化 ✅</h6>
                    <ul style="margin-left: 20px;">
                      <li><strong>步长</strong>: 0.5×ATR → <strong>0.4×ATR</strong> (更敏感，-20%)</li>
                      <li><strong>目标</strong>: 1.3×ATR → <strong>2.0×ATR</strong> (更高，+53.8%)</li>
                      <li><strong>触发</strong>: 盈利≥1×止损距离时启用</li>
                    </ul>
                    
                    <h6>4. 时间止损优化 ✅</h6>
                    <ul style="margin-left: 20px;">
                      <li><strong>基准</strong>: 60分钟未盈利 + 1H动量反转 → 平仓</li>
                      <li><strong>扩展</strong>: 120分钟未盈利 → 减仓50%</li>
                      <li><strong>动量反转</strong>: MACD Hist减少>30% 或 EMA交叉</li>
                    </ul>
                  </div>

                  <div class="fix-item" style="background: #f8f9fa; border-left: 4px solid #28a745; padding: 15px; margin: 10px 0; border-radius: 5px;">
                    <h5>C. 交易节律/频率控制（冷却 + 胜率驱动）</h5>
                    
                    <h6>1. 冷却机制 ✅</h6>
                    <ul style="margin-left: 20px;">
                      <li><strong>单次冷却</strong>: 每次入场后<strong>45分钟</strong>内不再入场同一交易对</li>
                      <li><strong>每日限制</strong>: 每个交易对每日最多<strong>6笔</strong>交易</li>
                      <li><strong>实现</strong>: 内存缓存 + 数据库持久化</li>
                      <li><strong>自动重置</strong>: 每日0点重置计数</li>
                    </ul>
                    
                    <h6>2. 胜率跟踪保护 ✅</h6>
                    <ul style="margin-left: 20px;">
                      <li><strong>跟踪窗口</strong>: 最近<strong>12笔</strong>已平仓交易</li>
                      <li><strong>保护阈值</strong>: 胜率<strong>30%</strong>时启动保护</li>
                      <li><strong>调整措施</strong>:
                        <ul>
                          <li>总分惩罚: -10到-20分（根据胜率低程度）</li>
                          <li>仓位缩减: ×0.3到×1.0（胜率越低缩减越多）</li>
                        </ul>
                      </li>
                      <li><strong>恢复条件</strong>: 胜率回到≥30%时自动解除</li>
                    </ul>
                    
                    <h6>3. 趋势过滤 ✅</h6>
                    <ul style="margin-left: 20px;">
                      <li><strong>下降趋势</strong>: 拒绝LONG弱信号（<70分）</li>
                      <li><strong>上升趋势</strong>: 拒绝SHORT弱信号（<70分）</li>
                      <li><strong>逆势交易要求更严格</strong></li>
                    </ul>
                  </div>

                  <div class="fix-item" style="background: #d1ecf1; border-left: 4px solid #0c5460; padding: 15px; margin: 10px 0; border-radius: 5px;">
                    <h5>📊 V3.1-Plus 关键参数对比</h5>
                    
                    <table style="width:100%; border-collapse: collapse; margin: 10px 0;">
                      <tr style="background: #0c5460; color: white;">
                        <th style="padding:8px; border:1px solid #ddd;">参数</th>
                        <th style="padding:8px; border:1px solid #ddd;">V3.1</th>
                        <th style="padding:8px; border:1px solid #ddd;">V3.1-Plus</th>
                        <th style="padding:8px; border:1px solid #ddd;">改进</th>
                      </tr>
                      <tr>
                        <td style="padding:6px; border:1px solid #ddd;">入场确认</td>
                        <td style="padding:6px; border:1px solid #ddd;">即时</td>
                        <td style="padding:6px; border:1px solid #ddd;">等待1根+多因子</td>
                        <td style="padding:6px; border:1px solid #ddd;">减少假突破</td>
                      </tr>
                      <tr>
                        <td style="padding:6px; border:1px solid #ddd;">K_high</td>
                        <td style="padding:6px; border:1px solid #ddd;">1.5</td>
                        <td style="padding:6px; border:1px solid #ddd;">1.4</td>
                        <td style="padding:6px; border:1px solid #ddd;">-6.7% (提高胜率)</td>
                      </tr>
                      <tr>
                        <td style="padding:6px; border:1px solid #ddd;">K_low</td>
                        <td style="padding:6px; border:1px solid #ddd;">2.6</td>
                        <td style="padding:6px; border:1px solid #ddd;">3.0</td>
                        <td style="padding:6px; border:1px solid #ddd;">+15.4% (避免扫损)</td>
                      </tr>
                      <tr>
                        <td style="padding:6px; border:1px solid #ddd;">追踪步长</td>
                        <td style="padding:6px; border:1px solid #ddd;">0.5×ATR</td>
                        <td style="padding:6px; border:1px solid #ddd;">0.4×ATR</td>
                        <td style="padding:6px; border:1px solid #ddd;">-20% (更敏感)</td>
                      </tr>
                      <tr>
                        <td style="padding:6px; border:1px solid #ddd;">止盈目标</td>
                        <td style="padding:6px; border:1px solid #ddd;">1.3×ATR</td>
                        <td style="padding:6px; border:1px solid #ddd;">2.0×ATR</td>
                        <td style="padding:6px; border:1px solid #ddd;">+53.8% (让利润奔跑)</td>
                      </tr>
                      <tr>
                        <td style="padding:6px; border:1px solid #ddd;">冷却时间</td>
                        <td style="padding:6px; border:1px solid #ddd;">无</td>
                        <td style="padding:6px; border:1px solid #ddd;">45分钟</td>
                        <td style="padding:6px; border:1px solid #ddd;">避免频繁交易</td>
                      </tr>
                      <tr>
                        <td style="padding:6px; border:1px solid #ddd;">胜率保护</td>
                        <td style="padding:6px; border:1px solid #ddd;">无</td>
                        <td style="padding:6px; border:1px solid #ddd;"><30%启动</td>
                        <td style="padding:6px; border:1px solid #ddd;">自适应调整</td>
                      </tr>
                    </table>
                  </div>

                  <div class="fix-item" style="background: #d4edda; border-left: 4px solid #28a745; padding: 15px; margin: 10px 0; border-radius: 5px;">
                    <h5>💡 实现亮点</h5>
                    <ul style="margin-left: 20px;">
                      <li>✅ <strong>零冗余</strong>: 无新建表，完全复用现有表结构</li>
                      <li>✅ <strong>高性能</strong>: 内存缓存冷却状态，单表查询胜率</li>
                      <li>✅ <strong>6个核心模块</strong>:
                        <ul>
                          <li>CooldownCache - 冷却缓存管理</li>
                          <li>WinRateTracker - 胜率跟踪</li>
                          <li>EntryConfirmationManager - 入场确认</li>
                          <li>PullbackDetector - 回撤检测</li>
                          <li>StagedEntryManager - 分批建仓</li>
                          <li>DynamicStopLossPlus - 动态止损Plus</li>
                        </ul>
                      </li>
                      <li>✅ <strong>37个单元测试</strong>: 100%通过</li>
                      <li>✅ <strong>24个可调参数</strong>: strategy_params表配置</li>
                    </ul>
                  </div>
                  
                  <h4>🆕 V3.1优化历史 (2025-10-08)</h4>
                  <div class="fix-item" style="background: #f8f9fa; border-left: 4px solid #28a745; padding: 15px; margin: 10px 0; border-radius: 5px;">
                    <h5>震荡市交易逻辑修复</h5>
                    <p><strong>问题</strong>：震荡市模式下，即使15M检测到假突破信号，combineSignals也直接返回HOLD</p>
                    <p><strong>修复</strong>：增加震荡市假突破信号检查逻辑</p>
                    <p><strong>条件</strong>：4H趋势为RANGE + 1H边界有效 + 布林带收窄 + 价格假突破后快速回归</p>
                    <p><strong>效果</strong>：震荡市假突破信号现在能够正确触发交易</p>
                  </div>
                </div>
              </div>

              <!-- 聪明钱监控文档 (V2.1.0) -->
              <div class="strategy-doc" id="smart-money-overview">
                <div class="doc-header">
                  <h3>💰 聪明钱监控系统 (V2.1.0)</h3>
                  <span class="strategy-badge" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">聪明钱</span>
                </div>
                <div class="doc-content">
                  <h4>监控概述</h4>
                  <p>聪明钱监控系统通过实时分析订单簿失衡(OBI)、累计成交量差(CVD)、持仓量变化(OI)和成交量异常(Volume Z-score)等多维度市场指标，识别主力资金（庄家）的操作意图。系统每15分钟更新一次，追踪6个核心交易对（BTCUSDT、ETHUSDT、SOLUSDT、ASTERUSDT、MEMEUSDT、4USDT）的实时动作。</p>
                  
                  <div style="background: #e7f3ff; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #2196f3;">
                    <h5 style="margin: 0 0 10px 0; color: #0c5460;">🎯 核心功能</h5>
                    <ul style="margin: 5px 0; padding-left: 20px; color: #0c5460;">
                      <li><strong>庄家动作识别</strong>：吸筹、拉升、派发、砸盘四种动作</li>
                      <li><strong>诱多诱空检测</strong>：识别主力诱导散户的假信号</li>
                      <li><strong>建仓信号提示</strong>：聪明钱建仓标识（紫色渐变+呼吸光效）</li>
                      <li><strong>实时监控</strong>：15分钟刷新周期，数据库持久化</li>
                    </ul>
                  </div>

                  <h4 id="smart-money-indicators">核心指标说明</h4>
                  <table style="width:100%; font-size: 13px; margin: 15px 0; border-collapse: collapse;">
                    <tr style="background: #667eea; color: white;">
                      <th style="padding:10px; border:1px solid #ddd;">指标</th>
                      <th style="padding:10px; border:1px solid #ddd;">英文缩写</th>
                      <th style="padding:10px; border:1px solid #ddd;">计算方式</th>
                      <th style="padding:10px; border:1px solid #ddd;">意义</th>
                    </tr>
                    <tr>
                      <td style="padding:8px; border:1px solid #ddd;">订单簿失衡</td>
                      <td style="padding:8px; border:1px solid #ddd;"><strong>OBI</strong></td>
                      <td style="padding:8px; border:1px solid #ddd;">买单总量 - 卖单总量</td>
                      <td style="padding:8px; border:1px solid #ddd;">正值→买盘强劲；负值→卖盘占优</td>
                    </tr>
                    <tr style="background: #f8f9fa;">
                      <td style="padding:8px; border:1px solid #ddd;">累计成交量差</td>
                      <td style="padding:8px; border:1px solid #ddd;"><strong>CVD</strong></td>
                      <td style="padding:8px; border:1px solid #ddd;">∑(买方成交量 - 卖方成交量)</td>
                      <td style="padding:8px; border:1px solid #ddd;">上升→主力吸筹；下降→主力派发</td>
                    </tr>
                    <tr>
                      <td style="padding:8px; border:1px solid #ddd;">持仓量变化</td>
                      <td style="padding:8px; border:1px solid #ddd;"><strong>OI Change</strong></td>
                      <td style="padding:8px; border:1px solid #ddd;">当前OI - 前期OI</td>
                      <td style="padding:8px; border:1px solid #ddd;">上升→新资金入场；下降→资金离场</td>
                    </tr>
                    <tr style="background: #f8f9fa;">
                      <td style="padding:8px; border:1px solid #ddd;">成交量异常</td>
                      <td style="padding:8px; border:1px solid #ddd;"><strong>Volume Z-score</strong></td>
                      <td style="padding:8px; border:1px solid #ddd;">(当前量 - 均量) / 标准差</td>
                      <td style="padding:8px; border:1px solid #ddd;">σ值越高→异常程度越大（>2σ显著异常）</td>
                    </tr>
                  </table>

                  <div style="background: #fff9e6; padding: 12px; border-radius: 6px; margin: 15px 0;">
                    <p style="margin: 0; color: #856404;"><strong>💡 σ（西格玛）说明</strong>：Z-score的单位，表示偏离均值的标准差倍数</p>
                    <ul style="margin: 5px 0 0 20px; color: #856404; font-size: 13px;">
                      <li>0-1σ：正常波动</li>
                      <li>1-2σ：值得关注</li>
                      <li>2-3σ：异常信号（强烈关注）</li>
                      <li>>3σ：极度异常（可能是重大事件）</li>
                    </ul>
                  </div>

                  <h4 id="smart-money-actions">庄家动作四象限模型</h4>
                  <p>基于价格走势、CVD方向和持仓量变化，识别四种核心庄家动作：</p>

                  <table style="width:100%; font-size: 13px; margin: 15px 0; border-collapse: collapse;">
                    <tr style="background: #667eea; color: white;">
                      <th style="padding:10px; border:1px solid #ddd;">动作</th>
                      <th style="padding:10px; border:1px solid #ddd;">英文</th>
                      <th style="padding:10px; border:1px solid #ddd;">价格</th>
                      <th style="padding:10px; border:1px solid #ddd;">CVD</th>
                      <th style="padding:10px; border:1px solid #ddd;">OI</th>
                      <th style="padding:10px; border:1px solid #ddd;">策略建议</th>
                    </tr>
                    <tr>
                      <td style="padding:8px; border:1px solid #ddd; background: #d4edda;">🟢 吸筹</td>
                      <td style="padding:8px; border:1px solid #ddd;">ACCUMULATE</td>
                      <td style="padding:8px; border:1px solid #ddd;">横盘/小跌</td>
                      <td style="padding:8px; border:1px solid #ddd;">↑ 上升</td>
                      <td style="padding:8px; border:1px solid #ddd;">↑ 上升</td>
                      <td style="padding:8px; border:1px solid #ddd;"><strong>潜伏</strong>（庄家建仓中）</td>
                    </tr>
                    <tr style="background: #f8f9fa;">
                      <td style="padding:8px; border:1px solid #ddd; background: #cce5ff;">🔵 拉升</td>
                      <td style="padding:8px; border:1px solid #ddd;">MARKUP</td>
                      <td style="padding:8px; border:1px solid #ddd;">↑ 上行</td>
                      <td style="padding:8px; border:1px solid #ddd;">↑ 上升</td>
                      <td style="padding:8px; border:1px solid #ddd;">↑ 上升</td>
                      <td style="padding:8px; border:1px solid #ddd;"><strong>跟随</strong>（顺势做多）</td>
                    </tr>
                    <tr>
                      <td style="padding:8px; border:1px solid #ddd; background: #fff3cd;">🟡 派发</td>
                      <td style="padding:8px; border:1px solid #ddd;">DISTRIBUTION</td>
                      <td style="padding:8px; border:1px solid #ddd;">横盘/小涨</td>
                      <td style="padding:8px; border:1px solid #ddd;">↓ 下降</td>
                      <td style="padding:8px; border:1px solid #ddd;">↑ 上升</td>
                      <td style="padding:8px; border:1px solid #ddd;"><strong>减仓</strong>（庄家出货）</td>
                    </tr>
                    <tr style="background: #f8f9fa;">
                      <td style="padding:8px; border:1px solid #ddd; background: #f8d7da;">🔴 砸盘</td>
                      <td style="padding:8px; border:1px solid #ddd;">MARKDOWN</td>
                      <td style="padding:8px; border:1px solid #ddd;">↓ 下行</td>
                      <td style="padding:8px; border:1px solid #ddd;">↓ 下降</td>
                      <td style="padding:8px; border:1px solid #ddd;">↓ 下降</td>
                      <td style="padding:8px; border:1px solid #ddd;"><strong>观望</strong>（快速杀跌）</td>
                    </tr>
                    <tr>
                      <td style="padding:8px; border:1px solid #ddd; background: #e9ecef;">⚪ 无信号</td>
                      <td style="padding:8px; border:1px solid #ddd;">UNKNOWN</td>
                      <td style="padding:8px; border:1px solid #ddd;">不明确</td>
                      <td style="padding:8px; border:1px solid #ddd;">-</td>
                      <td style="padding:8px; border:1px solid #ddd;">-</td>
                      <td style="padding:8px; border:1px solid #ddd;">等待明确信号</td>
                    </tr>
                  </table>

                  <h4 id="smart-money-traps">诱多诱空检测（V2.1.1）</h4>
                  <p>通过分析大额挂单的真实性、持续性和执行情况，识别主力的诱导行为：</p>

                  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 15px 0;">
                    <div style="background: #fef3c7; padding: 15px; border-radius: 8px; border: 2px solid #f59e0b;">
                      <h5 style="margin: 0 0 10px 0; color: #92400e;">⚠️ 诱多陷阱（Bull Trap）</h5>
                      <p style="margin: 5px 0; font-size: 13px;"><strong>特征</strong>：</p>
                      <ul style="margin: 5px 0; padding-left: 20px; font-size: 13px;">
                        <li>大量买单挂出（制造需求假象）</li>
                        <li>挂单频繁取消/移动</li>
                        <li>CVD实际下降（主力卖出）</li>
                        <li>OI上升但价格滞涨</li>
                      </ul>
                      <p style="margin: 5px 0; font-size: 13px; color: #92400e;"><strong>策略</strong>：避免追涨，等待假突破后回调</p>
                    </div>

                    <div style="background: #fee2e2; padding: 15px; border-radius: 8px; border: 2px solid #ef4444;">
                      <h5 style="margin: 0 0 10px 0; color: #991b1b;">⚠️ 诱空陷阱（Bear Trap）</h5>
                      <p style="margin: 5px 0; font-size: 13px;"><strong>特征</strong>：</p>
                      <ul style="margin: 5px 0; padding-left: 20px; font-size: 13px;">
                        <li>大量卖单挂出（制造恐慌）</li>
                        <li>挂单频繁取消/移动</li>
                        <li>CVD实际上升（主力买入）</li>
                        <li>OI上升但价格不跌</li>
                      </ul>
                      <p style="margin: 5px 0; font-size: 13px; color: #991b1b;"><strong>策略</strong>：避免恐慌卖出，等待假跌破后反弹</p>
                    </div>
                  </div>

                  <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px; border-radius: 8px; margin: 15px 0;">
                    <h5 style="margin: 0 0 10px 0; color: white;">💰 聪明钱建仓信号</h5>
                    <p style="margin: 5px 0;">当同时满足以下条件时，前端显示"💰 聪明钱建仓"标识（紫色渐变+呼吸光效）：</p>
                    <ol style="margin: 5px 0; padding-left: 20px;">
                      <li>庄家动作为<strong>吸筹(ACCUMULATE)</strong>或<strong>拉升(MARKUP)</strong></li>
                      <li><strong>未检测到</strong>诱多/诱空陷阱</li>
                      <li>置信度 > <strong>70%</strong></li>
                      <li>存在有效的大额挂单追踪（trackedEntriesCount > 0）</li>
                    </ol>
                    <p style="margin: 5px 0;"><strong>操作建议</strong>：这是主力真实建仓的高概率信号，可考虑跟随布局</p>
                  </div>

                  <h4>数据更新周期</h4>
                  <ul>
                    <li><strong>刷新频率</strong>：15分钟（可通过数据库strategy_params配置）</li>
                    <li><strong>数据存储</strong>：每次分析结果存入MySQL数据库</li>
                    <li><strong>历史数据</strong>：保留最近30天记录</li>
                    <li><strong>前端展示</strong>：实时显示最新分析结果</li>
                  </ul>

                  <h4>使用方式</h4>
                  <p>访问"💰 聪明钱"页面（<code>/smart-money</code>），查看实时监控表格：</p>
                  <ol>
                    <li><strong>自动刷新</strong>：切换到聪明钱页面自动启动15分钟刷新</li>
                    <li><strong>手动添加</strong>：输入交易对符号（如LINKUSDT）添加监控</li>
                    <li><strong>信号解读</strong>：参考"庄家动作"和"置信度"决策</li>
                    <li><strong>陷阱识别</strong>：注意"⚠️ 诱多/诱空"标识</li>
                    <li><strong>建仓提示</strong>：关注"💰 聪明钱建仓"信号</li>
                  </ol>
                </div>
              </div>

              <!-- 大额挂单监控文档 (V2.1.2) -->
              <div class="strategy-doc" id="large-orders-overview">
                <div class="doc-header">
                  <h3>📊 大额挂单监控系统 (V2.1.2)</h3>
                  <span class="strategy-badge" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">大额挂单</span>
                </div>
                <div class="doc-content">
                  <h4>监控概述</h4>
                  <p>大额挂单监控系统通过WebSocket实时订阅Binance订单簿深度数据，追踪价值超过<strong>100万美元</strong>的大额买卖挂单。系统不仅监控当前挂单状态，还追踪挂单的生命周期（新增、持续、取消、成交），识别主力操作意图和潜在黑天鹅事件。</p>
                  
                  <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #ffc107;">
                    <h5 style="margin: 0 0 10px 0; color: #856404;">🎯 核心功能</h5>
                    <ul style="margin: 5px 0; padding-left: 20px; color: #856404;">
                      <li><strong>WebSocket实时监控</strong>：100ms级别订单簿更新</li>
                      <li><strong>大额挂单追踪</strong>：自动追踪>1M USD的买卖挂单</li>
                      <li><strong>黑天鹅检测</strong>：识别极端市场事件（暴跌+大额卖单+持仓量异常）</li>
                      <li><strong>7天历史视图</strong>：累计展示近7天大额挂单数据</li>
                      <li><strong>双面板展示</strong>：BTCUSDT（₿橙色）vs ETHUSDT（Ξ蓝色）</li>
                    </ul>
                  </div>

                  <h4 id="large-orders-tracking">挂单追踪机制</h4>
                  <p>系统将大额挂单按生命周期分为以下类型：</p>

                  <table style="width:100%; font-size: 13px; margin: 15px 0; border-collapse: collapse;">
                    <tr style="background: #667eea; color: white;">
                      <th style="padding:10px; border:1px solid #ddd;">状态</th>
                      <th style="padding:10px; border:1px solid #ddd;">标识</th>
                      <th style="padding:10px; border:1px solid #ddd;">说明</th>
                      <th style="padding:10px; border:1px solid #ddd;">意义</th>
                    </tr>
                    <tr>
                      <td style="padding:8px; border:1px solid #ddd;"><strong>新增挂单</strong></td>
                      <td style="padding:8px; border:1px solid #ddd;">🆕 黄色高亮</td>
                      <td style="padding:8px; border:1px solid #ddd;">首次检测到的大额挂单</td>
                      <td style="padding:8px; border:1px solid #ddd;">主力新建仓位/支撑阻力位</td>
                    </tr>
                    <tr style="background: #f8f9fa;">
                      <td style="padding:8px; border:1px solid #ddd;"><strong>持续挂单</strong></td>
                      <td style="padding:8px; border:1px solid #ddd;">● 绿色圆点</td>
                      <td style="padding:8px; border:1px solid #ddd;">存在时间>3个检测周期</td>
                      <td style="padding:8px; border:1px solid #ddd;">真实支撑/阻力，主力意图明确</td>
                    </tr>
                    <tr>
                      <td style="padding:8px; border:1px solid #ddd;"><strong>历史挂单</strong></td>
                      <td style="padding:8px; border:1px solid #ddd;">○ 灰色圆点</td>
                      <td style="padding:8px; border:1px solid #ddd;">已取消/成交的挂单</td>
                      <td style="padding:8px; border:1px solid #ddd;">历史关键价位参考</td>
                    </tr>
                    <tr style="background: #f8f9fa;">
                      <td style="padding:8px; border:1px solid #ddd;"><strong>Spoof挂单</strong></td>
                      <td style="padding:8px; border:1px solid #ddd;">⚡ 闪电标识</td>
                      <td style="padding:8px; border:1px solid #ddd;">短时间内取消的大额挂单</td>
                      <td style="padding:8px; border:1px solid #ddd;">主力诱导行为，虚假信号</td>
                    </tr>
                  </table>

                  <div style="background: #fef3c7; padding: 12px; border-radius: 6px; margin: 15px 0;">
                    <p style="margin: 0; color: #92400e;"><strong>💡 Spoofing（诱单）说明</strong></p>
                    <p style="margin: 5px 0; color: #92400e; font-size: 13px;">Spoofing是指主力挂出大额买单/卖单制造虚假供需信号，诱导散户做出错误决策后迅速撤单。系统通过检测挂单存在时间识别此类行为。</p>
                  </div>

                  <h4 id="large-orders-swan">黑天鹅检测（V2.1.1）</h4>
                  <p>基于大额挂单、价格异动和持仓量变化，系统实时检测潜在黑天鹅事件并分级告警：</p>

                  <table style="width:100%; font-size: 13px; margin: 15px 0; border-collapse: collapse;">
                    <tr style="background: #dc3545; color: white;">
                      <th style="padding:10px; border:1px solid #ddd;">级别</th>
                      <th style="padding:10px; border:1px solid #ddd;">触发条件</th>
                      <th style="padding:10px; border:1px solid #ddd;">策略建议</th>
                    </tr>
                    <tr>
                      <td style="padding:8px; border:1px solid #ddd; background: #f8d7da;"><strong>🚨 CRITICAL</strong></td>
                      <td style="padding:8px; border:1px solid #ddd;">
                        • 5分钟跌幅 > 3%<br>
                        • 大额卖单 > 日均量10%<br>
                        • 持仓量暴跌 > 20%
                      </td>
                      <td style="padding:8px; border:1px solid #ddd;"><strong>立即平仓</strong>，等待市场企稳</td>
                    </tr>
                    <tr style="background: #f8f9fa;">
                      <td style="padding:8px; border:1px solid #ddd; background: #fff3cd;"><strong>⚠️ HIGH</strong></td>
                      <td style="padding:8px; border:1px solid #ddd;">
                        • 5分钟跌幅 > 2%<br>
                        • 大额卖单 > 日均量8%<br>
                        • 持仓量下降 > 15%
                      </td>
                      <td style="padding:8px; border:1px solid #ddd;"><strong>减仓观望</strong>，收紧止损</td>
                    </tr>
                    <tr>
                      <td style="padding:8px; border:1px solid #ddd; background: #d1ecf1;"><strong>👀 WATCH</strong></td>
                      <td style="padding:8px; border:1px solid #ddd;">
                        • 5分钟跌幅 > 1.5%<br>
                        • 大额卖单 > 日均量5%<br>
                        • 持仓量波动 > 10%
                      </td>
                      <td style="padding:8px; border:1px solid #ddd;"><strong>密切关注</strong>，准备应对</td>
                    </tr>
                  </table>

                  <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; padding: 15px; border-radius: 8px; margin: 15px 0;">
                    <h5 style="margin: 0 0 10px 0; color: white;">🦢 黑天鹅判定逻辑</h5>
                    <p style="margin: 5px 0;">系统综合以下3个维度评估黑天鹅风险：</p>
                    <ol style="margin: 5px 0; padding-left: 20px;">
                      <li><strong>价格暴跌</strong>：5分钟内跌幅超过1.5%</li>
                      <li><strong>大额抛售</strong>：单笔卖单占24小时成交量比例异常（sweep_detected）</li>
                      <li><strong>持仓异常</strong>：持仓量(OI)短时间内大幅波动</li>
                    </ol>
                    <p style="margin: 5px 0; font-size: 13px;">三个维度综合得分决定告警级别（WATCH/HIGH/CRITICAL）</p>
                  </div>

                  <h4 id="large-orders-history">7天历史视图（V2.1.2）</h4>
                  <p>前端页面以双面板形式展示BTCUSDT和ETHUSDT的7天历史累计数据：</p>

                  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 15px 0;">
                    <div style="border: 4px solid #f7931a; padding: 15px; border-radius: 8px;">
                      <h5 style="margin: 0 0 10px 0; color: #f7931a;">₿ BTCUSDT 面板（橙色）</h5>
                      <ul style="margin: 5px 0; padding-left: 20px; font-size: 13px;">
                        <li>7天累计追踪挂单数</li>
                        <li>当前存在的活跃挂单</li>
                        <li>买卖力量对比条（百分比）</li>
                        <li>挂单列表（价格、价值、出现次数、时间跨度）</li>
                      </ul>
                    </div>

                    <div style="border: 4px solid #627eea; padding: 15px; border-radius: 8px;">
                      <h5 style="margin: 0 0 10px 0; color: #627eea;">Ξ ETHUSDT 面板（蓝色）</h5>
                      <ul style="margin: 5px 0; padding-left: 20px; font-size: 13px;">
                        <li>7天累计追踪挂单数</li>
                        <li>当前存在的活跃挂单</li>
                        <li>买卖力量对比条（百分比）</li>
                        <li>挂单列表（价格、价值、出现次数、时间跨度）</li>
                      </ul>
                    </div>
                  </div>

                  <div style="background: #d4edda; padding: 12px; border-radius: 6px; margin: 15px 0;">
                    <p style="margin: 0; color: #155724;"><strong>✨ 新增挂单敏感检测</strong></p>
                    <p style="margin: 5px 0; color: #155724; font-size: 13px;">系统对新增大额挂单进行黄色闪烁高亮，帮助用户第一时间发现主力新动作。同时显示挂单持续时间和出现次数，判断挂单真实性。</p>
                  </div>

                  <h4>技术实现</h4>
                  <ul>
                    <li><strong>数据源</strong>：Binance WebSocket depth@100ms（订单簿深度流）</li>
                    <li><strong>监控交易对</strong>：BTCUSDT、ETHUSDT（现货+合约）</li>
                    <li><strong>阈值</strong>：单笔挂单价值 > 1,000,000 USD</li>
                    <li><strong>存储频率</strong>：每4小时保存一次检测结果到数据库（优化后）</li>
                    <li><strong>数据保留</strong>：7天滚动窗口（自动清理）</li>
                    <li><strong>前端刷新</strong>：60秒自动刷新</li>
                  </ul>

                  <h4>使用方式</h4>
                  <p>访问"📊 大额挂单"页面（<code>/large-orders</code>），查看实时监控：</p>
                  <ol>
                    <li><strong>双面板视图</strong>：同时查看BTC和ETH的大额挂单情况</li>
                    <li><strong>买卖对比</strong>：通过对比条快速判断多空力量</li>
                    <li><strong>新增识别</strong>：关注黄色闪烁的新增挂单（🆕标识）</li>
                    <li><strong>持续性判断</strong>：出现次数多的挂单（● 绿色）更可信</li>
                    <li><strong>黑天鹅告警</strong>：注意🦢标识和告警级别</li>
                    <li><strong>手动刷新</strong>：点击"刷新数据"按钮获取最新数据</li>
                  </ol>

                  <div style="background: #e7f3ff; padding: 15px; border-radius: 8px; margin: 15px 0;">
                    <h5 style="margin: 0 0 10px 0; color: #0c5460;">💡 实战建议</h5>
                    <ul style="margin: 5px 0; padding-left: 20px; color: #0c5460;">
                      <li><strong>支撑阻力</strong>：持续性挂单（● 绿色）可作为关键支撑/阻力位参考</li>
                      <li><strong>主力意图</strong>：买卖对比条偏向一方时，可能是主力建仓/出货信号</li>
                      <li><strong>假信号过滤</strong>：忽略短时间内消失的挂单（Spoof）</li>
                      <li><strong>黑天鹅应对</strong>：CRITICAL级别告警时立即平仓，保护本金</li>
                      <li><strong>配合其他指标</strong>：结合聪明钱监控、V3/ICT策略综合判断</li>
                    </ul>
                  </div>
                </div>
              </div>

              <!-- ICT策略文档 -->
              <div class="strategy-doc" id="ict-strategy">
                <div class="doc-header">
                  <h3>ICT订单块策略</h3>
                  <span class="strategy-badge ict">ICT</span>
                </div>
                <div class="doc-content">
                  <h4>策略概述</h4>
                  <p>ICT（Inner Circle Trader）策略基于订单块理论，通过识别机构订单区域和价格扫荡行为进行交易决策。策略采用门槛式结构确认机制，结合谐波形态共振，形成「结构反转 + 扫荡确认 +
                    谐波共振」的入场逻辑。
                  </p>

                  <h4>核心实现逻辑</h4>
                  <div class="implementation-section">
                    <h5>门槛式结构确认</h5>
                    <ul>
                      <li><strong>顺序确认机制</strong>：日线趋势 → 有效订单块 → 扫荡方向匹配 → 吞没确认 → 谐波共振</li>
                      <li><strong>门槛式评分</strong>：每个条件必须满足才能进入下一阶段</li>
                      <li><strong>谐波形态共振</strong>：Cypher/Bat/Shark形态检测，提升信号质量</li>
                      <li><strong>结构止损</strong>：基于扫荡极值或结构点位的止损设置</li>
                    </ul>

                    <h5>多时间框架分析</h5>
                    <ul>
                      <li><strong>analyzeDailyTrend</strong>：1D趋势分析，计算20日价格变化率</li>
                      <li><strong>analyzeOrderBlocks</strong>：4H订单块检测和有效性判断</li>
                      <li><strong>analyzeEngulfing</strong>：15M吞没形态检测</li>
                      <li><strong>analyzeSweeps</strong>：HTF和LTF扫荡行为分析</li>
                      <li><strong>analyzeVolumeExpansion</strong>：成交量放大分析</li>
                    </ul>
                  </div>

                  <h4>时间框架分析详解</h4>
                  <div class="timeframe-section">
                    <div class="timeframe-item">
                      <h5>高时间框架 (1D) - 趋势判断</h5>
                      <ul>
                        <li><strong>价格变化阈值</strong>：±2%为趋势确认（已从±3%降低）</li>
                        <li><strong>趋势评分</strong>：上升趋势+25分，下跌趋势+25分，震荡市+0分</li>
                        <li><strong>趋势置信度</strong>：基于价格变化幅度的置信度计算</li>
                        <li><strong>实现函数</strong>：<code>analyzeDailyTrend(klines1D)</code></li>
                      </ul>
                    </div>

                    <div class="timeframe-item">
                      <h5>中时间框架 (4H) - 订单块检测</h5>
                      <ul>
                        <li><strong>订单块识别</strong>：检测机构订单区域，年龄过滤≤2天</li>
                        <li><strong>订单块评分</strong>：有效订单块+20分</li>
                        <li><strong>ATR计算</strong>：用于订单块有效性判断和止损计算</li>
                        <li><strong>扫荡检测</strong>：检测价格是否扫荡订单块</li>
                        <li><strong>扫荡评分</strong>：HTF扫荡+15分，LTF扫荡+10分</li>
                        <li><strong>实现函数</strong>：<code>analyzeOrderBlocks(klines4H)</code></li>
                      </ul>
                    </div>

                    <div class="timeframe-item">
                      <h5>低时间框架 (15M) - 入场确认（2025-10-08更新）</h5>

                      <h6>门槛式入场条件（必须同时满足5个）：</h6>
                      <table style="width: 100%; border-collapse: collapse; margin: 15px 0;">
                        <tr style="background-color: #667eea; color: white;">
                          <th style="border: 1px solid #ddd; padding: 12px;">门槛</th>
                          <th style="border: 1px solid #ddd; padding: 12px;">条件</th>
                          <th style="border: 1px solid #ddd; padding: 12px;">说明</th>
                        </tr>
                        <tr>
                          <td style="border: 1px solid #ddd; padding: 12px;">门槛1</td>
                          <td style="border: 1px solid #ddd; padding: 12px;">日线趋势明确</td>
                          <td style="border: 1px solid #ddd; padding: 12px;">trend = UP 或 DOWN（非RANGE）</td>
                        </tr>
                        <tr style="background-color: #f8f9fa;">
                          <td style="border: 1px solid #ddd; padding: 12px;">门槛2</td>
                          <td style="border: 1px solid #ddd; padding: 12px;">4H订单块存在</td>
                          <td style="border: 1px solid #ddd; padding: 12px;">有效且年龄≤5天</td>
                        </tr>
                        <tr>
                          <td style="border: 1px solid #ddd; padding: 12px;">门槛3</td>
                          <td style="border: 1px solid #ddd; padding: 12px;">4H扫荡有效</td>
                          <td style="border: 1px solid #ddd; padding: 12px;">方向匹配趋势（UP→下方扫荡，DOWN→上方扫荡）</td>
                        </tr>
                        <tr style="background-color: #f8f9fa;">
                          <td style="border: 1px solid #ddd; padding: 12px;">门槛4</td>
                          <td style="border: 1px solid #ddd; padding: 12px;">吞没形态方向匹配</td>
                          <td style="border: 1px solid #ddd; padding: 12px;">BULLISH_ENGULFING ↔ UP，BEARISH_ENGULFING ↔
                            DOWN</td>
                        </tr>
                        <tr style="background: #fff3cd;">
                          <td style="border: 1px solid #ddd; padding: 12px;"><strong>门槛5</strong></td>
                          <td style="border: 1px solid #ddd; padding: 12px;"><strong>总分 >= 60分</strong></td>
                          <td style="border: 1px solid #ddd; padding: 12px;"><strong>强信号要求（2025-10-08新增）</strong></td>
                        </tr>
                      </table>

                      <div
                        style="background: #d1ecf1; border-left: 4px solid #0c5460; padding: 15px; margin: 15px 0; border-radius: 5px;">
                        <h6 style="color: #0c5460; margin: 0 0 10px 0;">
                          <strong>🆕 15M入场有效性检查（2025-10-09新增）</strong>
                        </h6>
                        <p style="margin: 5px 0; color: #0c5460;">
                          即使门槛式5个条件全部通过，还需要验证15M入场强度（容忍逻辑）：
                        </p>
                        <ul style="margin: 5px 0; padding-left: 20px; color: #0c5460;">
                          <li><strong>吞没形态强度 ≥ 60%</strong> 或 <strong>谐波形态分数 ≥ 60%</strong>（二选一）</li>
                          <li>不满足时信号为<strong>WATCH</strong>（观望），不触发交易</li>
                          <li><strong>效果</strong>：防止低质量吞没形态（如23.1%、38.5%强度）触发无效交易</li>
                          <li><strong>示例</strong>：ONDOUSDT吞没强度23.1%，谐波0% → WATCH（不触发）</li>
                        </ul>
                      </div>

                      <h6>可选加强条件：</h6>
                      <ul>
                        <li><strong>HTF扫荡检测</strong>：4H扫荡行为确认（阈值0.2×ATR，已从ICT标准0.4×ATR放宽），额外+10分</li>
                        <li><strong>LTF扫荡检测</strong>：15M扫荡行为确认（阈值0.02×ATR，已从ICT标准0.2×ATR放宽），额外+5分</li>
                        <li><strong>成交量放大</strong>：成交量 > 1.5倍平均，额外+5分</li>
                        <li><strong>谐波形态共振</strong>：Cypher/Bat/Shark形态检测，额外+20分</li>
                        <li><strong>谐波共振加分</strong>：谐波得分>0.6时，额外+10分</li>
                      </ul>

                      <h6>实现函数：</h6>
                      <ul>
                        <li><code>analyzeEngulfing(klines15M)</code> - 吞没形态检测</li>
                        <li><code>detectHarmonicPattern(klines15M)</code> - 谐波形态检测</li>
                        <li><code>detectSweepLTF(klines15M)</code> - 15M扫荡检测</li>
                        <li><code>detectVolumeExpansion(klines15M)</code> - 成交量分析</li>
                      </ul>
                    </div>
                  </div>

                  <h4>订单块理论实现</h4>
                  <div class="theory-section">
                    <h5>订单块识别算法</h5>
                    <p>订单块是机构大单集中的价格区域，实现特征：</p>
                    <ul>
                      <li><strong>价格盘整检测</strong>：价格在5根K线窗口内盘整</li>
                      <li><strong>高度要求</strong>：高度 >= 0.15 × ATR(4H)（🆕 已从0.25放宽，2025-10-07）</li>
                      <li><strong>价格稳定性</strong>：range / avgPrice <= 0.03</li>
                      <li><strong>成交量集中</strong>：最后2根K线成交量 >= 60%平均成交量</li>
                      <li><strong>年龄过滤</strong>：<span style="color: #28a745; font-weight: bold;">只考虑≤5天的订单块</span>（🆕 已从2天放宽，2025-10-07），确保时效性</li>
                      <li><strong>有效性验证</strong>：订单块被扫荡后的回归行为验证</li>
                    </ul>

                    <h5>扫荡检测算法（2025-10-07优化）</h5>
                    <p>扫荡是指价格快速穿越订单块区域的行为：</p>
                    <ul>
                      <li><strong>边界突破检测</strong>：价格突破订单块上下边界</li>
                      <li><strong>扫荡速率计算</strong>：计算扫荡速度，反映市场动能强度</li>
                      <li><strong>HTF扫荡阈值</strong>：速率≥0.2×ATR(4H)，检查最近5根K线（🆕 已从ICT标准0.4×ATR放宽50%）</li>
                      <li><strong>LTF扫荡阈值</strong>：速率≥0.02×ATR(15M)，≤3根K线内收回（已从ICT标准0.2×ATR放宽）</li>
                      <li><strong>回归确认</strong>：扫荡后价格回归为有效信号</li>
                      <li><strong>置信度评分</strong>：基于扫荡速率和回归行为的置信度</li>
                      <li><strong>方向化过滤</strong>：上升趋势只接受下方扫荡，下降趋势只接受上方扫荡</li>
                    </ul>

                    <h5>吞没形态检测</h5>
                    <p>吞没形态是重要的反转信号：</p>
                    <ul>
                      <li><strong>看涨吞没</strong>：阳线完全吞没前一根阴线</li>
                      <li><strong>看跌吞没</strong>：阴线完全吞没前一根阳线</li>
                      <li><strong>强度评分</strong>：基于吞没比例的强度计算(0-1)</li>
                      <li><strong>权重计算</strong>：强度 × 25分 = 最终吞没评分</li>
                    </ul>
                  </div>

                  <h4>谐波形态检测</h4>
                  <div class="harmonic-section">
                    <h5>谐波形态类型</h5>
                    <ul>
                      <li><strong>Cypher形态</strong>：AB=0.35-0.65, BC=1.05-1.50, CD=0.75-0.95</li>
                      <li><strong>Bat形态</strong>：AB=0.35-0.55, BC=0.35-0.95, CD=0.80-0.95</li>
                      <li><strong>Shark形态</strong>：AB=1.05-1.70, BC=1.05-1.70, CD=0.80-1.10</li>
                      <li><strong>容差设置</strong>：10%容差，适应市场波动</li>
                    </ul>

                    <h5>谐波共振逻辑</h5>
                    <ul>
                      <li><strong>形态检测</strong>：基于斐波那契比例的关键点识别</li>
                      <li><strong>方向判断</strong>：D点位置决定交易方向</li>
                      <li><strong>共振加分</strong>：检测到谐波形态时额外+10分</li>
                      <li><strong>置信度提升</strong>：谐波形态匹配趋势时提升信号置信度</li>
                    </ul>
                  </div>

                  <h4>评分机制详解</h4>
                  <div class="scoring-section">
                    <h5>评分权重分配</h5>
                    <ul>
                      <li><strong>日线趋势</strong>：25分 (必须条件)</li>
                      <li><strong>有效订单块</strong>：20分 (必须条件)</li>
                      <li><strong>吞没形态</strong>：强度×15分 (必须条件)</li>
                      <li><strong>HTF扫荡</strong>：置信度×10分 (必须条件)</li>
                      <li><strong>LTF扫荡</strong>：置信度×5分 (必须条件)</li>
                      <li><strong>成交量放大</strong>：5分 (可选加强)</li>
                      <li><strong>谐波形态</strong>：检测到+20分，共振+10分</li>
                    </ul>

                    <h5>信号生成逻辑（2025-10-08更新）</h5>
                    <p><strong>门槛式确认 + 强信号要求：</strong></p>
                    <ul>
                      <li><strong>BUY/SELL信号</strong>：
                        <ul>
                          <li>✅ 门槛式5个条件全部通过</li>
                          <li>✅ 总分 >= 60分</li>
                          <li>信号方向由日线趋势决定（UP→BUY，DOWN→SELL）</li>
                        </ul>
                      </li>
                      <li><strong>WATCH信号</strong>：
                        <ul>
                          <li>门槛式条件通过但总分 < 60分</li>
                          <li>或门槛式条件部分未通过（如吞没方向不匹配、扫荡方向不匹配）</li>
                        </ul>
                      </li>
                      <li><strong>HOLD信号</strong>：
                        <ul>
                          <li>日线趋势为RANGE（震荡市不交易）</li>
                          <li>或无有效订单块</li>
                          <li>或门槛式条件未通过</li>
                        </ul>
                      </li>
                    </ul>

                    <div class="warning-box"
                      style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 15px; margin: 10px 0; border-radius: 5px;">
                      <p><strong>⚠️ 重要变更：</strong></p>
                      <p>从2025-10-08起，ICT策略不再使用85/45/25分的多级阈值，改为<strong>门槛式+60分强信号</strong>的单一标准，确保只触发高质量交易信号。</p>
                    </div>
                  </div>

                  <h4>交易参数计算</h4>
                  <div class="calculation-section">
                    <h5>止损距离计算</h5>
                    <p>与V3策略保持一致，使用2倍ATR：</p>
                    <ul>
                      <li>多头：<code>stopLoss = entryPrice - (ATR × 2)</code></li>
                      <li>空头：<code>stopLoss = entryPrice + (ATR × 2)</code></li>
                      <li><strong>ATR计算</strong>：基于15M K线数据的平均真实波幅</li>
                    </ul>

                    <h5>杠杆和保证金计算</h5>
                    <p>使用与V3策略相同的计算公式：</p>
                    <ul>
                      <li><strong>止损距离X%</strong>：<code>|entryPrice - stopLoss| / entryPrice</code></li>
                      <li><strong>最大杠杆数Y</strong>：<code>Math.floor(1 / (X% + 0.5%))</code></li>
                      <li><strong>实际杠杆</strong>：<code>leverage = Math.min(calculatedMaxLeverage, 24)</code></li>
                      <li><strong>最小保证金Z</strong>：<code>Math.ceil(M / (leverage × X%))</code></li>
                      <li><strong>杠杆限制</strong>：<span style="color: #28a745; font-weight: bold;">最大24倍</span>，最小1倍</li>
                      <li><strong>风险控制</strong>：确保风险控制策略一致性</li>
                    </ul>
                  </div>

                  <h4>错误处理与日志</h4>
                  <div class="error-handling-section">
                    <ul>
                      <li><strong>数据验证</strong>：检查各时间框架K线数据的完整性</li>
                      <li><strong>评分记录</strong>：详细记录各因子的评分和决策依据</li>
                      <li><strong>异常处理</strong>：数据缺失或计算错误时的降级处理</li>
                      <li><strong>调试信息</strong>：输出详细的评分过程和信号生成逻辑</li>
                    </ul>
              </div>

                  <h4>🆕 ICT策略优化历史</h4>
                  
                  <div class="fix-item" style="background: #f8f9fa; border-left: 4px solid #28a745; padding: 15px; margin: 10px 0; border-radius: 5px;">
                    <h5>2025-10-09优化</h5>
                    
                    <h6>15M入场强度检查（容忍逻辑）✅</h6>
                    <p><strong>问题</strong>：即使门槛式5个条件全部通过，低质量吞没形态（如23.1%强度）仍触发交易</p>
                    <p><strong>修复</strong>：新增15M入场强度验证</p>
                    <ul style="margin-left: 20px;">
                      <li><strong>条件</strong>：吞没形态强度≥60% 或 谐波形态分数≥60%（二选一）</li>
                      <li><strong>不满足</strong>：信号为WATCH（观望），不触发交易</li>
                      <li><strong>效果</strong>：防止低质量信号触发无效交易</li>
                      <li><strong>示例</strong>：ONDOUSDT吞没强度23.1%，谐波0% → WATCH（不触发）</li>
                    </ul>
                  </div>

                  <div class="fix-item" style="background: #f8f9fa; border-left: 4px solid #28a745; padding: 15px; margin: 10px 0; border-radius: 5px;">
                    <h5>2025-10-08优化</h5>
                    
                    <h6>1. 前后端15M入场逻辑一致性修复 ✅</h6>
                    <p><strong>问题</strong>：前端15M入场判断过于简化，只检查吞没形态，未检查方向匹配和其他必须条件</p>
                    <p><strong>修复</strong>：统一前后端15M入场判断逻辑，实现门槛式确认 + 总分强信号（≥60分）</p>
                    
                    <h6>2. 硬编码分数问题修复 ✅</h6>
                    <p><strong>问题</strong>：不同执行路径使用硬编码分数（30分、40分），不反映实际组件检测结果</p>
                    <p><strong>修复</strong>：统一使用基于组件的动态分数计算</p>
                    
                    <h6>3. 置信度计算统一化 ✅</h6>
                    <p><strong>问题</strong>：部分路径使用字符串置信度（'MEDIUM', 'HIGH'），部分使用数值置信度</p>
                    <p><strong>修复</strong>：所有路径统一使用数值置信度计算（公式：harmonicScore × 0.6 + engulfingStrength × 0.4）</p>
                    
                    <h6>4. 强信号阈值设定 ✅</h6>
                    <p><strong>新增</strong>：15分钟入场增加总分强信号要求（总分≥60分）</p>
                    <p><strong>效果</strong>：提高交易信号可靠性，避免弱信号触发交易</p>
                  </div>

                  <div class="fix-item" style="background: #e7f3ff; border-left: 4px solid #2196f3; padding: 15px; margin: 10px 0; border-radius: 5px;">
                    <h5>2025-10-07优化</h5>
                    
                    <h6>订单块和扫荡阈值放宽 ✅</h6>
                    <ul style="margin-left: 20px;">
                      <li><strong>订单块高度</strong>：0.25×ATR → 0.15×ATR（放宽40%）</li>
                      <li><strong>订单块年龄</strong>：≤2天 → ≤5天（增加信号数量）</li>
                      <li><strong>HTF扫荡阈值</strong>：0.4×ATR → 0.2×ATR（放宽50%）</li>
                      <li><strong>LTF扫荡阈值</strong>：0.2×ATR → 0.02×ATR（放宽90%）</li>
                    </ul>
                    <p><strong>效果</strong>：增加信号捕捉灵敏度，提升交易机会</p>
                    </div>
                </div>
              </div>

              <!-- 宏观数据监控文档 -->
              <!-- 宏观数据监控文档 -->
              <div class="strategy-doc" id="macro-monitoring">
                <div class="doc-header">
                  <h3>宏观数据监控</h3>
                  <span class="strategy-badge macro">宏观</span>
                </div>
                <div class="doc-content">
                  <h4 id="macro-overview">监控概述</h4>
                  <p>宏观数据监控系统是一个独立的监控模块，实时监控链上资金流、市场情绪、合约市场风险和宏观经济指标，为交易决策提供宏观层面的数据支持。系统严格按照性能优化要求设计，适配VPS 2C1G资源限制。</p>

                  <h4>系统架构实现</h4>
                  <div class="architecture-section">
                    <h5>模块结构</h5>
                    <ul>
                      <li><strong>主控制器</strong>：MacroMonitorController - 统一调度和管理</li>
                      <li><strong>资金流监控</strong>：FundFlowMonitor - BTC/ETH大额转账监控</li>
                      <li><strong>市场情绪监控</strong>：MarketSentimentMonitor - 恐惧贪婪指数</li>
                      <li><strong>合约市场监控</strong>：FuturesMarketMonitor - 多空比、资金费率、OI</li>
                      <li><strong>宏观指标监控</strong>：MacroEconomicMonitor - 美联储利率、CPI</li>
                      <li><strong>性能优化器</strong>：PerformanceOptimizer - VPS资源优化</li>
                    </ul>

                    <h5>数据库设计</h5>
                    <ul>
                      <li><strong>macro_monitoring_data</strong>：存储监控数据</li>
                      <li><strong>macro_monitoring_config</strong>：存储配置信息</li>
                      <li><strong>macro_monitoring_alerts</strong>：存储告警记录</li>
                    </ul>
                  </div>

                  <h4 id="fund-flow">资金流监控实现</h4>
                  <h5>监控指标</h5>
                  <ul>
                    <li><strong>BTC大额交易</strong>：监控超过500万美元的BTC转账</li>
                    <li><strong>ETH大额转账</strong>：监控超过1000万美元的ETH转账</li>
                    <li><strong>交易所资金流</strong>：识别Binance、Coinbase、Kraken等交易所的进出资金</li>
                    <li><strong>巨鲸活动</strong>：监控已知巨鲸地址的大额转账</li>
                  </ul>

                  <h5>数据源与API</h5>
                  <ul>
                    <li><strong>Blockchair API</strong>：BTC大额交易数据，支持API Key认证</li>
                    <li><strong>Etherscan API</strong>：ETH大额转账数据，免费API</li>
                    <li><strong>地址标签库</strong>：内置交易所和巨鲸地址识别</li>
                    <li><strong>API限流控制</strong>：避免频繁调用，保护API配额</li>
                  </ul>

                  <h5>计算逻辑实现</h5>
                  <ul>
                    <li><strong>阈值过滤</strong>：BTC > $5M，ETH > $10M</li>
                    <li><strong>地址识别</strong>：通过地址标签库识别交易所和巨鲸</li>
                    <li><strong>转账模式检测</strong>：检测交易所进出、巨鲸转账等特殊模式</li>
                    <li><strong>告警机制</strong>：超过阈值时触发告警通知</li>
                    <li><strong>数据缓存</strong>：Redis缓存减少重复API调用</li>
                  </ul>

                  <h4 id="market-sentiment">市场情绪监控实现</h4>
                  <h5>监控指标</h5>
                  <ul>
                    <li><strong>恐惧贪婪指数</strong>：0-100分，反映市场情绪状态</li>
                    <li><strong>情绪分类</strong>：极度恐惧、恐惧、中性、贪婪、极度贪婪</li>
                  </ul>

                  <h5>数据源与API</h5>
                  <ul>
                    <li><strong>Alternative.me API</strong>：恐惧贪婪指数数据，免费API</li>
                    <li><strong>API限流</strong>：每分钟最多1次调用，避免频繁请求</li>
                    <li><strong>错误处理</strong>：API失败时的降级处理和重试机制</li>
                  </ul>

                  <h5>计算逻辑实现</h5>
                  <ul>
                    <li><strong>指数范围</strong>：0-100，数值越高越贪婪</li>
                    <li><strong>分类标准</strong>：
                      <ul>
                        <li>0-20：极度恐惧</li>
                        <li>21-40：恐惧</li>
                        <li>41-60：中性</li>
                        <li>61-80：贪婪</li>
                        <li>81-100：极度贪婪</li>
                      </ul>
                    </li>
                    <li><strong>告警阈值</strong>：可配置低阈值（默认20）和高阈值（默认80）</li>
                  </ul>

                  <h4 id="futures-market">合约市场监控实现</h4>
                  <h5>监控指标</h5>
                  <ul>
                    <li><strong>多空比</strong>：多头持仓与空头持仓的比例</li>
                    <li><strong>资金费率</strong>：永续合约的资金费率</li>
                    <li><strong>未平仓合约</strong>：当前未平仓的合约总价值</li>
                  </ul>

                  <h5>数据源与API</h5>
                  <ul>
                    <li><strong>Binance API</strong>：多空比、资金费率、未平仓合约数据</li>
                    <li><strong>OKX API</strong>：资金费率、未平仓合约数据</li>
                    <li><strong>Bybit API</strong>：多空比数据（v5版本）</li>
                    <li><strong>API聚合</strong>：多交易所数据聚合，提供更全面的市场视图</li>
                  </ul>

                  <h5>计算逻辑实现</h5>
                  <ul>
                    <li><strong>多空比计算</strong>：多头持仓数量 / 空头持仓数量，显示为"1.27:1"格式</li>
                    <li><strong>资金费率</strong>：实时资金费率，转换为百分比显示</li>
                    <li><strong>未平仓合约</strong>：各交易所未平仓合约总和，以USD显示</li>
                    <li><strong>4小时变化</strong>：与4小时前的数据对比，显示变化幅度</li>
                    <li><strong>数据更新</strong>：每4小时更新一次宏观监控，每5分钟更新一次价格数据</li>
                  </ul>

                  <h4 id="macro-indicators">宏观指标监控实现</h4>
                  <h5>监控指标</h5>
                  <ul>
                    <li><strong>美联储利率</strong>：美国联邦基金利率</li>
                    <li><strong>CPI通胀率</strong>：消费者价格指数同比变化率</li>
                    <li><strong>利率变化趋势</strong>：利率变化的历史趋势分析</li>
                  </ul>

                  <h5>数据源与API</h5>
                  <ul>
                    <li><strong>FRED API</strong>：美联储经济数据，需要API Key认证</li>
                    <li><strong>数据系列</strong>：
                      <ul>
                        <li>FEDFUNDS：联邦基金利率</li>
                        <li>CPIAUCSL：消费者价格指数</li>
                      </ul>
                    </li>
                    <li><strong>API限流</strong>：FRED API每分钟最多120次调用</li>
                    <li><strong>数据频率</strong>：利率数据每日更新，CPI数据月度更新</li>
                  </ul>

                  <h5>计算逻辑实现</h5>
                  <ul>
                    <li><strong>美联储利率</strong>：直接获取最新利率值</li>
                    <li><strong>CPI通胀率</strong>：计算同比变化率
                      <ul>
                        <li>公式：((当前CPI - 去年同期CPI) / 去年同期CPI) × 100%</li>
                        <li>数据频率：月度更新</li>
                        <li>季节调整：自动处理季节性波动</li>
                      </ul>
                    </li>
                    <li><strong>告警阈值</strong>：可配置CPI通胀率高低阈值</li>
                    <li><strong>趋势分析</strong>：计算利率和通胀率的变化趋势</li>
                  </ul>

                  <h4 id="monitoring-config">监控配置与性能优化</h4>
                  <h5>更新频率控制</h5>
                  <ul>
                    <li><strong>资金流监控</strong>：每4小时自动检查一次，支持手动刷新</li>
                    <li><strong>市场情绪</strong>：每4小时自动更新一次，支持手动刷新</li>
                    <li><strong>合约市场</strong>：每4小时自动更新一次，支持手动刷新</li>
                    <li><strong>宏观指标</strong>：每4小时自动检查一次（数据源更新频率较低），支持手动刷新</li>
                    <li><strong>手动刷新</strong>：点击刷新按钮会触发真实外部API调用，获取最新数据</li>
                    <li><strong>错峰更新</strong>：不同监控模块错峰执行，避免资源冲突</li>
                  </ul>

                  <h5>告警系统实现</h5>
                  <ul>
                    <li><strong>Telegram通知</strong>：支持配置Bot Token和Chat ID</li>
                    <li><strong>告警阈值</strong>：可自定义各指标的告警阈值</li>
                    <li><strong>冷却机制</strong>：防止频繁告警，同类型告警间隔至少1小时</li>
                    <li><strong>告警分级</strong>：严重、警告、信息三个级别</li>
                    <li><strong>告警历史</strong>：记录所有告警历史，支持查询和分析</li>
                  </ul>

                  <h5>数据存储与缓存</h5>
                  <ul>
                    <li><strong>数据库表</strong>：macro_monitoring_data存储历史数据</li>
                    <li><strong>缓存机制</strong>：Redis缓存最新数据，提高响应速度</li>
                    <li><strong>数据保留</strong>：历史数据保留30天，自动清理过期数据</li>
                    <li><strong>数据压缩</strong>：历史数据压缩存储，节省磁盘空间</li>
                    <li><strong>备份策略</strong>：定期备份重要监控数据</li>
                  </ul>

                  <h5>VPS性能优化</h5>
                  <ul>
                    <li><strong>内存管理</strong>：严格控制内存使用，避免内存泄漏</li>
                    <li><strong>CPU优化</strong>：异步处理，避免阻塞主线程</li>
                    <li><strong>网络优化</strong>：API调用超时控制，避免长时间等待</li>
                    <li><strong>错误恢复</strong>：API失败时的自动重试和降级处理</li>
                    <li><strong>监控告警</strong>：系统资源使用率监控和告警</li>
                  </ul>
                </div>
              </div>


              <!-- 系统架构文档 -->
              <div class="strategy-doc" id="system-architecture">
                <div class="doc-header">
                  <h3>系统架构说明</h3>
                  <span class="strategy-badge system">系统</span>
                </div>
                <div class="doc-content">
                  <h4>技术栈</h4>
                  <ul>
                    <li><strong>后端</strong>：Node.js + Express.js + PM2进程管理</li>
                    <li><strong>数据库</strong>：MySQL 8.0 + Redis 6.0缓存</li>
                    <li><strong>前端</strong>：原生JavaScript + HTML5 + CSS3 + Chart.js</li>
                    <li><strong>数据源</strong>：Binance Futures API (REST + WebSocket)</li>
                    <li><strong>外部API</strong>：Blockchair、Etherscan、Alternative.me、FRED</li>
                    <li><strong>部署</strong>：VPS 2C1G + Nginx反向代理</li>
                  </ul>

                  <h4>核心组件架构</h4>
                  <ul>
                    <li><strong>主应用</strong>：src/main.js - 应用入口和中间件配置</li>
                    <li><strong>策略引擎</strong>：src/strategies/ - V3多因子趋势策略和ICT订单块策略</li>
                    <li><strong>工作进程</strong>：src/workers/ - 策略执行和数据更新后台任务</li>
                    <li><strong>API路由</strong>：src/api/routes/ - RESTful API接口实现</li>
                    <li><strong>数据库层</strong>：src/database/ - MySQL操作和Redis缓存管理</li>
                    <li><strong>监控服务</strong>：src/services/ - 宏观监控、新币监控、系统监控</li>
                    <li><strong>工具模块</strong>：src/utils/ - 日志、配置、通用工具函数</li>
                  </ul>

                  <h4>最新优化 (2025-10-10)</h4>
                  <div
                    style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin: 10px 0; border-left: 4px solid #2196f3;">
                    <h5 style="margin: 0 0 10px 0; color: #0d47a1;">🔄 前后端数据同步优化</h5>
                    <ul style="margin: 5px 0; padding-left: 20px; color: #1565c0;">
                      <li><strong>统一刷新频率</strong>：前端Dashboard与后端strategy-worker都为5分钟</li>
                      <li><strong>实时价格显示</strong>：AI分析同时显示实时价格和分析时价格</li>
                      <li><strong>单例模式</strong>：Binance API使用单例，准确统计调用情况</li>
                      <li><strong>API监控</strong>：REST API和WebSocket成功率实时监控</li>
                      <li><strong>自动告警</strong>：API成功率<80%自动Telegram通知< /li>
                    </ul>
                  </div>

                  <h4>AI辅助分析系统 (2025-10-09)</h4>
                  <div style="background: #e8f5e8; padding: 15px; border-radius: 8px; margin: 10px 0;">
                    <h5 style="margin: 0 0 10px 0;">🤖 功能特性</h5>
                    <ul style="margin: 5px 0; padding-left: 20px;">
                      <li><strong>AI市场风险分析</strong>：BTC/ETH宏观风险评估，每1小时更新</li>
                      <li><strong>AI符号趋势分析</strong>：11个交易对的6档评分体系</li>
                      <li><strong>OpenAI GPT-4o-mini</strong>：集成Coinglass、Santiment、ETF Flow数据</li>
                      <li><strong>6档信号分级</strong>：强烈看多/看多/持有偏多/持有观望/持有偏空/强烈看跌</li>
                      <li><strong>价格区间预测</strong>：所有趋势都提供明确价格区间</li>
                      <li><strong>双向交易支持</strong>：同时支持做多和做空信号判断</li>
                    </ul>
                  </div>

                  <h4>最新优化 (2025-10-09)</h4>
                  <div
                    style="background: #d4edda; border-left: 4px solid #28a745; padding: 15px; margin: 10px 0; border-radius: 5px;">
                    <h5 style="color: #155724;">🆕 15M入场有效性检查</h5>
                    <ul style="color: #155724;">
                      <li><strong>容忍逻辑实现</strong>：吞没强度≥60% 或 谐波分数≥60%（二选一）</li>
                      <li><strong>防止无效交易</strong>：LDOUSDT、LINKUSDT、ONDOUSDT、SUIUSDT等低强度吞没(23-44%)不再触发交易</li>
                      <li><strong>提高信号质量</strong>：只有高质量入场信号才会触发交易</li>
                      <li><strong>效果显著</strong>：预期减少30-40%的无效交易，提升整体胜率</li>
                    </ul>
                  </div>

                  <h4>历史优化 (2025-10-07)</h4>
                  <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 10px 0;">
                    <h5>🔧 核心修复</h5>
                    <ul>
                      <li><strong>ICT策略扫荡检测优化</strong>：放宽检测条件，降低阈值，提高信号触发率
                        <ul style="margin: 5px 0; padding-left: 20px; font-size: 14px;">
                          <li>HTF Sweep阈值: 0.4×ATR → 0.2×ATR（降低50%）</li>
                          <li>LTF Sweep阈值: 0.2×ATR → 0.02×ATR（降低90%）</li>
                          <li>订单块年龄: 2天 → 5天（扩大候选范围）</li>
                          <li>订单块高度: 0.25×ATR → 0.15×ATR（降低筛选门槛）</li>
                          <li><strong>效果</strong>：信号触发率显著提升，配合门槛式确认机制保持质量</li>
                        </ul>
                      </li>
                      <li><strong>V3策略15M得分修复</strong>：修正得分计算逻辑，正确显示实际得分</li>
                      <li><strong>前端502错误修复</strong>：使用CDN版本Chart.js，解决404错误</li>
                      <li><strong>信号一致性修复</strong>：统一数据源，确保信号显示一致</li>
                    </ul>
                    <h5>🚀 策略优化</h5>
                    <ul>
                      <li><strong>ICT谐波形态共振</strong>：集成Cypher/Bat/Shark形态检测，形成「结构反转 + 扫荡确认 + 谐波共振」逻辑</li>
                      <li><strong>V3信号融合优化</strong>：增加MACD Histogram，优化15M结构分析</li>
                      <li><strong>动态仓位管理</strong>：用户可设置最大损失金额，动态计算杠杆</li>
                    </ul>
                  </div>

                  <h4>策略实现细节</h4>
                  <ul>
                    <li><strong>V3策略</strong>：4H趋势判断 + 1H多因子分析 + 15M入场确认 + MACD Histogram</li>
                    <li><strong>ICT策略</strong>：1D趋势 + 4H订单块 + 15M扫荡确认 + 吞没形态 + 谐波形态共振</li>
                    <li><strong>技术指标</strong>：EMA、ADX、BBW、ATR、VWAP、MACD Histogram、成交量分析</li>
                    <li><strong>评分机制</strong>：多因子加权评分 + 谐波共振加分 + 门槛式结构确认</li>
                    <li><strong>风险参数</strong>：基于ATR动态止损 + 结构点位止损 + 动态杠杆计算</li>
                  </ul>

                  <h4>数据流程架构</h4>
                  <ol>
                    <li><strong>数据采集</strong>：Binance API实时获取K线、ticker、资金费率等数据</li>
                    <li><strong>指标计算</strong>：并行计算多时间框架技术指标</li>
                    <li><strong>策略执行</strong>：多因子评分和信号生成</li>
                    <li><strong>风险控制</strong>：交易去重、杠杆限制、止损计算</li>
                    <li><strong>数据存储</strong>：MySQL持久化存储 + Redis缓存优化</li>
                    <li><strong>监控告警</strong>：宏观数据监控 + 系统资源监控 + Telegram通知</li>
                    <li><strong>前端展示</strong>：实时数据更新 + 图表可视化 + 交互式界面</li>
                  </ol>

                  <h4>性能优化</h4>
                  <ul>
                    <li><strong>内存优化</strong>：针对VPS 2C1G限制的内存管理策略</li>
                    <li><strong>并发处理</strong>：Promise.all并行执行，减少等待时间</li>
                    <li><strong>缓存策略</strong>：Redis缓存热点数据，减少数据库查询</li>
                    <li><strong>数据压缩</strong>：gzip压缩响应，减少网络传输</li>
                    <li><strong>连接池</strong>：数据库连接池管理，提高并发性能</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- 返回顶部按钮 -->
      <button class="back-to-top" id="backToTop" title="返回顶部">
        <i class="fas fa-arrow-up"></i>
      </button>

      <!-- Chart.js CDN -->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"
        integrity="sha512-7F4Y8UTtnlKcljnvXb2eVjEwvWNc8va6/k6Xz4iFk5Ee2Pto9R14B/0CT5fkr8B0"
        crossorigin="anonymous"></script>
      <script>
        // 监控Chart.js加载状态
        window.addEventListener('load', function () {
          console.log('页面加载完成，Chart.js状态:', typeof Chart);
          if (typeof Chart !== 'undefined') {
            console.log('Chart.js已加载，版本:', Chart.version);
          } else {
            console.error('Chart.js加载失败');
          }
        });
      </script>
      <script src="public/js/ai-analysis.js?v=20251009"></script>
      <script src="public/js/smart-money.js?v=20251010"></script>
      <link rel="stylesheet" href="public/css/smart-money.css">
      <script src="public/js/large-orders.js?v=20251011"></script>
      <link rel="stylesheet" href="public/css/large-orders.css">
      <script src="app.js?v=20251009v14"></script>
</body>

</html>
