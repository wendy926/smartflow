<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>保证金计算器调试</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .form-group { margin: 10px 0; }
        label { display: block; margin-bottom: 5px; }
        input, select { padding: 8px; margin: 5px 0; width: 200px; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; cursor: pointer; }
        button:hover { background: #0056b3; }
        .result { margin-top: 20px; padding: 15px; background: #f8f9fa; border: 1px solid #dee2e6; }
    </style>
</head>
<body>
    <h1>保证金和杠杆计算器调试</h1>
    
    <div class="form-group">
        <label>单笔最大损失金额 (USDT)</label>
        <input type="number" id="maxLossAmount" placeholder="100" value="100">
    </div>
    
    <div class="form-group">
        <label>开仓价格 (USDT)</label>
        <input type="number" id="entryPrice" placeholder="50000" step="0.01" value="50000">
    </div>
    
    <div class="form-group">
        <label>止损价格 (USDT)</label>
        <input type="number" id="stopLossPrice" placeholder="48000" step="0.01" value="48000">
    </div>
    
    <div class="form-group">
        <label>止盈价格 (USDT)</label>
        <input type="number" id="takeProfitPrice" placeholder="52000" step="0.01" value="52000">
    </div>
    
    <div class="form-group">
        <label>交易方向</label>
        <select id="tradeDirection">
            <option value="long">多头 (Long)</option>
            <option value="short">空头 (Short)</option>
        </select>
    </div>
    
    <div class="form-group">
        <button id="calculateMarginBtn">计算保证金和杠杆</button>
    </div>
    
    <div class="result" id="marginResult" style="display: none;">
        <h3>计算结果</h3>
        <p>止损距离: <span id="stopLossDistance">--</span></p>
        <p>最大杠杆: <span id="maxLeverage">--</span></p>
        <p>最小保证金: <span id="minMargin">--</span></p>
        <p>盈亏比: <span id="riskRewardRatio">--</span></p>
    </div>

    <script>
        console.log('调试页面加载完成');
        
        // 保证金和杠杆计算器
        async function calculateMarginAndLeverage() {
            console.log('计算函数被调用');
            try {
                // 获取输入值
                const maxLoss = parseFloat(document.getElementById('maxLossAmount').value);
                const entryPrice = parseFloat(document.getElementById('entryPrice').value);
                const stopLossPrice = parseFloat(document.getElementById('stopLossPrice').value);
                const takeProfitPrice = parseFloat(document.getElementById('takeProfitPrice').value);
                const tradeDirection = document.getElementById('tradeDirection').value;
                
                console.log('输入值:', { maxLoss, entryPrice, stopLossPrice, takeProfitPrice, tradeDirection });
                
                // 验证输入
                if (!maxLoss || !entryPrice || !stopLossPrice || !takeProfitPrice) {
                    alert('请填写所有必需字段');
                    return;
                }
                
                if (entryPrice <= 0 || stopLossPrice <= 0 || takeProfitPrice <= 0) {
                    alert('价格必须大于0');
                    return;
                }
                
                if (maxLoss <= 0) {
                    alert('最大损失金额必须大于0');
                    return;
                }
                
                // 计算止损距离
                let stopLossDistance;
                if (tradeDirection === 'long') {
                    stopLossDistance = (entryPrice - stopLossPrice) / entryPrice;
                    if (stopLossDistance <= 0) {
                        alert('多头交易：止损价必须低于开仓价');
                        return;
                    }
                } else {
                    stopLossDistance = (stopLossPrice - entryPrice) / entryPrice;
                    if (stopLossDistance <= 0) {
                        alert('空头交易：止损价必须高于开仓价');
                        return;
                    }
                }
                
                // 计算盈亏比
                let riskRewardRatio;
                if (tradeDirection === 'long') {
                    const profitDistance = (takeProfitPrice - entryPrice) / entryPrice;
                    riskRewardRatio = profitDistance / stopLossDistance;
                    if (takeProfitPrice <= entryPrice) {
                        alert('多头交易：止盈价必须高于开仓价');
                        return;
                    }
                } else {
                    const profitDistance = (entryPrice - takeProfitPrice) / entryPrice;
                    riskRewardRatio = profitDistance / stopLossDistance;
                    if (takeProfitPrice >= entryPrice) {
                        alert('空头交易：止盈价必须低于开仓价');
                        return;
                    }
                }
                
                // 计算最大杠杆（基于最大损失限制）
                const maxLeverage = Math.floor(maxLoss / (entryPrice * stopLossDistance));
                
                // 计算最小保证金
                const minMargin = maxLoss / stopLossDistance;
                
                console.log('计算结果:', { stopLossDistance, maxLeverage, minMargin, riskRewardRatio });
                
                // 显示结果
                document.getElementById('stopLossDistance').textContent = (stopLossDistance * 100).toFixed(2) + '%';
                document.getElementById('maxLeverage').textContent = maxLeverage + 'x';
                document.getElementById('minMargin').textContent = minMargin.toFixed(2) + ' USDT';
                document.getElementById('riskRewardRatio').textContent = riskRewardRatio.toFixed(2) + ':1';
                
                // 显示结果区域
                const resultSection = document.getElementById('marginResult');
                if (resultSection) {
                    resultSection.style.display = 'block';
                }
                
                alert('计算完成');
                
            } catch (error) {
                console.error('计算保证金和杠杆时出错:', error);
                alert('计算出错: ' + error.message);
            }
        }
        
        // 初始化保证金和杠杆计算器
        function initMarginCalculator() {
            console.log('初始化保证金计算器');
            const calculateBtn = document.getElementById('calculateMarginBtn');
            console.log('按钮元素:', calculateBtn);
            if (calculateBtn) {
                calculateBtn.addEventListener('click', calculateMarginAndLeverage);
                console.log('事件监听器已添加');
            } else {
                console.error('未找到计算按钮');
            }
        }
        
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM加载完成');
            initMarginCalculator();
        });
    </script>
</body>
</html>
