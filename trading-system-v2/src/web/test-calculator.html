<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>保证金计算器测试</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-case { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .test-case h3 { margin-top: 0; color: #333; }
        .result { background: #f8f9fa; padding: 10px; margin: 10px 0; border-radius: 3px; }
        .expected { background: #e8f5e8; padding: 10px; margin: 10px 0; border-radius: 3px; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
        input { padding: 5px; margin: 5px; width: 100px; }
    </style>
</head>
<body>
    <h1>保证金和杠杆计算器测试</h1>
    
    <div class="test-case">
        <h3>测试用例1：多头交易</h3>
        <p>输入参数：</p>
        <ul>
            <li>单笔最大损失金额：100 USDT</li>
            <li>开仓价格：50000 USDT</li>
            <li>止损价格：48000 USDT</li>
            <li>止盈价格：52000 USDT</li>
            <li>交易方向：多头</li>
        </ul>
        
        <div class="expected">
            <h4>期望结果：</h4>
            <ul>
                <li>止损距离：(50000-48000)/50000 = 4%</li>
                <li>最大杠杆：1/(4%+0.5%) = 1/4.5% = 22.22 → 22x</li>
                <li>最小保证金：100/(22*4%) = 100/0.88 = 113.64 → 114 USDT</li>
                <li>盈亏比：(52000-50000)/(50000-48000) = 2000/2000 = 1:1</li>
            </ul>
        </div>
        
        <div class="result" id="result1">
            <h4>实际结果：</h4>
            <p id="test1-result">点击测试按钮查看结果</p>
        </div>
        
        <button onclick="testCase1()">测试用例1</button>
    </div>
    
    <div class="test-case">
        <h3>测试用例2：空头交易</h3>
        <p>输入参数：</p>
        <ul>
            <li>单笔最大损失金额：50 USDT</li>
            <li>开仓价格：3000 USDT</li>
            <li>止损价格：3150 USDT</li>
            <li>止盈价格：2850 USDT</li>
            <li>交易方向：空头</li>
        </ul>
        
        <div class="expected">
            <h4>期望结果：</h4>
            <ul>
                <li>止损距离：(3150-3000)/3000 = 5%</li>
                <li>最大杠杆：1/(5%+0.5%) = 1/5.5% = 18.18 → 18x</li>
                <li>最小保证金：50/(18*5%) = 50/0.9 = 55.56 → 56 USDT</li>
                <li>盈亏比：(3000-2850)/(3150-3000) = 150/150 = 1:1</li>
            </ul>
        </div>
        
        <div class="result" id="result2">
            <h4>实际结果：</h4>
            <p id="test2-result">点击测试按钮查看结果</p>
        </div>
        
        <button onclick="testCase2()">测试用例2</button>
    </div>

    <script>
        // 保证金和杠杆计算器（修复后的版本）
        function calculateMarginAndLeverage(maxLoss, entryPrice, stopLossPrice, takeProfitPrice, tradeDirection) {
            // 计算止损距离
            let stopLossDistance;
            if (tradeDirection === 'long') {
                stopLossDistance = (entryPrice - stopLossPrice) / entryPrice;
            } else {
                stopLossDistance = (stopLossPrice - entryPrice) / entryPrice;
            }

            // 计算盈亏比
            let riskRewardRatio;
            if (tradeDirection === 'long') {
                const profitDistance = (takeProfitPrice - entryPrice) / entryPrice;
                riskRewardRatio = profitDistance / stopLossDistance;
            } else {
                const profitDistance = (entryPrice - takeProfitPrice) / entryPrice;
                riskRewardRatio = profitDistance / stopLossDistance;
            }

            // 计算最大杠杆（基于止损距离 + 0.5% 安全边际）
            const safetyMargin = 0.005; // 0.5% 安全边际
            const maxLeverage = Math.floor(1 / (stopLossDistance + safetyMargin));

            // 计算最小保证金
            const minMargin = Math.ceil(maxLoss / (maxLeverage * stopLossDistance));

            return {
                stopLossDistance: stopLossDistance * 100,
                maxLeverage,
                minMargin,
                riskRewardRatio
            };
        }

        function testCase1() {
            const result = calculateMarginAndLeverage(100, 50000, 48000, 52000, 'long');
            document.getElementById('test1-result').innerHTML = `
                <ul>
                    <li>止损距离: ${result.stopLossDistance.toFixed(2)}%</li>
                    <li>最大杠杆: ${result.maxLeverage}x</li>
                    <li>最小保证金: ${result.minMargin.toFixed(2)} USDT</li>
                    <li>盈亏比: ${result.riskRewardRatio.toFixed(2)}:1</li>
                </ul>
            `;
        }

        function testCase2() {
            const result = calculateMarginAndLeverage(50, 3000, 3150, 2850, 'short');
            document.getElementById('test2-result').innerHTML = `
                <ul>
                    <li>止损距离: ${result.stopLossDistance.toFixed(2)}%</li>
                    <li>最大杠杆: ${result.maxLeverage}x</li>
                    <li>最小保证金: ${result.minMargin.toFixed(2)} USDT</li>
                    <li>盈亏比: ${result.riskRewardRatio.toFixed(2)}:1</li>
                </ul>
            `;
        }
    </script>
</body>
</html>
