# SmartFlow v2.0.0 发布指南

本指南帮助你将 V3.1 优化代码标记为 v2.0.0 并发布到 GitHub。

---

## 📋 发布前检查清单

### 代码完成度

- [x] 早期趋势探测模块 (`v3-1-early-trend.js`)
- [x] 假突破过滤器模块 (`v3-1-fake-breakout-filter.js`)  
- [x] 动态止损策略模块 (`v3-1-dynamic-stop-loss.js`)
- [x] V3.1策略集成 (`v3-strategy-v3-1-integrated.js`)
- [x] 数据库schema (`v3.1-optimization-schema.sql`)
- [x] 单元测试（33个测试用例）

### 文档完成度

- [x] package.json 版本更新为 2.0.0
- [x] CHANGELOG.md 添加 v2.0.0 变更日志
- [x] RELEASE_NOTES_v2.0.md 创建
- [x] 代码JSDoc注释完整

---

## 🚀 快速发布（推荐）

### 方法1: 使用自动化脚本

```bash
# 1. 进入项目目录
cd /Users/kaylame/KaylaProject/smartflow/trading-system-v2

# 2. 赋予执行权限
chmod +x release-v2.0.sh

# 3. 执行发布脚本
./release-v2.0.sh
```

脚本会自动完成：
- ✅ 检查Git状态
- ✅ 添加所有更改
- ✅ 提交代码（包含详细的commit message）
- ✅ 创建 v2.0.0 标签
- ✅ 推送到 GitHub

---

## 📝 手动发布步骤

如果你prefer手动操作，可以按以下步骤：

### 步骤1: 提交代码

```bash
# 查看当前状态
git status

# 添加所有更改
git add .

# 提交更改
git commit -m "Release v2.0.0 - V3.1 Strategy Optimization

✨ 新增功能:
- 早期趋势探测模块 (v3-1-early-trend.js)
- 假突破过滤器模块 (v3-1-fake-breakout-filter.js)
- 动态止损策略模块 (v3-1-dynamic-stop-loss.js)

🗄️ 数据库增强:
- 新增 v3_1_signal_logs 表
- 新增 v3_1_strategy_params 表
- 扩展 simulation_trades 表

🧪 测试覆盖: 33个测试用例

📝 文档: CHANGELOG.md, RELEASE_NOTES_v2.0.md

🎯 预期: 胜率+5-10%, 期望值+15-20%"
```

### 步骤2: 创建标签

```bash
# 创建带注释的标签
git tag -a v2.0.0 -m "SmartFlow v2.0.0 - V3.1 Strategy Optimization

🚀 主要优化:
1. 早期趋势探测 - 提前捕捉趋势起点
2. 假突破过滤器 - 提高信号质量
3. 动态止损策略 - 精细化风险管理

📊 预期提升:
- 胜率: +5-10%
- 期望值: +15-20%

Release Date: 2025-10-10"

# 查看标签
git tag -l "v*"
git show v2.0.0
```

### 步骤3: 推送到GitHub

```bash
# 推送代码
git push origin main

# 推送标签
git push origin v2.0.0

# 或者一次性推送所有
git push origin main --tags
```

---

## 🌐 在GitHub上创建Release

### 方法1: 通过Web界面

1. 访问仓库: https://github.com/wendy926/smartflow

2. 点击右侧的 **Releases**

3. 点击 **Draft a new release**

4. 填写表单:
   - **Tag**: 选择 `v2.0.0`
   - **Release title**: `v2.0.0 - V3.1 Strategy Optimization`
   - **Description**: 复制 `RELEASE_NOTES_v2.0.md` 的内容

5. 可选：上传附件
   - `v3.1-optimization-schema.sql`
   - 测试报告（如有）

6. 选择：
   - [ ] Set as a pre-release（如果还在测试）
   - [x] Set as the latest release

7. 点击 **Publish release**

### 方法2: 使用GitHub CLI

```bash
# 安装GitHub CLI (如果未安装)
brew install gh

# 登录
gh auth login

# 创建Release
gh release create v2.0.0 \
  --title "v2.0.0 - V3.1 Strategy Optimization" \
  --notes-file RELEASE_NOTES_v2.0.md \
  --latest

# 上传附件（可选）
gh release upload v2.0.0 database/v3.1-optimization-schema.sql
```

---

## ✅ 发布后验证

### 1. 检查GitHub

```bash
# 查看远程标签
git ls-remote --tags origin

# 应该能看到 v2.0.0
```

访问以下URL确认：
- Release页面: https://github.com/wendy926/smartflow/releases/tag/v2.0.0
- Tag页面: https://github.com/wendy926/smartflow/tags

### 2. 克隆验证

```bash
# 在另一个目录测试克隆
cd /tmp
git clone --branch v2.0.0 https://github.com/wendy926/smartflow.git smartflow-v2-test
cd smartflow-v2-test/trading-system-v2

# 检查版本
cat package.json | grep version
# 应该显示: "version": "2.0.0",

# 检查文件
ls -la src/strategies/v3-1-*.js
ls -la database/v3.1-optimization-schema.sql
ls -la tests/v3-1-*.test.js
```

### 3. 本地标签检查

```bash
# 查看本地所有标签
git tag -l

# 查看v2.0.0标签详情
git show v2.0.0

# 查看标签对应的提交
git log v2.0.0 -1 --oneline
```

---

## 🔧 问题排查

### 问题1: 推送被拒绝

```
error: failed to push some refs to 'https://github.com/...'
```

**解决方案**:
```bash
# 先拉取远程更改
git pull origin main --rebase

# 再推送
git push origin main
git push origin v2.0.0
```

### 问题2: 标签已存在

```
fatal: tag 'v2.0.0' already exists
```

**解决方案**:
```bash
# 删除本地标签
git tag -d v2.0.0

# 删除远程标签（如果已推送）
git push origin :refs/tags/v2.0.0

# 重新创建
git tag -a v2.0.0 -m "..."
git push origin v2.0.0
```

### 问题3: 权限不足

```
Permission denied (publickey)
```

**解决方案**:
```bash
# 检查SSH密钥
ssh -T git@github.com

# 或使用HTTPS
git remote set-url origin https://github.com/wendy926/smartflow.git
git push origin main
```

### 问题4: 大文件推送失败

如果node_modules被意外包含：

```bash
# 确保.gitignore包含node_modules
echo "node_modules/" >> .gitignore

# 从Git追踪中移除
git rm -r --cached node_modules/

# 重新提交
git add .gitignore
git commit -m "Update .gitignore"
git push origin main
```

---

## 📦 下一步操作

### 1. 部署到VPS测试

```bash
# SSH到VPS
ssh -i ~/.ssh/smartflow_vps_new root@47.237.163.85

# 进入项目目录
cd /home/admin/trading-system-v2/trading-system-v2

# 拉取v2.0.0
git fetch --tags
git checkout v2.0.0

# 执行数据库迁移
mysql -u root -p trading_system < database/v3.1-optimization-schema.sql

# 重启服务
pm2 restart ecosystem.config.js

# 查看日志
pm2 logs main-app --lines 100
```

### 2. 监控性能

- 观察早期趋势检测率
- 监控假突破过滤拒绝率
- 跟踪胜率变化
- 记录动态止损效果

### 3. 收集反馈

- 记录优化效果
- 调整参数配置
- 准备v2.1改进计划

---

## 📊 版本对比

| 版本 | 发布日期 | 主要特性 | 状态 |
|------|---------|---------|------|
| v1.0.0 | 2025-10-10 | V3+ICT策略，AI分析，Telegram通知 | ✅ Production |
| v2.0.0 | 2025-10-10 | V3.1优化：早期趋势+假突破过滤+动态止损 | 🧪 Testing |

---

## 📞 获取帮助

如果遇到问题：

1. 查看本文档的**问题排查**部分
2. 检查GitHub Issues: https://github.com/wendy926/smartflow/issues
3. 查看在线文档: https://smart.aimaventop.com/docs

---

## ✨ 恭喜！

如果你已经完成以上步骤，恭喜你成功发布了 SmartFlow v2.0.0！

v3.1策略优化现在已经在GitHub上，可以开始测试和验证了。

**祝交易顺利！** 🚀📈

