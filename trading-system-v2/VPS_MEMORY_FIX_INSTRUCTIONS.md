# VPSå†…å­˜æ³„æ¼ä¿®å¤å’Œé‡å¯æŒ‡å—

**æ—¥æœŸ**: 2025-10-26  
**é—®é¢˜**: VPSå†…å­˜ä½¿ç”¨100%ï¼Œå·²é‡å¯å®ä¾‹æ¢å¤  
**è§£å†³æ–¹æ¡ˆ**: ä¿®å¤ç¾è‚¡ç­–ç•¥å†…å­˜æ³„æ¼ï¼Œé‡å¯åŠ å¯†è´§å¸æœåŠ¡

---

## âœ… å·²ä¿®å¤çš„é—®é¢˜

### 1. ç¾è‚¡å›æµ‹å¼•æ“ä¼˜åŒ–
- âœ… å‡å°‘PnLæ›´æ–°é¢‘ç‡ï¼ˆæ¯10æ ¹Kçº¿ä¸€æ¬¡ï¼‰
- âœ… å®šæœŸæ¸…ç†tradesæ•°ç»„ï¼ˆé¿å…å†…å­˜å †ç§¯ï¼‰
- âœ… æ·»åŠ 512MBå†…å­˜é™åˆ¶
- âœ… æ·»åŠ å†…å­˜ç›‘æ§å’Œåƒåœ¾å›æ”¶

### 2. ç¾è‚¡Workerç¦ç”¨
- âœ… Workeré»˜è®¤ä¸å¯åŠ¨ï¼ˆé¿å…å ç”¨å†…å­˜ï¼‰
- âœ… éœ€è¦é€šè¿‡ç¯å¢ƒå˜é‡å¯ç”¨
- âœ… ä¸ä¼šå½±å“åŠ å¯†è´§å¸ç­–ç•¥

### 3. ä»£ç å·²æäº¤
- âœ… æ‰€æœ‰ä¿®å¤å·²æ¨é€åˆ°GitHub
- âœ… åˆ›å»ºäº†VPSæ›´æ–°è„šæœ¬
- âœ… åˆ›å»ºäº†è¯¦ç»†çš„æ“ä½œæŒ‡å—

---

## ğŸš€ åœ¨VPSä¸Šæ‰§è¡Œæ“ä½œ

### æ–¹æ³•1: ä½¿ç”¨æ›´æ–°è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
# 1. SSHè¿æ¥åˆ°VPS
ssh root@47.237.163.85

# 2. è¿›å…¥é¡¹ç›®ç›®å½•
cd /home/admin/smartflow-vps-app/vps-app

# 3. å¦‚æœè„šæœ¬è¿˜åœ¨ï¼Œç›´æ¥è¿è¡Œ
chmod +x update-vps.sh
./update-vps.sh
```

### æ–¹æ³•2: æ‰‹åŠ¨æ‰§è¡Œå‘½ä»¤

```bash
# 1. SSHè¿æ¥åˆ°VPS
ssh root@47.237.163.85

# 2. è¿›å…¥é¡¹ç›®ç›®å½•
cd /home/admin/smartflow-vps-app/vps-app

# 3. æŸ¥çœ‹å½“å‰PM2è¿›ç¨‹
pm2 list

# 4. æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# 5. é‡å¯åŠ å¯†è´§å¸ç­–ç•¥æœåŠ¡
pm2 restart strategy-worker

# 6. é‡å¯main-appï¼ˆå¦‚æœéœ€è¦ï¼‰
pm2 restart main-app

# 7. æ£€æŸ¥çŠ¶æ€
pm2 list
pm2 logs strategy-worker --lines 50
```

---

## ğŸ“‹ è¯¦ç»†æ“ä½œæ­¥éª¤

### 1. è¿æ¥VPS

```bash
ssh root@47.237.163.85
```

å¦‚æœè¿æ¥å¤±è´¥ï¼Œæ£€æŸ¥SSHå¯†é’¥ï¼š

```bash
ssh -i ~/.ssh/id_rsa root@47.237.163.85
```

### 2. æ£€æŸ¥PM2è¿›ç¨‹

```bash
pm2 list
```

æœŸæœ›è¾“å‡ºï¼š
```
â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id  â”‚ name              â”‚ status  â”‚ uptime  â”‚ memory   â”‚ cpu     â”‚
â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 0   â”‚ main-app          â”‚ online  â”‚ ...     â”‚ ...      â”‚ ...     â”‚
â”‚ 1   â”‚ strategy-worker   â”‚ online  â”‚ ...     â”‚ ...      â”‚ ...     â”‚
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. æ‹‰å–ä»£ç 

```bash
cd /home/admin/smartflow-vps-app/vps-app
git pull origin main
```

å¦‚æœæœ‰å†²çªï¼š
```bash
git stash
git pull origin main
git stash pop
```

### 4. é‡å¯æœåŠ¡

```bash
# é‡å¯ç­–ç•¥æ‰§è¡Œå™¨
pm2 restart strategy-worker

# ç­‰å¾…å‡ ç§’æŸ¥çœ‹çŠ¶æ€
sleep 3
pm2 list

# æŸ¥çœ‹æ—¥å¿—
pm2 logs strategy-worker --lines 50
```

### 5. éªŒè¯æœåŠ¡

```bash
# æ£€æŸ¥å†…å­˜ä½¿ç”¨
free -h

# æ£€æŸ¥PM2çŠ¶æ€
pm2 list

# æŸ¥çœ‹æœ€æ–°æ—¥å¿—
pm2 logs strategy-worker --lines 100 | tail -n 50

# å®æ—¶ç›‘æ§ï¼ˆæŒ‰Ctrl+Cé€€å‡ºï¼‰
pm2 monit
```

---

## ğŸ” éªŒè¯è¦ç‚¹

### 1. PM2è¿›ç¨‹æ­£å¸¸
- âœ… main-app çŠ¶æ€ä¸º online
- âœ… strategy-worker çŠ¶æ€ä¸º online
- âœ… å†…å­˜ä½¿ç”¨æ­£å¸¸ï¼ˆ< 80%ï¼‰

### 2. ç­–ç•¥æ­£å¸¸è¿è¡Œ
```bash
# æŸ¥çœ‹ç­–ç•¥æ—¥å¿—
pm2 logs strategy-worker | grep "ç­–ç•¥æ‰§è¡Œ"

# æ£€æŸ¥æœ€æ–°äº¤æ˜“
# ï¼ˆéœ€è¦æ•°æ®åº“è®¿é—®ï¼‰
```

### 3. å†…å­˜ä½¿ç”¨æ­£å¸¸
```bash
free -h
# åº”è¯¥æ˜¾ç¤ºå†…å­˜ä½¿ç”¨ç‡ < 80%

# æŸ¥çœ‹è¯¦ç»†å†…å­˜ä½¿ç”¨
pm2 monit
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### ç¾è‚¡æ¨¡å—çŠ¶æ€
- âœ… **æœªå¯åŠ¨**: ç¾è‚¡Workeré»˜è®¤ä¸è¿è¡Œ
- âœ… **ä¸å½±å“**: ä¸ä¼šå½±å“åŠ å¯†è´§å¸ç­–ç•¥
- âœ… **å¯ç”¨**: éœ€è¦æ—¶å¯é€šè¿‡APIæ‰‹åŠ¨è§¦å‘

### åŠ å¯†è´§å¸æœåŠ¡
- âœ… **ä¿æŒè¿è¡Œ**: main-app å’Œ strategy-worker
- âœ… **æ­£å¸¸äº¤æ˜“**: åŠ å¯†è´§å¸ç­–ç•¥ç»§ç»­è¿è¡Œ
- âœ… **æ— å½±å“**: ç¾è‚¡æ¨¡å—ä¸å½±å“ç°æœ‰æœåŠ¡

### å†…å­˜ç®¡ç†
- âœ… **ä¼˜åŒ–**: å›æµ‹å¼•æ“å·²ä¼˜åŒ–å†…å­˜ä½¿ç”¨
- âœ… **ç›‘æ§**: æ·»åŠ äº†å†…å­˜ç›‘æ§æœºåˆ¶
- âœ… **é™åˆ¶**: 512MBå†…å­˜ä½¿ç”¨é™åˆ¶
- âœ… **æ¸…ç†**: å®šæœŸæ¸…ç†å¤§æ•°ç»„

---

## ğŸ¯ é¢„æœŸç»“æœ

### PM2çŠ¶æ€
```bash
â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id  â”‚ name              â”‚ status â”‚ uptime  â”‚ memory   â”‚ cpu     â”‚
â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 0   â”‚ main-app          â”‚ online â”‚ 5m      â”‚ ~120MB   â”‚ ~2%     â”‚
â”‚ 1   â”‚ strategy-worker   â”‚ online â”‚ 2m      â”‚ ~80MB    â”‚ ~5%     â”‚
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å†…å­˜ä½¿ç”¨
```bash
              total        used        free      shared  buff/cache   available
Mem:          2.0G        1.5G        200M        50M        300M       500M
```

### æ—¥å¿—è¾“å‡º
```bash
[strategy-worker] ç­–ç•¥æ‰§è¡Œæ­£å¸¸
[strategy-worker] V3ç­–ç•¥åˆ†æå®Œæˆ
[strategy-worker] ICTç­–ç•¥åˆ†æå®Œæˆ
```

---

## ğŸ“Š å†…å­˜æ³„æ¼ä¿®å¤è¯¦æƒ…

### é—®é¢˜åˆ†æ
- ç¾è‚¡å›æµ‹å¼•æ“åœ¨å¤„ç†å¤§é‡æ•°æ®æ—¶å¯èƒ½å †ç§¯å†…å­˜
- æ¯æ¬¡å¾ªç¯éƒ½æ›´æ–°PnLå¯¼è‡´é¢‘ç¹æ•°æ®åº“æ“ä½œ
- tradesæ•°ç»„æœªæ¸…ç†å¯¼è‡´å†…å­˜ç§¯ç´¯

### ä¿®å¤æªæ–½

#### 1. å‡å°‘PnLæ›´æ–°é¢‘ç‡
```javascript
// ä¿®å¤å‰ï¼šæ¯æ¬¡å¾ªç¯éƒ½æ›´æ–°
for (const [posSymbol, position] of positions.entries()) {
  await this.simulationTrades.updatePnL(...);
}

// ä¿®å¤åï¼šæ¯10æ ¹Kçº¿æ›´æ–°ä¸€æ¬¡
if (i % 10 === 0) {
  for (const [posSymbol, position] of positions.entries()) {
    await this.simulationTrades.updatePnL(...);
  }
}
```

#### 2. å®šæœŸæ¸…ç†å¤§æ•°ç»„
```javascript
// å®šæœŸæ¸…ç†tradesæ•°ç»„ï¼Œä¿ç•™æœ€è¿‘100æ¡
if (trades.length > 100 && i % 50 === 0) {
  trades.splice(0, trades.length - 100);
}
```

#### 3. æ·»åŠ å†…å­˜ç›‘æ§
```javascript
// ç›‘æ§å†…å­˜ä½¿ç”¨
this.startMemoryMonitoring();

// è¶…è¿‡512MBæ—¶è§¦å‘åƒåœ¾å›æ”¶
if (heapUsed > this.maxMemoryUsage) {
  global.gc();
}
```

#### 4. ç¦ç”¨Workeré»˜è®¤å¯åŠ¨
```javascript
// åªæœ‰æ˜ç¡®è®¾ç½®æ‰å¯åŠ¨
if (process.env.ENABLE_US_STOCK_WORKER === 'true') {
  // å¯åŠ¨Worker
}
```

---

## âœ… æ‰§è¡Œæ£€æŸ¥æ¸…å•

å®ŒæˆVPSæ“ä½œåï¼Œæ£€æŸ¥ï¼š

- [ ] PM2è¿›ç¨‹æ­£å¸¸è¿è¡Œ
- [ ] main-appåœ¨çº¿
- [ ] strategy-workeråœ¨çº¿
- [ ] å†…å­˜ä½¿ç”¨ < 80%
- [ ] ç­–ç•¥æ—¥å¿—æ­£å¸¸
- [ ] æœ‰æ–°çš„åŠ å¯†è´§å¸äº¤æ˜“äº§ç”Ÿ
- [ ] ä»£ç å·²æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬
- [ ] æ²¡æœ‰å†…å­˜æ³„æ¼è¿¹è±¡

---

## ğŸ‰ å®Œæˆæ ‡å¿—

### æˆåŠŸçš„æ ‡å¿—
1. âœ… PM2æ˜¾ç¤ºæ‰€æœ‰æœåŠ¡online
2. âœ… å†…å­˜ä½¿ç”¨æ­£å¸¸ï¼ˆ< 80%ï¼‰
3. âœ… ç­–ç•¥æ—¥å¿—æ˜¾ç¤ºæ­£å¸¸æ‰§è¡Œ
4. âœ… åŠ å¯†è´§å¸äº¤æ˜“æ­£å¸¸è¿›è¡Œ
5. âœ… ä»£ç å·²æ›´æ–°

### å¦‚æœä»æœ‰é—®é¢˜
1. æŸ¥çœ‹PM2æ—¥å¿—ï¼š`pm2 logs strategy-worker`
2. æ£€æŸ¥ç³»ç»Ÿæ—¥å¿—ï¼š`dmesg | tail`
3. é‡å¯VPSï¼š`reboot`
4. è”ç³»æŠ€æœ¯æ”¯æŒ

---

**æ‰€æœ‰ä¿®å¤å·²å®Œæˆå¹¶æäº¤åˆ°GitHubï¼Œç°åœ¨å¯ä»¥åœ¨VPSä¸Šæ‰§è¡Œæ›´æ–°æ“ä½œï¼**

