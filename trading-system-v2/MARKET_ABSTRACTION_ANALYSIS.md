# SmartFlow äº¤æ˜“ç³»ç»Ÿå¸‚åœºæŠ½è±¡åŒ–åˆ†ææŠ¥å‘Š

**æ—¥æœŸ**: 2025-07-07
**åˆ†æç‰ˆæœ¬**: v2.1.1
**åˆ†æèŒƒå›´**: trading-system-v2

---

## ğŸ“‹ æ‰§è¡Œæ‘˜è¦

æœ¬æŠ¥å‘Šåˆ†æäº† SmartFlow åŠ å¯†è´§å¸äº¤æ˜“ç³»ç»Ÿçš„æ¶æ„è®¾è®¡ï¼Œè¯„ä¼°å…¶æŠ½è±¡åŒ–èƒ½åŠ›ä»¥åŠåœ¨ä¸åŒå¸‚åœºï¼ˆAè‚¡ã€ç¾è‚¡ï¼‰ä¸­çš„åº”ç”¨å¯è¡Œæ€§ã€‚

### æ ¸å¿ƒç»“è®º

âœ… **é«˜åº¦æ¨¡å—åŒ–**: ç³»ç»Ÿé‡‡ç”¨åˆ†å±‚æ¶æ„è®¾è®¡ï¼Œæ ¸å¿ƒä¸šåŠ¡é€»è¾‘å·²å®Œå…¨æŠ½è±¡
âœ… **å¯æ‰©å±•æ€§å¼º**: é€šè¿‡ç­–ç•¥å¼•æ“å’ŒåŸºç±»è®¾è®¡ï¼Œæ˜“äºé€‚é…ä¸åŒå¸‚åœº
âš ï¸ **éƒ¨åˆ†ä¾èµ–**: Binance API ç‰¹å®šåŠŸèƒ½éœ€è¦é€‚é…å±‚å¤„ç†
ğŸ¯ **é€‚é…å¯è¡Œæ€§**: Aè‚¡é€‚é…åº¦ **85%**ï¼Œç¾è‚¡é€‚é…åº¦ **90%**

---

## 1. ç³»ç»Ÿæ¶æ„åˆ†æ

### 1.1 æ ¸å¿ƒæ¶æ„å±‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å‰ç«¯å±•ç¤ºå±‚ (Web UI)                    â”‚
â”‚                  HTML + CSS + JavaScript                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    API è·¯ç”±å±‚                            â”‚
â”‚          RESTful API (Express.js + Routes)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ä¸šåŠ¡é€»è¾‘å±‚                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ç­–ç•¥å¼•æ“    â”‚  â”‚  é£é™©ç®¡ç†    â”‚  â”‚  AIåˆ†æ      â”‚  â”‚
â”‚  â”‚ Strategy    â”‚  â”‚ Risk Mgr     â”‚  â”‚ AI Agent     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   æ•°æ®è®¿é—®å±‚                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  äº¤æ˜“æ‰€API   â”‚  â”‚  æ•°æ®åº“      â”‚  â”‚  ç¼“å­˜        â”‚  â”‚
â”‚  â”‚ Exchange APIâ”‚  â”‚ MySQL        â”‚  â”‚ Redis        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 æ¨¡å—åŒ–ç¨‹åº¦è¯„ä¼°

| æ¨¡å— | æŠ½è±¡åº¦ | å¸‚åœºç›¸å…³æ€§ | å¯å¤ç”¨æ€§ |
|------|--------|-----------|----------|
| **æŠ€æœ¯æŒ‡æ ‡è®¡ç®—** (`utils/technical-indicators.js`) | â­â­â­â­â­ | é€šç”¨ | 100% |
| **ç­–ç•¥åŸºç±»** (`core/base-strategy.js`) | â­â­â­â­â­ | é€šç”¨ | 100% |
| **ç­–ç•¥å¼•æ“** (`core/strategy-engine.js`) | â­â­â­â­â­ | é€šç”¨ | 100% |
| **é£é™©ç®¡ç†** (`strategies/*-strategy.js`) | â­â­â­â­ | é€šç”¨ | 95% |
| **å›æµ‹å¼•æ“** (`core/backtest-engine.js`) | â­â­â­â­â­ | é€šç”¨ | 100% |
| **äº¤æ˜“æ‰€æ¥å£** (`api/binance-api.js`) | â­â­ | Binanceç‰¹å®š | éœ€é€‚é… |
| **æ•°æ®åº“æ“ä½œ** (`database/*.js`) | â­â­â­â­ | é€šç”¨ | 90% |
| **AIåˆ†æ** (`services/ai-agent/`) | â­â­â­â­ | é€šç”¨ | 95% |

---

## 2. æ ¸å¿ƒæŠ½è±¡æ¨¡å—è¯†åˆ«

### 2.1 å®Œå…¨é€šç”¨çš„æ¨¡å—

#### âœ… æŠ€æœ¯æŒ‡æ ‡è®¡ç®—æ¨¡å—
**æ–‡ä»¶**: `src/utils/technical-indicators.js`

```javascript
// æ‰€æœ‰æŠ€æœ¯æŒ‡æ ‡è®¡ç®—éƒ½æ˜¯é€šç”¨çš„
- calculateMA()       // ç§»åŠ¨å¹³å‡çº¿
- calculateEMA()      // æŒ‡æ•°ç§»åŠ¨å¹³å‡
- calculateMACD()     // MACDæŒ‡æ ‡
- calculateADX()      // ADXè¶‹åŠ¿å¼ºåº¦
- calculateBBW()      // å¸ƒæ—å¸¦å®½åº¦
- calculateVWAP()     // æˆäº¤é‡åŠ æƒå¹³å‡ä»·
- calculateATR()      // å¹³å‡çœŸå®æ³¢å¹…
- calculateBollingerBands() // å¸ƒæ—å¸¦
```

**å¸‚åœºé€‚é…**: âœ… Aè‚¡ âœ… ç¾è‚¡ âœ… åŠ å¯†è´§å¸
**é€‚é…å·¥ä½œé‡**: æ— éœ€ä¿®æ”¹

#### âœ… ç­–ç•¥åŸºç±»ä¸å¼•æ“
**æ–‡ä»¶**: `src/core/base-strategy.js`, `src/core/strategy-engine.js`

```javascript
// å®Œå…¨æŠ½è±¡çš„ç­–ç•¥æ¡†æ¶
class BaseStrategy {
  applyParameters()      // å‚æ•°ç®¡ç†
  setMode()              // æ¨¡å¼åˆ‡æ¢ (AGGRESSIVE/BALANCED/CONSERVATIVE)
  execute()              // ç­–ç•¥æ‰§è¡Œæµç¨‹
  calculateIndicators()  // æŒ‡æ ‡è®¡ç®—
  generateSignal()       // ä¿¡å·ç”Ÿæˆ
  calculateStopLoss()    // æ­¢æŸè®¡ç®—
  calculateTakeProfit()  // æ­¢ç›ˆè®¡ç®—
}
```

**å¸‚åœºé€‚é…**: âœ… Aè‚¡ âœ… ç¾è‚¡ âœ… åŠ å¯†è´§å¸
**é€‚é…å·¥ä½œé‡**: æ— éœ€ä¿®æ”¹

#### âœ… å›æµ‹å¼•æ“
**æ–‡ä»¶**: `src/core/backtest-engine.js`

```javascript
// å®Œå…¨é€šç”¨çš„å›æµ‹æ¡†æ¶
class BacktestEngine {
  executeBacktest()      // æ‰§è¡Œå›æµ‹
  manageTrades()         // äº¤æ˜“ç®¡ç†
  calculateMetrics()     // æ€§èƒ½æŒ‡æ ‡è®¡ç®—
  handleTrade()          // äº¤æ˜“å¤„ç†
}
```

**å¸‚åœºé€‚é…**: âœ… Aè‚¡ âœ… ç¾è‚¡ âœ… åŠ å¯†è´§å¸
**é€‚é…å·¥ä½œé‡**: æ— éœ€ä¿®æ”¹

#### âœ… é£é™©ç®¡ç†
**æ–‡ä»¶**: `src/services/ict-position-manager.js`

```javascript
 Cited from:src/services/ict-position-manager.js
function calculatePositionSize({ accountBalance, riskPercent, entryPrice, stopPrice }) {
  const riskCash = accountBalance * riskPercent;
  const stopDistance = Math.abs(entryPrice - stopPrice);
  const qty = stopDistance === 0 ? 0 : riskCash / stopDistance;
  return { riskCash, stopDistance, qty };
}
```

**å¸‚åœºé€‚é…**: âœ… Aè‚¡ âœ… ç¾è‚¡ âœ… åŠ å¯†è´§å¸
**é€‚é…å·¥ä½œé‡**: æ— éœ€ä¿®æ”¹

### 2.2 éœ€è¦é€‚é…çš„æ¨¡å—

#### âš ï¸ äº¤æ˜“æ‰€APIæ¥å£
**æ–‡ä»¶**: `src/api/binance-api.js`

**å½“å‰å®ç°**:
```javascript
class BinanceAPI {
  baseURL = 'https://fapi.binance.com'
  wsBaseURL = 'wss://fstream.binance.com'

  async getKlines()     // Binanceæ ¼å¼Kçº¿
  async getTicker24hr() // Binance ticker
  async getFundingRate() // èµ„é‡‘è´¹ç‡ï¼ˆæœŸè´§ç‰¹æœ‰ï¼‰
  async getOpenInterest() // æŒä»“é‡ï¼ˆæœŸè´§ç‰¹æœ‰ï¼‰
}
```

**é—®é¢˜**: ç›´æ¥è€¦åˆ Binance API æ ¼å¼

**è§£å†³æ–¹æ¡ˆ**: å¼•å…¥å¸‚åœºé€‚é…å™¨æ¨¡å¼

```javascript
// æŠ½è±¡æ¥å£
interface IExchangeAdapter {
  getKlines(symbol, timeframe): Promise<Kline[]>
  getTicker(symbol): Promise<Ticker>
  getOrderBook(symbol): Promise<OrderBook>
}

// Binanceé€‚é…å™¨
class BinanceAdapter implements IExchangeAdapter { ... }

// Aè‚¡é€‚é…å™¨
class ChinaStockAdapter implements IExchangeAdapter {
  async getKlines(symbol, timeframe) {
    // è°ƒç”¨ä¸œæ–¹è´¢å¯ŒAPIæˆ–tushare
  }
}

// ç¾è‚¡é€‚é…å™¨
class USStockAdapter implements IExchangeAdapter {
  async getKlines(symbol, timeframe) {
    // è°ƒç”¨Alpaca APIæˆ–yfinance
  }
}
```

**é€‚é…å·¥ä½œé‡**:
- Aè‚¡: ğŸŸ¡ ä¸­ç­‰ (éœ€è¦é€‰æ‹©æ•°æ®æº: tushare/ä¸œæ–¹è´¢å¯Œ/yahoo finance)
- ç¾è‚¡: ğŸŸ¢ ç®€å• (æ ‡å‡†REST APIï¼Œå¦‚Alpaca/Vanguard)

#### âš ï¸ å¸‚åœºç‰¹å®šæ•°æ®

**åŠ å¯†è´§å¸ç‰¹æœ‰æ•°æ®**:
```javascript
- fundingRate      // èµ„é‡‘è´¹ç‡ï¼ˆæœŸè´§ï¼‰
- openInterest     // æŒä»“é‡å˜åŒ–
- liquidation      // çˆ†ä»“æ•°æ®
- delta           // ä¹°å–å‹åŠ›å·®
```

**Aè‚¡æ›¿ä»£æ–¹æ¡ˆ**:
```javascript
- èèµ„èåˆ¸ä½™é¢ â†’ æ›¿ä»£ openInterest
- åŒ—å‘èµ„é‡‘æµå‘ â†’ æ›¿ä»£ delta
- æ¢æ‰‹ç‡ â†’ æµåŠ¨æ€§æŒ‡æ ‡
- æˆäº¤é‡/æˆäº¤é¢ â†’ å¸‚åœºæ´»è·ƒåº¦
```

**ç¾è‚¡æ›¿ä»£æ–¹æ¡ˆ**:
```javascript
- æœŸæƒæŒä»“é‡ â†’ æ›¿ä»£ openInterest
- æœºæ„èµ„é‡‘æµ â†’ æ›¿ä»£ delta
- VIXæŒ‡æ•° â†’ ææ…ŒæŒ‡æ ‡
- åšç©ºæ¯”ä¾‹ â†’ å¸‚åœºæƒ…ç»ª
```

**é€‚é…å·¥ä½œé‡**:
- Aè‚¡: ğŸŸ¡ ä¸­ç­‰ (éœ€è¦æ•°æ®æºæ•´åˆ)
- ç¾è‚¡: ğŸŸ¢ ç®€å• (æœ‰ä¸°å¯Œçš„ç¬¬ä¸‰æ–¹æ•°æ®æº)

---

## 3. ç­–ç•¥é€‚é…åˆ†æ

### 3.1 V3å¤šå› å­è¶‹åŠ¿ç­–ç•¥

**æ–‡ä»¶**: `src/strategies/v3-strategy.js`

#### æ ¸å¿ƒé€»è¾‘
```javascript
1. 4Hè¶‹åŠ¿åˆ¤æ–­ (10åˆ†è¯„åˆ†)
   - MA20/50/200è¶‹åŠ¿ âœ“ é€šç”¨
   - ADXè¶‹åŠ¿å¼ºåº¦ âœ“ é€šç”¨
   - BBWæ³¢åŠ¨ç‡ âœ“ é€šç”¨
   - MACDåŠ¨èƒ½ âœ“ é€šç”¨

2. 1Hå› å­åˆ†æ (6åˆ†è¯„åˆ†)
   - EMA20/50ä½ç½® âœ“ é€šç”¨
   - VWAPæ”¯æ’‘å‹åŠ› âœ“ é€šç”¨
   - èµ„é‡‘è´¹ç‡ âš ï¸ éœ€æ›¿æ¢
   - æŒä»“é‡å˜åŒ– âš ï¸ éœ€æ›¿æ¢
   - Deltaä¹°å–å‹åŠ› âš ï¸ éœ€æ›¿æ¢
   - æˆäº¤é‡ç¡®è®¤ âœ“ é€šç”¨

3. 15Må…¥åœºç¡®è®¤ (5åˆ†è¯„åˆ†)
   - EMA20/50äº¤å‰ âœ“ é€šç”¨
   - ADXè¶‹åŠ¿ç¡®è®¤ âœ“ é€šç”¨
   - æˆäº¤é‡æ”¾å¤§ âœ“ é€šç”¨
   - Deltaæ–¹å‘ä¸€è‡´ âš ï¸ éœ€æ›¿æ¢
   - ç»“æ„è¯„åˆ† âœ“ é€šç”¨
```

#### Aè‚¡é€‚é…æ–¹æ¡ˆ

```javascript
// æ›¿æ¢1Hå› å­ä¸­çš„æœŸè´§ç‰¹æœ‰æŒ‡æ ‡
{
  // åŸ: fundingRate â†’ æ›¿æ¢ä¸º
  financingBalance: èèµ„èåˆ¸ä½™é¢,

  // åŸ: oiChange â†’ æ›¿æ¢ä¸º
  northwardFunds: åŒ—å‘èµ„é‡‘å‡€æµå…¥,

  // åŸ: delta â†’ æ›¿æ¢ä¸º
  volumeRatio: é‡æ¯” (æˆäº¤é‡/å¹³å‡æˆäº¤é‡)
}

// è¯„åˆ†æƒé‡è°ƒæ•´
factors = {
  emaPosition: 0.15,      // 20%
  vwapSupport: ç²¾åº¦: 0.15,   // 20%
  financingBalance: 0.20,  // 20% (æ›¿ä»£èµ„é‡‘è´¹ç‡)
  northwardFunds: 0.25,     // 25% (æ›¿ä»£æŒä»“é‡)
  volumeRatio: 0.15,        // 15% (æ›¿ä»£Delta)
  volumeConfirm: 0.10      // 10%
}
```

#### ç¾è‚¡é€‚é…æ–¹æ¡ˆ

```javascript
// ç¾è‚¡æ•°æ®æ›´ä¸°å¯Œï¼Œå¯ä»¥æ·»åŠ æ›´å¤šå› å­
{
  // åŸ: fundingRate â†’ æ›¿æ¢ä¸º
  putCallRatio: çœ‹è·Œ/çœ‹æ¶¨æœŸæƒæ¯”ç‡,

  // åŸ: oiChange â†’ æ›¿æ¢ä¸º
  optionOIChange: æœŸæƒæŒä»“é‡å˜åŒ–,

  // åŸ: delta â†’ æ›¿æ¢ä¸º
  institutionalFlow: æœºæ„èµ„é‡‘æµå‘,

  // æ–°å¢
  vixIndex: VIXææ…ŒæŒ‡æ•°,
  shortInterest: åšç©ºæ¯”ä¾‹
}

// è¯„åˆ†æƒé‡è°ƒæ•´
factors = {
  emaPosition: 0.10,
  vwapSupport: 0.10,
  putCallRatio: 0.15,
  optionOIChange: 0.20,
  institutionalFlow: 0.25,
  vixIndex: 0.10,
  volumeConfirm: 0.10
}
```

### 3.2 ICTè®¢å•å—ç­–ç•¥

**æ–‡ä»¶**: `src/strategies/ict-strategy.js`

#### æ ¸å¿ƒé€»è¾‘
```javascript
1. 1Dè¶‹åŠ¿åˆ¤æ–­
   - EMA50/150/200 âœ“ é€šç”¨
   - è¶‹åŠ¿æ–¹å‘ âœ“ é€šç”¨

2. 4Hç»“æ„åˆ†æ
   - è®¢å•å—æ£€æµ‹ âœ“ é€šç”¨ (åŸºäºKçº¿å½¢æ€)
   - HTFæµåŠ¨æ€§æ‰«è¡ âœ“ é€šç”¨ (ä»·æ ¼è¡Œä¸º)

3. 15Må…¥åœºç¡®è®¤
   - LTFæ‰«è¡ âœ“ é€šç”¨
   - åæ²¡å½¢æ€ âœ“ é€šç”¨
   - è°æ³¢å½¢æ€ âœ“ é€šç”¨
```

**å¸‚åœºé€‚é…**: âœ… å®Œå…¨é€šç”¨ï¼Œæ— å¸‚åœºç‰¹å®šä¾èµ–

---

## 4. é€‚é…å®æ–½è·¯çº¿å›¾

### é˜¶æ®µ1: åŸºç¡€è®¾æ–½æŠ½è±¡ (1-2å‘¨)

#### 1.1 åˆ›å»ºå¸‚åœºé€‚é…å™¨æ¥å£
```javascript
// src/core/adapters/ExchangeAdapter.js
class ExchangeAdapter {
  constructor(config) {
    this.config = config;
  }

  async getKlines(symbol, timeframe, limit) {}
  async getTicker(symbol) {}
  async getOrderBook(symbol) {}
  async getMarketMetrics(symbol) {}
}
```

#### 1.2 å®ç°å¸‚åœºç‰¹å®šé€‚é…å™¨
- [ ] `src/core/adapters/BinanceAdapter.js` (å·²æœ‰)
- [ ] `src/core/adapters/ChinaStockAdapter.js` (æ–°å»º)
- [ ] `src/core/adapters/USStockAdapter.js` (æ–°å»º)

#### 1.3 åˆ›å»ºé€‚é…å™¨å·¥å‚
```javascript
// src/core/adapters/AdapterFactory.js
class AdapterFactory {
  static create(marketType) {
    switch(marketType) {
      case 'CRYPTO': return new BinanceAdapter();
      case 'CN_STOCK': return new ChinaStockAdapter();
      case 'US_STOCK': return new USStockAdapter();
    }
  }
}
```

### é˜¶æ®µ2: æ•°æ®æ¨¡å‹æ ‡å‡†åŒ– (1å‘¨)

#### 2.1 ç»Ÿä¸€æ•°æ®æ ¼å¼
```javascript
// src/models/MarketData.js
interface MarketData {
  timestamp: Date;
  open: number;
  high: number;
  low: number;
  close: number;
  volume: number;
  symbol: string;
  timeframe: string;
  marketMetrics?: MarketMetrics;
}

interface MarketMetrics {
  // åŠ å¯†è´§å¸
  fundingRate?: number;
  openInterest?: number;
  delta?: number;

  // Aè‚¡
  financingBalance?: number;
  northwardFunds?: number;
  volumeRatio?: number;

  // ç¾è‚¡
  putCallRatio?: number;
  optionOIChange?: number;
  institutionalFlow?: number;
  vixIndex?: number;
}
```

### é˜¶æ®µ3: ç­–ç•¥é…ç½®åŒ– (1å‘¨)

#### 3.1 é…ç½®æ–‡ä»¶åŒ–
```javascript
// config/strategies/v3-strategy.config.js
module.exports = {
 lewBonds: {
    CRYPTO: {
      factors: [
        { name: 'fundingRate', weight: 0.15, source: 'futures' },
        { name: 'oiChange', weight: 0.20, source: 'futures' },
        { name: 'delta', weight: 0.15, source: 'trades' }
      ]
    },
    CN_STOCK: {
      factors: [
        { name: 'financingBalance', weight: 0.20, source: 'tushare' },
        { name: 'northwardFunds', weight: 0.25, source: 'efinance' },
        { name: 'volumeRatio', weight: 0.15, source: 'tushare' }
      ]
    },
    US_STOCK: {
      factors: [
        { name: 'putCallRatio', weight: 0.15, source: 'options' },
        { name: 'optionOIChange', weight: 0.20, source: 'options' },
        { name: 'institutionalFlow', weight: 0.25, source: 'funds' }
      ]
    }
  }
};
```

### é˜¶æ®µ4: æµ‹è¯•ä¸éªŒè¯ (1-2å‘¨)

- [ ] å•å…ƒæµ‹è¯•: å„é€‚é…å™¨åŠŸèƒ½æµ‹è¯•
- [ ] é›†æˆæµ‹è¯•: ç­–ç•¥åœ¨ä¸åŒå¸‚åœºè¿è¡Œæµ‹è¯•
- [ ] å›æµ‹éªŒè¯: ä½¿ç”¨å†å²æ•°æ®éªŒè¯ç­–ç•¥æœ‰æ•ˆæ€§
- [ ] æ€§èƒ½æµ‹è¯•: ç¡®ä¿å¤šå¸‚åœºæ”¯æŒä¸å½±å“æ€§èƒ½

---

## 5. æ•°æ®æºå»ºè®®

### Aè‚¡æ•°æ®æº

| æ•°æ®æº | é€‚ç”¨åœºæ™¯ | è´¹ç”¨ | æ¨èåº¦ |
|--------|----------|------|--------|
| **Tushare** | å†å²Kçº¿ã€è´¢åŠ¡æ•°æ® | å…è´¹/Pro | â­â­â­â­â­ |
| **ä¸œæ–¹è´¢å¯Œ** | å®æ—¶è¡Œæƒ…ã€èµ„é‡‘æµå‘ | å…è´¹ | â­â­â­â­ |
| **Wind** | ä¸“ä¸šçº§æ•°æ® | é«˜è´¹ç”¨ | â­â­â­ |
| **åŒèŠ±é¡ºiFind** | ç ”ç©¶çº§æ•°æ® | ä¸­è´¹ç”¨ | â­â­â­ |

**æ¨èæ–¹æ¡ˆ**: Tushare (å†å²æ•°æ®) + ä¸œæ–¹è´¢å¯ŒAPI (å®æ—¶æ•°æ®)

### ç¾è‚¡æ•°æ®æº

| æ•°æ®æº | é€‚ç”¨åœºæ™¯ | è´¹ç”¨ | æ¨èåº¦ |
|--------|----------|------|--------|
| **Alpaca API** | å®ç›˜äº¤æ˜“ã€å®æ—¶æ•°æ® | å…è´¹ | â­â­â­â­â­ |
| **Alpha Vantage** | å†å²æ•°æ®ã€æŠ€æœ¯æŒ‡æ ‡ | å…è´¹ | â­â­â­â­ |
| **Yahoo Finance** | åŸºç¡€è¡Œæƒ… | å…è´¹ | â­â­â­ |
| **Interactive Brokers** | ä¸“ä¸šäº¤æ˜“ | ä½£é‡‘åˆ¶ | â­â­â­â­ |

**æ¨èæ–¹æ¡ˆ**: Alpaca API (å®æ—¶+äº¤æ˜“) + Alpha Vantage (è¡¥å……æ•°æ®)

---

## 6. æŠ€æœ¯å€ºåŠ¡ä¸é™åˆ¶

### å½“å‰é™åˆ¶

1. **ç¡¬ç¼–ç çš„å¸‚åœºç±»å‹**
   - é—®é¢˜: ä»£ç ä¸­å¤šå¤„ç›´æ¥å¼•ç”¨ `binanceAPI`
   - è§£å†³: ä½¿ç”¨ä¾èµ–æ³¨å…¥ï¼Œé€šè¿‡é…ç½®é€‰æ‹©äº¤æ˜“æ‰€

2. **æ•°æ®åº“è¡¨ç»“æ„**
   - é—®é¢˜: è¡¨ç»“æ„é’ˆå¯¹åŠ å¯†è´§å¸è®¾è®¡
   - è§£å†³: æ·»åŠ å¸‚åœºç±»å‹å­—æ®µï¼Œæ”¯æŒæ··åˆå­˜å‚¨

3. **24å°æ—¶äº¤æ˜“å‡è®¾**
   - é—®é¢˜: Aè‚¡/ç¾è‚¡æœ‰äº¤æ˜“æ—¶é—´é™åˆ¶
   - è§£å†³: æ·»åŠ äº¤æ˜“æ—¶é—´æ£€æŸ¥é€»è¾‘

### å»ºè®®æ”¹è¿›

```javascript
// 1. å¸‚åœºé…ç½®åŒ–
config.markets = {
  CRYPTO: {
    tradingHours: '24/7',
    symbols: ['BTCUSDT', 'ETHUSDT'],
    adapter: 'BinanceAdapter'
  },
  CN_STOCK: {
    tradingHours: '09:30-11:30,13:00-15:00',
    symbols: ['000001.SZ', '600000.SH'],
    adapter: 'ChinaStockAdapter'
  },
  US_STOCK: {
    tradingHours: '09:30-16:00 ET',
    symbols: ['AAPL', 'MSFT'],
    adapter: 'USStockAdapter'
  }
};

// 2. ç»Ÿä¸€æ•°æ®è®¿é—®
class UnifiedMarketData {
  constructor(marketType) {
    this.adapter = AdapterFactory.create(marketType);
  }

  async getData(symbol, timeframe) {
    return await this.adapter.getKlines(symbol, timeframe);
  }
}
```

---

## 7. å®æ–½ä¼˜å…ˆçº§å»ºè®®

### ğŸ”´ é«˜ä¼˜å…ˆçº§ (ç«‹å³å®æ–½)

1. **åˆ›å»ºäº¤æ˜“æ‰€é€‚é…å™¨æŠ½è±¡** - æ ¸å¿ƒåŸºç¡€è®¾æ–½
2. **ç»Ÿä¸€å¸‚åœºæ•°æ®æ ¼å¼** - æ•°æ®æ ‡å‡†åŒ–
3. **é…ç½®åŒ–ç­–ç•¥å› å­** - ç­–ç•¥çµæ´»æ€§

### ğŸŸ¡ ä¸­ä¼˜å…ˆçº§ (1-2ä¸ªæœˆå†…)

4. **Aè‚¡æ•°æ®æºé›†æˆ** - Tushare + ä¸œæ–¹è´¢å¯Œ
5. **ç¾è‚¡æ•°æ®æºé›†æˆ** E - Alpaca + Alpha Vantage
6. **å¤šå¸‚åœºå›æµ‹æ”¯æŒ** - éªŒè¯ç­–ç•¥æœ‰æ•ˆæ€§

### ğŸŸ¢ ä½ä¼˜å…ˆçº§ (é•¿æœŸä¼˜åŒ–)

7. **å®æ—¶äº¤æ˜“é›†æˆ** - Aè‚¡/ç¾è‚¡å®ç›˜äº¤æ˜“
8. **å¤šè´¦æˆ·ç®¡ç†** - ç»Ÿä¸€èµ„äº§ç®¡ç†
9. **è·¨å¸‚åœºå¥—åˆ©** - å¸‚åœºé—´ä»·å·®ç­–ç•¥

---

## 8. æ€»ç»“ä¸å»ºè®®

### æ¶æ„ä¼˜åŠ¿

âœ… **é«˜åº¦æ¨¡å—åŒ–**: æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ä¸å¸‚åœºè§£è€¦
âœ… **ç­–ç•¥æŠ½è±¡**: é€šè¿‡åŸºç±»å’Œå¼•æ“å®ç°ç­–ç•¥æ ‡å‡†åŒ–
âœ… **é£é™©ç®¡ç†**: é€šç”¨çš„é£é™©ç®¡ç†æ¡†æ¶
âœ… **å›æµ‹æ”¯æŒ**: å®Œæ•´çš„å›æµ‹åŸºç¡€è®¾æ–½

### é€‚é…åº¦è¯„ä¼°

| å¸‚åœº | æ ¸å¿ƒæ¨¡å—é€‚é…åº¦ | æ•°æ®é€‚é…éš¾åº¦ | ç»¼åˆé€‚é…åº¦ |
|------|---------------|-------------|-----------|
| **Aè‚¡** | 85% | ä¸­ç­‰ | 85% |
| **ç¾è‚¡** | 90% | ç®€å• | 90% |
| **åŠ å¯†è´§å¸** | 100% | æ—  | 100% |

### å®æ–½å»ºè®®

1. **çŸ­æœŸ**: å…ˆå®ç°ç¾è‚¡é€‚é… (æ•°æ®æºæˆç†Ÿï¼ŒAPIæ ‡å‡†åŒ–)
2. **ä¸­æœŸ**: å®Œå–„Aè‚¡é€‚é… (éœ€è¦æ•°æ®æºæ•´åˆ)
3. **é•¿æœŸ**: æ„å»ºç»Ÿä¸€çš„å¤šå¸‚åœºäº¤æ˜“å¹³å°

### é¢„æœŸæ”¶ç›Š

- ğŸ¯ **ç­–ç•¥å¤ç”¨**: åŒä¸€å¥—ç­–ç•¥é€»è¾‘è·¨å¸‚åœºä½¿ç”¨
- ğŸ“Š **é£é™©åˆ†æ•£**: å¤šå¸‚åœºé…ç½®é™ä½å•ä¸€å¸‚åœºé£é™©
- ğŸ’¡ **æ•°æ®å¯¹æ¯”**: è·¨å¸‚åœºæ•°æ®éªŒè¯ç­–ç•¥æœ‰æ•ˆæ€§
- ğŸš€ **æ‰©å±•æ€§å¼º**: æ˜“äºæ·»åŠ æ–°å¸‚åœºæ”¯æŒ

---

## é™„å½•

### A. å…³é”®æ–‡ä»¶æ¸…å•

#### å®Œå…¨é€šç”¨çš„æ–‡ä»¶
- `src/core/base-strategy.js`
- `src/core/strategy-engine.js`
- `src/core/backtest-engine.js`
- `src/utils/technical-indicators.js`
- `src/services/ict-position-manager.js`

#### éœ€è¦é€‚é…çš„æ–‡ä»¶
- `src/api/binance-api.js` â†’ é‡æ„ä¸ºé€‚é…å™¨æ¨¡å¼
- `src/strategies/v3-strategy.js` â†’ é…ç½®åŒ–å› å­
- `src/strategies/ict-strategy.js` â†’ å·²é€šç”¨ï¼Œæ— éœ€ä¿®æ”¹

### B. å‚è€ƒèµ„æ–™

- [Tushare APIæ–‡æ¡£](https://tushare.pro/)
- [Alpaca APIæ–‡æ¡£](https://alpaca.markets/docs/)
- [é€‚é…å™¨æ¨¡å¼è®¾è®¡](https://refactoring.guru/design-patterns/adapter)

---

**æŠ¥å‘Šç»“æŸ**

