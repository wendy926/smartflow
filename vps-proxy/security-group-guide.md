# 云服务器安全组配置指南

## 🚨 问题分析

从诊断结果看，VPS 代理服务已经正常启动，本地连接也正常，但是外部无法访问。这通常是云服务器安全组没有开放 3000 端口导致的。

## 🔧 阿里云安全组配置

### 1. 登录阿里云控制台

1. 访问 [阿里云控制台](https://ecs.console.aliyun.com/)
2. 登录你的账号

### 2. 找到 ECS 实例

1. 进入 **云服务器 ECS** → **实例与镜像** → **实例**
2. 找到你的实例（主机名：iZt4nfung78ymt8out05jzZ）

### 3. 配置安全组

1. 点击实例名称进入详情页
2. 点击 **更多** → **网络和安全组** → **安全组配置**
3. 点击安全组 ID 进入安全组规则页面

### 4. 添加入方向规则

点击 **添加安全组规则**，配置如下：

```
规则方向：入方向
授权策略：允许
协议类型：TCP
端口范围：3000/3000
授权对象：0.0.0.0/0
描述：SmartFlow Proxy Server
优先级：1
```

### 5. 保存并测试

1. 点击 **确定** 保存规则
2. 等待 1-2 分钟让规则生效
3. 测试外部访问

## 🔧 其他云服务商配置

### 腾讯云

1. 进入 **云服务器 CVM** → **实例**
2. 点击实例 ID → **安全组**
3. 点击安全组 ID → **入站规则** → **添加规则**
4. 配置：
   - 类型：自定义
   - 协议端口：TCP:3000
   - 来源：0.0.0.0/0
   - 策略：允许

### AWS

1. 进入 **EC2** → **实例**
2. 选择实例 → **安全** → **安全组**
3. 点击安全组 ID → **入站规则** → **编辑入站规则**
4. 添加规则：
   - 类型：自定义 TCP
   - 端口：3000
   - 来源：0.0.0.0/0

## 🧪 测试步骤

配置完成后，执行以下测试：

```bash
# 1. 测试外部连接
curl http://47.237.163.85:3000/health

# 2. 测试 Binance API 代理
curl "http://47.237.163.85:3000/api/binance/fapi/v1/klines?symbol=BTCUSDT&interval=1h&limit=5"

# 3. 从本地测试
curl http://47.237.163.85:3000/health
```

## 🔍 故障排除

### 如果仍然无法访问

1. **检查安全组规则是否生效**
   - 等待 1-2 分钟
   - 检查规则是否正确添加

2. **检查实例是否在正确的安全组中**
   - 确保实例绑定了配置了规则的安全组

3. **检查端口是否正确**
   - 确认服务监听在 3000 端口
   - 确认安全组开放的是 3000 端口

4. **检查网络 ACL**
   - 某些云服务商还有网络 ACL 需要配置

### 临时解决方案

如果安全组配置有问题，可以临时开放所有端口进行测试：

```
端口范围：1/65535
授权对象：0.0.0.0/0
```

**注意：测试完成后请立即删除此规则，避免安全风险！**

## ✅ 验证清单

- [ ] 安全组规则已添加
- [ ] 端口 3000 已开放
- [ ] 授权对象为 0.0.0.0/0
- [ ] 规则已生效（等待 1-2 分钟）
- [ ] 外部连接测试通过
- [ ] Binance API 代理测试通过

## 📞 支持

如果按照上述步骤配置后仍然无法访问，请检查：

1. 云服务商是否有其他网络限制
2. 实例是否在正确的可用区
3. 是否有其他安全策略阻止连接
